<!DOCTYPE html>
<html lang="az">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExamMaster Pro | Advanced Learning Ecosystem</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #6366f1;
            --primary-glow: rgba(99, 102, 241, 0.5);
            --secondary: #06b6d4;
            --accent: #f43f5e;
            --bg-dark: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.7);
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --glass-border: rgba(255, 255, 255, 0.1);
            --success: #10b981;
            --warning: #f59e0b;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }

        body {
            background: var(--bg-dark);
            color: var(--text-main);
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 0% 0%, rgba(99, 102, 241, 0.15) 0%, transparent 35%),
                radial-gradient(circle at 100% 100%, rgba(6, 182, 212, 0.15) 0%, transparent 35%);
            min-height: 100vh;
        }

        /* --- UI Components --- */
        .glass {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary { background: var(--primary); color: white; box-shadow: 0 4px 14px var(--primary-glow); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px var(--primary-glow); }

        .btn-ghost { background: transparent; border: 1px solid var(--glass-border); color: var(--text-main); }
        .btn-ghost:hover { background: rgba(255,255,255,0.05); }

        /* --- Navigation --- */
        nav {
            padding: 20px 5%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(10px);
        }

        .logo { font-size: 1.5rem; font-weight: 800; background: linear-gradient(90deg, #fff, var(--secondary)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* --- Layout --- */
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .screen { display: none; animation: fadeIn 0.4s ease-out; }
        .screen.active { display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Dashboard Grid --- */
        .dashboard-grid { display: grid; grid-template-columns: 280px 1fr; gap: 30px; margin-top: 20px; }
        .sidebar { padding: 20px; height: fit-content; }
        .side-link { display: flex; align-items: center; gap: 12px; padding: 15px; border-radius: 12px; color: var(--text-dim); cursor: pointer; transition: 0.3s; margin-bottom: 5px; }
        .side-link:hover, .side-link.active { background: rgba(99, 102, 241, 0.1); color: var(--primary); }

        /* --- Forms --- */
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: var(--text-dim); font-size: 0.9rem; }
        input, select, textarea {
            width: 100%; padding: 14px; border-radius: 12px; background: rgba(15, 23, 42, 0.6);
            border: 1px solid var(--glass-border); color: white; transition: 0.3s;
        }
        input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 4px var(--primary-glow); }

        /* --- Quiz Engine UI --- */
        .quiz-card { max-width: 800px; margin: 40px auto; padding: 40px; }
        .option-btn {
            width: 100%; text-align: left; padding: 20px; margin-top: 15px;
            background: rgba(255,255,255,0.03); border: 1px solid var(--glass-border);
            border-radius: 15px; color: var(--text-main); cursor: pointer; transition: 0.2s;
        }
        .option-btn:hover { background: rgba(255,255,255,0.08); transform: translateX(5px); }
        .option-btn.selected { border-color: var(--primary); background: rgba(99, 102, 241, 0.1); }

        .timer-bar { height: 6px; background: var(--primary); width: 100%; transition: 1s linear; border-radius: 3px; margin-bottom: 20px; }

        /* --- Stats Card --- */
        .stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .stat-card { padding: 25px; text-align: center; }
        .stat-val { font-size: 2rem; font-weight: 800; color: var(--secondary); }

        /* --- Toast --- */
        #toast { position: fixed; bottom: 30px; right: 30px; padding: 15px 30px; border-radius: 12px; z-index: 10000; display: none; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

    </style>
</head>
<body>

    <div id="toast" class="glass">Message</div>

    <nav>
        <div class="logo">EXAMMASTER PRO <span style="font-size: 0.6rem; vertical-align: middle; border: 1px solid var(--secondary); padding: 2px 5px; border-radius: 4px; color: var(--secondary);">v1.0</span></div>
        <div id="nav-auth">
            <button class="btn btn-ghost" onclick="app.showScreen('login')">Daxil ol</button>
            <button class="btn btn-primary" onclick="app.showScreen('register')">Qeydiyyat</button>
        </div>
        <div id="nav-user" style="display: none;">
            <span id="user-display-name" style="margin-right: 15px; font-weight: 600;"></span>
            <button class="btn btn-ghost" onclick="app.logout()">√áƒ±xƒ±≈ü <i class="fa-solid fa-right-from-bracket"></i></button>
        </div>
    </nav>

    <div class="container">
        
        <section id="screen-welcome" class="screen active">
            <div style="text-align: center; padding: 80px 0;">
                <h1 style="font-size: 4rem; font-weight: 800; line-height: 1.1; margin-bottom: 20px;">G…ôl…ôc…ôyin ƒ∞mtahan <br><span style="color: var(--secondary)">Sistemini K…ô≈üf Et</span></h1>
                <p style="color: var(--text-dim); max-width: 600px; margin: 0 auto 30px;">Professional testl…ôr yarat, payla≈ü v…ô n…ôtic…ôl…ôri real-vaxt rejimind…ô analiz et. LocalStorage …ôsaslƒ± s√ºr…ôtli infrastruktur.</p>
                <button class="btn btn-primary" style="padding: 18px 40px; font-size: 1.1rem;" onclick="app.showScreen('register')">H…ômin Ba≈üla</button>
            </div>
        </section>

        <section id="screen-login" class="screen">
            <div class="glass" style="max-width: 450px; margin: 50px auto; padding: 40px;">
                <h2>Xo≈ü G…ôldiniz</h2>
                <p style="margin-bottom: 25px; color: var(--text-dim);">Giri≈ü m…ôlumatlarƒ±nƒ± daxil edin</p>
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="login-user" placeholder="cesi">
                </div>
                <div class="form-group">
                    <label>≈ûifr…ô</label>
                    <input type="password" id="login-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                </div>
                <button class="btn btn-primary" style="width: 100%;" onclick="app.login()">Daxil ol</button>
            </div>
        </section>

        <section id="screen-register" class="screen">
            <div class="glass" style="max-width: 450px; margin: 50px auto; padding: 40px;">
                <h2>Yeni Hesab</h2>
                <div class="form-group"><label>Tam Ad</label><input type="text" id="reg-name"></div>
                <div class="form-group"><label>Username</label><input type="text" id="reg-user"></div>
                <div class="form-group"><label>≈ûifr…ô</label><input type="password" id="reg-pass"></div>
                <button class="btn btn-primary" style="width: 100%;" onclick="app.register()">Qeydiyyatƒ± Tamamla</button>
            </div>
        </section>

        <section id="screen-dashboard" class="screen">
            <div class="dashboard-grid">
                <div class="sidebar glass">
                    <div class="side-link active" onclick="app.renderDashboard()"><i class="fa-solid fa-house"></i> Dashboard</div>
                    <div class="side-link" onclick="app.showScreen('create-test')"><i class="fa-solid fa-plus"></i> Test Yarat</div>
                    <div class="side-link" id="admin-only-link" style="display: none;" onclick="app.showScreen('admin-panel')"><i class="fa-solid fa-user-shield"></i> Admin Panel</div>
                    <hr style="opacity: 0.1; margin: 15px 0;">
                    <div class="side-link" onclick="app.showScreen('profile')"><i class="fa-solid fa-user-gear"></i> Profil Ayarlarƒ±</div>
                </div>
                <div class="content">
                    <h2 id="dash-greeting">Salam, User!</h2>
                    <div class="stats-container" style="margin: 25px 0;">
                        <div class="stat-card glass"><div class="stat-val" id="count-my-tests">0</div><div style="font-size: 0.8rem; color: var(--text-dim);">Yaratdƒ±ƒüƒ±m Testl…ôr</div></div>
                        <div class="stat-card glass"><div class="stat-val" id="count-completed">0</div><div style="font-size: 0.8rem; color: var(--text-dim);">Bitirdiyim Testl…ôr</div></div>
                    </div>
                    <h3>S…ônin Testl…ôrin</h3>
                    <div id="my-tests-list" style="margin-top: 20px;">
                        </div>
                </div>
            </div>
        </section>

        <section id="screen-create-test" class="screen">
            <div class="glass" style="padding: 40px;">
                <h2>Yeni Test Yaradƒ±n</h2>
                <div class="dashboard-grid" style="grid-template-columns: 1fr 1fr;">
                    <div>
                        <div class="form-group"><label>Testin Adƒ±</label><input type="text" id="test-title" placeholder="M…ôs: Riyaziyyat Base"></div>
                        <div class="form-group"><label>M√ºdd…ôt (D…ôqiq…ô)</label><input type="number" id="test-timer" value="10"></div>
                    </div>
                    <div>
                        <div class="form-group"><label>JSON Data</label><textarea id="test-json" style="height: 125px;" placeholder='[{"q": "Sual?", "o": ["A", "B"], "a": 0}]'></textarea></div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="app.saveTest()">Testi Yadda Saxla & Link Al</button>
            </div>
        </section>

        <section id="screen-quiz" class="screen">
            <div class="quiz-card glass">
                <div class="timer-bar" id="quiz-timer-bar"></div>
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3 id="quiz-q-index">Sual 1/10</h3>
                    <div id="quiz-clock" style="font-weight: 800; color: var(--secondary);">00:00</div>
                </div>
                <h2 id="quiz-q-text" style="margin-bottom: 30px;">Sual m…ôtni bura g…ôl…ôc…ôk?</h2>
                <div id="quiz-options"></div>
                <div style="display: flex; justify-content: space-between; margin-top: 40px;">
                    <button class="btn btn-ghost" onclick="app.quizPrev()">Geri</button>
                    <button class="btn btn-primary" id="quiz-next-btn" onclick="app.quizNext()">N√∂vb…ôti</button>
                </div>
            </div>
        </section>

        <section id="screen-admin-panel" class="screen">
            <div class="glass" style="padding: 30px;">
                <h2>üõ°Ô∏è Sistem Administrasiyasƒ±</h2>
                <div class="stats-container" style="margin: 20px 0;">
                    <div class="stat-card glass"><div class="stat-val" id="admin-total-users">0</div><div class="stat-label">ƒ∞stifad…ô√ßi</div></div>
                    <div class="stat-card glass"><div class="stat-val" id="admin-total-tests">0</div><div class="stat-label">C…ômi Test</div></div>
                </div>
                <table style="width: 100%; border-collapse: collapse; margin-top: 20px;">
                    <thead style="background: rgba(255,255,255,0.05);">
                        <tr><th style="padding: 15px; text-align: left;">User</th><th>Rol</th><th>Status</th><th>∆èm…ôliyyat</th></tr>
                    </thead>
                    <tbody id="admin-user-table"></tbody>
                </table>
            </div>
        </section>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script>
        /**
         * EXAMMASTER PRO - Core Logic
         * Architect: Senior Full Stack Developer
         */

        const app = {
            state: {
                users: JSON.parse(localStorage.getItem('em_users')) || [
                    { name: 'Admin Cesi', user: 'cesi', pass: 'cesi123', role: 'admin', id: '1' }
                ],
                currentUser: null,
                tests: JSON.parse(localStorage.getItem('em_tests')) || [],
                results: JSON.parse(localStorage.getItem('em_results')) || [],
                activeQuiz: null,
                activeTimer: null
            },

            init() {
                console.log("ExamMaster Pro Engine Started...");
                this.checkSession();
                // URL-d…ô test ID varsa, birba≈üa Guest giri≈üi a√ß
                const urlParams = new URLSearchParams(window.location.search);
                if(urlParams.has('test')) this.loadPublicTest(urlParams.get('test'));
            },

            // --- NAVIGATION ---
            showScreen(screenId) {
                document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
                const target = document.getElementById('screen-' + screenId);
                if(target) target.classList.add('active');
                
                if(screenId === 'admin-panel') this.renderAdmin();
                if(screenId === 'dashboard') this.renderDashboard();
            },

            toast(msg, type = 'info') {
                const t = document.getElementById('toast');
                t.innerText = msg;
                t.style.display = 'block';
                t.style.borderLeft = `5px solid ${type === 'error' ? 'var(--accent)' : 'var(--success)'}`;
                setTimeout(() => t.style.display = 'none', 3000);
            },

            // --- AUTH ---
            register() {
                const name = document.getElementById('reg-name').value;
                const user = document.getElementById('reg-user').value;
                const pass = document.getElementById('reg-pass').value;

                if(!name || !user || !pass) return this.toast("Bo≈üluq buraxmayƒ±n", "error");
                
                const newUser = { id: Date.now().toString(), name, user, pass, role: 'user', created: new Date() };
                this.state.users.push(newUser);
                this.saveData();
                this.toast("Qeydiyyat uƒüurludur, daxil olun!");
                this.showScreen('login');
            },

            login() {
                const user = document.getElementById('login-user').value;
                const pass = document.getElementById('login-pass').value;

                const found = this.state.users.find(u => u.user === user && u.pass === pass);
                if(found) {
                    this.state.currentUser = found;
                    localStorage.setItem('em_session', JSON.stringify(found));
                    this.updateUI();
                    this.showScreen('dashboard');
                    this.toast("Xo≈ü g…ôldiniz, " + found.name);
                } else {
                    this.toast("M…ôlumatlar s…ôhvdir", "error");
                }
            },

            logout() {
                this.state.currentUser = null;
                localStorage.removeItem('em_session');
                location.reload();
            },

            checkSession() {
                const session = localStorage.getItem('em_session');
                if(session) {
                    this.state.currentUser = JSON.parse(session);
                    this.updateUI();
                    this.showScreen('dashboard');
                }
            },

            updateUI() {
                const isLogged = !!this.state.currentUser;
                document.getElementById('nav-auth').style.display = isLogged ? 'none' : 'block';
                document.getElementById('nav-user').style.display = isLogged ? 'block' : 'none';
                if(isLogged) {
                    document.getElementById('user-display-name').innerText = this.state.currentUser.name;
                    if(this.state.currentUser.role === 'admin') {
                        document.getElementById('admin-only-link').style.display = 'flex';
                    }
                }
            },

            // --- TEST CREATION ---
            saveTest() {
                const title = document.getElementById('test-title').value;
                const timer = document.getElementById('test-timer').value;
                const jsonRaw = document.getElementById('test-json').value;

                try {
                    const questions = JSON.parse(jsonRaw);
                    const newTest = {
                        id: 'test_' + Math.random().toString(36).substr(2, 9),
                        title,
                        timer: parseInt(timer),
                        questions,
                        creatorId: this.state.currentUser.id,
                        created: new Date()
                    };
                    this.state.tests.push(newTest);
                    this.saveData();
                    this.toast("Test uƒüurla yaradƒ±ldƒ±!");
                    this.showScreen('dashboard');
                } catch(e) {
                    this.toast("JSON formatƒ± s…ôhvdir!", "error");
                }
            },

            // --- DASHBOARD RENDERING ---
            renderDashboard() {
                const myTests = this.state.tests.filter(t => t.creatorId === this.state.currentUser.id);
                document.getElementById('count-my-tests').innerText = myTests.length;
                document.getElementById('dash-greeting').innerText = `Salam, ${this.state.currentUser.name}!`;

                const list = document.getElementById('my-tests-list');
                list.innerHTML = myTests.map(t => `
                    <div class="glass" style="padding: 20px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h4 style="margin:0">${t.title}</h4>
                            <small style="color: var(--text-dim)">${t.questions.length} Sual | ID: ${t.id}</small>
                        </div>
                        <div style="display:flex; gap: 10px;">
                            <button class="btn btn-ghost" onclick="app.copyLink('${t.id}')"><i class="fa-solid fa-share"></i></button>
                            <button class="btn btn-primary" onclick="app.startQuiz('${t.id}')">Ba≈üla</button>
                        </div>
                    </div>
                `).join('');
            },

            copyLink(id) {
                const link = window.location.origin + window.location.pathname + '?test=' + id;
                navigator.clipboard.writeText(link);
                this.toast("Link kopyalandƒ±! Dostlarƒ±nla payla≈ü.");
            },

            // --- QUIZ ENGINE ---
            startQuiz(testId) {
                const test = this.state.tests.find(t => t.id === testId);
                if(!test) return;

                this.state.activeQuiz = {
                    test,
                    currentIdx: 0,
                    userAnswers: [],
                    timeLeft: test.timer * 60,
                    startTime: Date.now()
                };

                this.showScreen('quiz');
                this.renderQuestion();
                this.startQuizTimer();
                
                // Anti-cheat initialization
                window.onblur = () => {
                    this.toast("Diqq…ôt! P…ônc…ôr…ôni d…ôyi≈üm…ôk qayda pozuntusudur!", "error");
                };
            },

            renderQuestion() {
                const quiz = this.state.activeQuiz;
                const q = quiz.test.questions[quiz.currentIdx];
                
                document.getElementById('quiz-q-index').innerText = `Sual ${quiz.currentIdx + 1}/${quiz.test.questions.length}`;
                document.getElementById('quiz-q-text').innerText = q.q;
                
                const optCont = document.getElementById('quiz-options');
                optCont.innerHTML = q.o.map((opt, i) => `
                    <div class="option-btn ${quiz.userAnswers[quiz.currentIdx] === i ? 'selected' : ''}" onclick="app.selectOption(${i})">
                        ${opt}
                    </div>
                `).join('');

                document.getElementById('quiz-next-btn').innerText = 
                    quiz.currentIdx === quiz.test.questions.length - 1 ? "Bitir" : "N√∂vb…ôti";
            },

            selectOption(idx) {
                this.state.activeQuiz.userAnswers[this.state.activeQuiz.currentIdx] = idx;
                this.renderQuestion();
            },

            quizNext() {
                const quiz = this.state.activeQuiz;
                if(quiz.currentIdx < quiz.test.questions.length - 1) {
                    quiz.currentIdx++;
                    this.renderQuestion();
                } else {
                    this.finishQuiz();
                }
            },

            quizPrev() {
                if(this.state.activeQuiz.currentIdx > 0) {
                    this.state.activeQuiz.currentIdx--;
                    this.renderQuestion();
                }
            },

            startQuizTimer() {
                const bar = document.getElementById('quiz-timer-bar');
                const clock = document.getElementById('quiz-clock');
                const total = this.state.activeQuiz.timeLeft;

                this.state.activeTimer = setInterval(() => {
                    this.state.activeQuiz.timeLeft--;
                    const m = Math.floor(this.state.activeQuiz.timeLeft / 60);
                    const s = this.state.activeQuiz.timeLeft % 60;
                    clock.innerText = `${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
                    
                    const percent = (this.state.activeQuiz.timeLeft / total) * 100;
                    bar.style.width = percent + "%";

                    if(this.state.activeQuiz.timeLeft <= 0) {
                        this.finishQuiz();
                        this.toast("Vaxt bitdi!", "error");
                    }
                }, 1000);
            },

            finishQuiz() {
                clearInterval(this.state.activeTimer);
                const quiz = this.state.activeQuiz;
                let correct = 0;

                quiz.test.questions.forEach((q, i) => {
                    if(quiz.userAnswers[i] === q.a) correct++;
                });

                const score = Math.round((correct / quiz.test.questions.length) * 100);
                
                confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                
                alert(`ƒ∞mtahan Bitdi!\nN…ôtic…ô: ${score}%\nD√ºzg√ºn: ${correct}\nS…ôhv: ${quiz.test.questions.length - correct}`);
                this.showScreen('dashboard');
            },

            // --- ADMIN LOGIC ---
            renderAdmin() {
                document.getElementById('admin-total-users').innerText = this.state.users.length;
                document.getElementById('admin-total-tests').innerText = this.state.tests.length;

                const table = document.getElementById('admin-user-table');
                table.innerHTML = this.state.users.map(u => `
                    <tr>
                        <td style="padding:15px">${u.name} (@${u.user})</td>
                        <td>${u.role}</td>
                        <td><span style="color:var(--success)">Aktiv</span></td>
                        <td><button class="btn btn-ghost" style="padding:5px 10px" onclick="app.deleteUser('${u.id}')">Sil</button></td>
                    </tr>
                `).join('');
            },

            deleteUser(id) {
                if(id === '1') return this.toast("Admini silm…ôk olmaz!", "error");
                this.state.users = this.state.users.filter(u => u.id !== id);
                this.saveData();
                this.renderAdmin();
            },

            // --- HELPERS ---
            saveData() {
                localStorage.setItem('em_users', JSON.stringify(this.state.users));
                localStorage.setItem('em_tests', JSON.stringify(this.state.tests));
                localStorage.setItem('em_results', JSON.stringify(this.state.results));
            }
        };

        app.init();
    </script>
</body>
</html>
