<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data Query Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --bg:#0b0f1a;--card:rgba(255,255,255,.08);--txt:#e6e9f0;--mut:#aab0c0;
  --pri:#6cf;--acc:#9f6cff;--ok:#3ddc97;--bad:#ff6b6b;
}
*{box-sizing:border-box;font-family:Inter,system-ui}
body{margin:0;background:radial-gradient(1200px 600px at 10% -10%,#1a1f3a,transparent),
radial-gradient(900px 500px at 110% 10%,#2a1f3a,transparent),var(--bg);color:var(--txt)}
a{color:var(--pri);text-decoration:none}
.hidden{display:none}
.container{max-width:1200px;margin:auto;padding:24px}
.header{position:sticky;top:0;backdrop-filter:blur(12px);background:rgba(5,8,18,.6);z-index:5}
.header .container{display:flex;gap:12px;align-items:center;justify-content:space-between}
.brand{font-weight:800;letter-spacing:.5px}
.btn{background:linear-gradient(135deg,var(--pri),var(--acc));border:none;color:#000;
padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:700}
.btn.ghost{background:transparent;color:var(--txt);border:1px solid rgba(255,255,255,.15)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:14px}
.card{background:var(--card);backdrop-filter:blur(14px);border-radius:16px;padding:14px;
box-shadow:0 10px 30px rgba(0,0,0,.25)}
.card h3{margin:0 0 8px 0}
.input{width:100%;padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,.15);
background:rgba(0,0,0,.3);color:var(--txt)}
.row{display:flex;gap:10px;flex-wrap:wrap}
.badge{padding:4px 8px;border-radius:999px;font-size:12px}
.badge.ok{background:rgba(61,220,151,.15);color:var(--ok)}
.badge.bad{background:rgba(255,107,107,.15);color:var(--bad)}
.kv{display:grid;grid-template-columns:1fr 1fr;gap:6px}
.kv div{font-size:13px;color:var(--mut)}
.footer{opacity:.7;text-align:center;padding:30px}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.6);display:flex;align-items:center;justify-content:center}
.modal .card{max-width:520px;width:100%}
.toggle{cursor:pointer}
.spinner{width:28px;height:28px;border:3px solid rgba(255,255,255,.2);border-top-color:#fff;border-radius:50%;
animation:spin 1s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>
<body>

<header class="header">
  <div class="container">
    <div class="brand">üîé Data Query Dashboard</div>
    <div class="row">
      <button id="logoutBtn" class="btn ghost hidden">√áƒ±xƒ±≈ü</button>
      <button id="themeBtn" class="btn ghost">üåô/‚òÄÔ∏è</button>
    </div>
  </div>
</header>

<div class="container">

<!-- AUTH -->
<section id="auth" class="grid">
  <div class="card">
    <h3>Giri≈ü</h3>
    <input id="l_user" class="input" placeholder="ƒ∞stifad…ô√ßi adƒ±">
    <input id="l_pass" class="input" type="password" placeholder="≈ûifr…ô">
    <button class="btn" onclick="login()">Daxil ol</button>
  </div>
  <div class="card">
    <h3>Qeydiyyat</h3>
    <input id="r_user" class="input" placeholder="ƒ∞stifad…ô√ßi adƒ±">
    <input id="r_pass" class="input" type="password" placeholder="≈ûifr…ô">
    <button class="btn" onclick="register()">Qeydiyyat</button>
  </div>
</section>

<!-- APP -->
<section id="app" class="hidden">
  <div class="grid">
    <div class="card">
      <h3>Axtarƒ±≈ü</h3>
      <input id="q" class="input" placeholder="Ad / Soyad / ≈û…ôh…ôr / Telefon / ƒ∞l">
      <div class="row">
        <button class="btn ghost" onclick="reloadTxt()">TXT yenil…ô</button>
        <span id="count" class="badge ok"></span>
      </div>
    </div>

    <div class="card">
      <h3>IP & Konum</h3>
      <label><input type="checkbox" id="consent"> Razƒ±yam, IP/konumumu g√∂st…ôr</label>
      <button class="btn ghost" onclick="getIP()">G√∂st…ôr</button>
      <div id="ipBox" class="kv"></div>
    </div>

    <div class="card">
      <h3>Statistika</h3>
      <canvas id="chart"></canvas>
    </div>
  </div>

  <h3 style="margin-top:20px">N…ôtic…ôl…ôr</h3>
  <div id="list" class="grid"></div>
</section>
</div>

<div id="modal" class="modal hidden">
  <div class="card">
    <h3>Profil</h3>
    <div id="profile" class="kv"></div>
    <button class="btn ghost" onclick="closeModal()">Baƒüla</button>
  </div>
</div>

<footer class="footer">¬© Dashboard</footer>

<script>
/* ====== THEME ====== */
const themeBtn=document.getElementById('themeBtn');
themeBtn.onclick=()=>document.body.classList.toggle('light');

/* ====== AUTH ====== */
const auth=document.getElementById('auth');
const app=document.getElementById('app');
const logoutBtn=document.getElementById('logoutBtn');
const ADMIN={u:'cesi',p:'cesi123'};
const hash=s=>crypto.subtle.digest('SHA-256',new TextEncoder().encode(s))
.then(b=>Array.from(new Uint8Array(b)).map(x=>x.toString(16).padStart(2,'0')).join(''));

async function register(){
  const u=r_user.value.trim(),p=r_pass.value;
  if(!u||!p) return alert('Bo≈ü olmaz');
  const h=await hash(p); localStorage.setItem('u_'+u,h); alert('Hazƒ±rdƒ±r');
}
async function login(){
  const u=l_user.value.trim(),p=l_pass.value;
  if(u===ADMIN.u && p===ADMIN.p){session('admin');return}
  const h=await hash(p),s=localStorage.getItem('u_'+u);
  if(h===s){session('user')} else alert('Yanlƒ±≈ü');
}
function session(role){
  localStorage.setItem('sess',role);
  auth.classList.add('hidden'); app.classList.remove('hidden'); logoutBtn.classList.remove('hidden');
  loadTxt();
}
logoutBtn.onclick=()=>{localStorage.removeItem('sess');location.reload()}

/* ====== DATA ====== */
let DATA=[];
async function loadTxt(){
  const r=await fetch('cesisorgu.txt',{cache:'no-store'});
  const t=await r.text();
  DATA=t.split('\n').map(l=>{
    const [soyad,ad,il,seher,tel]=l.split('|').map(x=>x?.trim());
    if(!ad||!tel) return null;
    return {soyad,ad,il:+il,seher,tel};
  }).filter(Boolean);
  document.getElementById('count').textContent=DATA.length+' qeyd';
  render(DATA); stats();
}
function reloadTxt(){loadTxt()}

/* ====== SEARCH & RENDER ====== */
q.oninput=()=>render(DATA.filter(d=>JSON.stringify(d).toLowerCase().includes(q.value.toLowerCase())));
function render(arr){
  list.innerHTML='';
  arr.forEach(d=>{
    const c=document.createElement('div'); c.className='card';
    c.innerHTML=`<h3>${d.ad} ${d.soyad}</h3>
    <div class="kv">
      <div>≈û…ôh…ôr: ${d.seher}</div><div>ƒ∞l: ${d.il}</div>
      <div>Telefon: ${d.tel}</div><div>${operator(d.tel)}</div>
    </div>
    <button class="btn ghost">Profil</button>`;
    c.querySelector('button').onclick=()=>profile(d);
    list.appendChild(c);
  });
}

/* ====== PROFILE ====== */
function operator(t){
  if(/^05[01]/.test(t)) return 'Azercell';
  if(/^055/.test(t)) return 'Bakcell';
  if(/^07[07]/.test(t)) return 'Nar';
  return 'Nam…ôlum';
}
function profile(d){
  const age=new Date().getFullYear()-d.il;
  profileBox=`<div>Ad: ${d.ad}</div><div>Soyad: ${d.soyad}</div>
  <div>≈û…ôh…ôr: ${d.seher}</div><div>Ya≈ü: ${age}</div>
  <div>Telefon: ${d.tel}</div><div>Operator: ${operator(d.tel)}</div>`;
  profileEl.innerHTML=profileBox; modal.classList.remove('hidden');
}
function closeModal(){modal.classList.add('hidden')}

/* ====== IP (CONSENT) ====== */
async function getIP(){
  if(!consent.checked) return alert('Razƒ±lƒ±q lazƒ±mdƒ±r');
  ipBox.innerHTML='<div class="spinner"></div>';
  const r=await fetch('https://ipapi.co/json/');
  const j=await r.json();
  ipBox.innerHTML=`
  <div>IP: ${j.ip}</div><div>√ñlk…ô: ${j.country_name}</div>
  <div>≈û…ôh…ôr: ${j.city}</div><div>ISP: ${j.org}</div>`;
}

/* ====== STATS ====== */
let chart;
function stats(){
  const m={}; DATA.forEach(d=>m[d.seher]=(m[d.seher]||0)+1);
  const ctx=document.getElementById('chart');
  chart?.destroy();
  chart=new Chart(ctx,{type:'bar',data:{labels:Object.keys(m),
  datasets:[{data:Object.values(m)}]}});
}

/* ====== INIT ====== */
if(localStorage.getItem('sess')) session(localStorage.getItem('sess'));
</script>
</body>
</html>