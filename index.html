<!DOCTYPE html>
<html lang="az" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExamMaster Ultra Pro | Startup Edition</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --neon-primary: #6366f1;
            --neon-secondary: #06b6d4;
            --glass-bg: rgba(15, 23, 42, 0.8);
        }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: #020617;
            color: #f8fafc;
            overflow-x: hidden;
        }
        .glass {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .neon-border {
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.3);
            border: 1px solid rgba(99, 102, 241, 0.5);
        }
        .animate-slide-up {
            animation: slideUp 0.5s ease-out;
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Custom Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
    </style>
</head>
<body class="min-h-screen">

    <div id="app" class="relative min-h-screen pb-12">
        <nav class="glass sticky top-0 z-50 px-6 py-4 flex justify-between items-center mb-8">
            <div class="flex items-center gap-2 cursor-pointer" onclick="router.navigate('home')">
                <div class="p-2 bg-indigo-600 rounded-lg shadow-lg shadow-indigo-500/50">
                    <i data-lucide="graduation-cap" class="text-white"></i>
                </div>
                <span class="text-xl font-800 bg-gradient-to-r from-white to-indigo-400 bg-clip-text text-transparent">
                    EXAMMASTER <span class="text-xs font-bold border border-indigo-500 px-1 rounded ml-1">ULTRA</span>
                </span>
            </div>
            
            <div id="nav-actions" class="flex items-center gap-4">
                </div>
        </nav>

        <main id="main-view" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            </main>

        <div id="toast-container" class="fixed bottom-5 right-5 z-[100]"></div>
    </div>

    <script>
        // --- 1. CONFIGURATION & STATE ---
        const CONFIG = {
            ADMIN_USER: "cesi",
            ADMIN_PASS: "cesi123"
        };

        let state = {
            users: JSON.parse(localStorage.getItem('em_users')) || [],
            currentUser: JSON.parse(localStorage.getItem('em_session')) || null,
            tests: JSON.parse(localStorage.getItem('em_tests')) || [],
            attempts: JSON.parse(localStorage.getItem('em_attempts')) || [],
            currentView: 'home',
            activeQuiz: null
        };

        // --- 2. CORE SERVICES ---
        const storage = {
            save() {
                localStorage.setItem('em_users', JSON.stringify(state.users));
                localStorage.setItem('em_tests', JSON.stringify(state.tests));
                localStorage.setItem('em_attempts', JSON.stringify(state.attempts));
                localStorage.setItem('em_session', JSON.stringify(state.currentUser));
            }
        };

        const auth = {
            login(user, pass) {
                if (user === CONFIG.ADMIN_USER && pass === CONFIG.ADMIN_PASS) {
                    state.currentUser = { username: 'Admin Cesi', role: 'admin', id: 'admin' };
                } else {
                    const u = state.users.find(u => u.username === user && u.password === pass);
                    if (!u) return false;
                    state.currentUser = u;
                }
                storage.save();
                return true;
            },
            logout() {
                state.currentUser = null;
                storage.save();
                router.navigate('home');
            }
        };

        // --- 3. UI ENGINE (ROUTER & VIEWS) ---
        const router = {
            navigate(view, params = null) {
                state.currentView = view;
                this.render(params);
                window.scrollTo(0,0);
            },
            render(params) {
                const main = document.getElementById('main-view');
                const navActions = document.getElementById('nav-actions');
                
                // Update Nav
                if (state.currentUser) {
                    navActions.innerHTML = `
                        <span class="text-sm text-slate-400 hidden md:inline">Xoş gəldin, <b>${state.currentUser.username}</b></span>
                        <button onclick="router.navigate('dashboard')" class="p-2 hover:bg-slate-800 rounded-full"><i data-lucide="layout-dashboard"></i></button>
                        <button onclick="auth.logout()" class="text-red-400 hover:text-red-300 ml-2"><i data-lucide="log-out"></i></button>
                    `;
                } else {
                    navActions.innerHTML = `
                        <button onclick="router.navigate('login')" class="text-sm font-semibold hover:text-indigo-400 transition">Giriş</button>
                        <button onclick="router.navigate('register')" class="bg-indigo-600 px-4 py-2 rounded-lg text-sm font-bold shadow-lg shadow-indigo-500/30 hover:bg-indigo-500 transition">Qeydiyyat</button>
                    `;
                }

                // Route Handler
                switch(state.currentView) {
                    case 'home': main.innerHTML = views.home(); break;
                    case 'login': main.innerHTML = views.login(); break;
                    case 'register': main.innerHTML = views.register(); break;
                    case 'dashboard': 
                        if(!state.currentUser) return this.navigate('login');
                        main.innerHTML = state.currentUser.role === 'admin' ? views.adminPanel() : views.dashboard(); 
                        break;
                    case 'create-test': main.innerHTML = views.createTest(); break;
                    case 'quiz': main.innerHTML = views.quiz(params); break;
                    case 'results': main.innerHTML = views.results(params); break;
                }
                lucide.createIcons();
            }
        };

        // --- 4. VIEW TEMPLATES ---
        const views = {
            home: () => `
                <div class="flex flex-col items-center text-center py-20 animate-slide-up">
                    <h1 class="text-5xl md:text-7xl font-900 mb-6 bg-gradient-to-b from-white to-slate-500 bg-clip-text text-transparent leading-tight">
                        İntellektual İmtahan <br> Platforması
                    </h1>
                    <p class="text-slate-400 max-w-2xl text-lg mb-10">
                        Google Forms sadəliyi, Kahoot rəqabəti və Udemy keyfiyyəti bir arada. Testlərinizi saniyələr içində yaradın və paylaşın.
                    </p>
                    <div class="flex gap-4">
                        <button onclick="router.navigate('dashboard')" class="bg-indigo-600 px-8 py-4 rounded-xl font-bold text-lg shadow-xl shadow-indigo-500/20 hover:scale-105 transition active:scale-95">Başla</button>
                        <button class="glass px-8 py-4 rounded-xl font-bold text-lg hover:bg-white/5 transition">Demo</button>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-20">
                    ${['Sürətli', 'Təhlükəsiz', 'Analitik'].map(item => `
                        <div class="glass p-8 rounded-2xl border-white/5">
                            <div class="w-12 h-12 bg-indigo-500/10 rounded-lg flex items-center justify-center mb-4">
                                <i data-lucide="zap" class="text-indigo-500"></i>
                            </div>
                            <h3 class="text-xl font-bold mb-2">${item}</h3>
                            <p class="text-slate-400">Startup səviyyəsində performans və modern UI ilə bütün testlər nəzarət altında.</p>
                        </div>
                    `).join('')}
                </div>
            `,

            login: () => `
                <div class="max-w-md mx-auto glass p-8 rounded-3xl animate-slide-up">
                    <h2 class="text-3xl font-bold mb-6">Giriş</h2>
                    <input id="login-user" type="text" placeholder="İstifadəçi adı" class="w-full bg-slate-900 border border-slate-700 p-4 rounded-xl mb-4 focus:border-indigo-500 outline-none">
                    <input id="login-pass" type="password" placeholder="Şifrə" class="w-full bg-slate-900 border border-slate-700 p-4 rounded-xl mb-6 focus:border-indigo-500 outline-none">
                    <button onclick="actions.handleLogin()" class="w-full bg-indigo-600 p-4 rounded-xl font-bold hover:bg-indigo-500 transition shadow-lg shadow-indigo-500/30">Daxil ol</button>
                </div>
            `,

            dashboard: () => {
                const myTests = state.tests.filter(t => t.creatorId === state.currentUser.id);
                return `
                    <div class="flex justify-between items-center mb-10">
                        <h2 class="text-3xl font-bold">Mənim Panelim</h2>
                        <button onclick="router.navigate('create-test')" class="bg-indigo-600 px-6 py-3 rounded-xl font-bold flex items-center gap-2">
                            <i data-lucide="plus"></i> Yeni Test
                        </button>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        ${myTests.length ? myTests.map(t => `
                            <div class="glass p-6 rounded-2xl border-white/10 hover:neon-border transition cursor-pointer group">
                                <div class="flex justify-between items-start mb-4">
                                    <div class="p-3 bg-indigo-500/10 rounded-xl"><i data-lucide="file-text" class="text-indigo-400"></i></div>
                                    <span class="text-xs bg-slate-800 px-2 py-1 rounded text-slate-400">${t.category}</span>
                                </div>
                                <h3 class="text-xl font-bold mb-1">${t.title}</h3>
                                <p class="text-slate-400 text-sm mb-4 line-clamp-2">${t.desc}</p>
                                <div class="flex items-center justify-between mt-6">
                                    <span class="text-xs text-slate-500">${t.questions.length} Sual</span>
                                    <button onclick="actions.startQuiz('${t.id}')" class="text-indigo-400 font-bold group-hover:translate-x-1 transition flex items-center gap-1">Testə başla <i data-lucide="chevron-right" class="w-4 h-4"></i></button>
                                </div>
                            </div>
                        `).join('') : `<p class="text-slate-500 col-span-3 text-center py-20 glass rounded-3xl">Hələ test yaratmamısınız.</p>`}
                    </div>
                `;
            },

            createTest: () => `
                <div class="max-w-4xl mx-auto animate-slide-up">
                    <div class="flex items-center gap-4 mb-8">
                        <button onclick="router.navigate('dashboard')" class="p-2 glass rounded-full"><i data-lucide="arrow-left"></i></button>
                        <h2 class="text-3xl font-bold">Yeni Test Yarat</h2>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div class="space-y-4">
                            <div class="glass p-6 rounded-2xl">
                                <h3 class="font-bold mb-4 text-indigo-400">Ümumi Məlumat</h3>
                                <input id="test-title" type="text" placeholder="Testin adı" class="w-full bg-slate-900 border border-slate-700 p-3 rounded-lg mb-4 outline-none">
                                <textarea id="test-desc" placeholder="Açıqlama" class="w-full bg-slate-900 border border-slate-700 p-3 rounded-lg mb-4 outline-none h-24"></textarea>
                                <div class="grid grid-cols-2 gap-4">
                                    <select id="test-cat" class="bg-slate-900 border border-slate-700 p-3 rounded-lg outline-none">
                                        <option>Proqramlaşdırma</option>
                                        <option>Riyaziyyat</option>
                                        <option>Məntiq</option>
                                    </select>
                                    <input id="test-timer" type="number" placeholder="Vaxt (dəq)" class="bg-slate-900 border border-slate-700 p-3 rounded-lg outline-none">
                                </div>
                            </div>
                        </div>
                        <div class="glass p-6 rounded-2xl">
                            <h3 class="font-bold mb-4 text-emerald-400">Sual Bazası (JSON)</h3>
                            <p class="text-xs text-slate-500 mb-2">Format: [{"q":"Sual?","o":["A","B"],"a":0}]</p>
                            <textarea id="test-json" class="w-full bg-slate-900 border border-slate-700 p-3 rounded-lg outline-none h-64 font-mono text-xs" placeholder="JSON kodunu bura yapışdırın..."></textarea>
                            <button onclick="actions.handleCreateTest()" class="w-full bg-indigo-600 mt-4 p-4 rounded-xl font-bold hover:bg-indigo-500 shadow-lg shadow-indigo-500/20">Testi Yayımla</button>
                        </div>
                    </div>
                </div>
            `,

            quiz: (testId) => {
                const test = state.tests.find(t => t.id === testId);
                state.activeQuiz = { test, current: 0, answers: [], timeLeft: test.timer * 60, startTime: Date.now() };
                startQuizTimer();
                return `
                    <div class="max-w-3xl mx-auto">
                        <div class="flex justify-between items-center mb-8 glass p-4 rounded-2xl px-6">
                            <div class="flex items-center gap-2">
                                <i data-lucide="clock" class="text-indigo-400"></i>
                                <span id="timer-display" class="font-mono text-xl font-bold">00:00</span>
                            </div>
                            <div class="flex-1 mx-8 h-2 bg-slate-800 rounded-full overflow-hidden">
                                <div id="quiz-progress" class="h-full bg-indigo-500 transition-all duration-500" style="width: 0%"></div>
                            </div>
                            <button onclick="actions.submitQuiz()" class="bg-red-500/10 text-red-400 px-4 py-2 rounded-lg font-bold hover:bg-red-500 hover:text-white transition">Bitir</button>
                        </div>
                        
                        <div id="question-container" class="glass p-10 rounded-3xl border-white/10 min-h-[400px]">
                            </div>

                        <div class="flex justify-between mt-8">
                            <button onclick="actions.prevQuestion()" class="glass px-6 py-3 rounded-xl font-bold flex items-center gap-2 hover:bg-white/5"><i data-lucide="chevron-left"></i> Geri</button>
                            <button onclick="actions.nextQuestion()" id="next-btn" class="bg-indigo-600 px-8 py-3 rounded-xl font-bold flex items-center gap-2 hover:bg-indigo-500 transition">Növbəti <i data-lucide="chevron-right"></i></button>
                        </div>
                    </div>
                `;
            }
        };

        // --- 5. LOGIC & ACTIONS ---
        const actions = {
            handleLogin() {
                const u = document.getElementById('login-user').value;
                const p = document.getElementById('login-pass').value;
                if (auth.login(u, p)) router.navigate('dashboard');
                else alert('Səhv məlumat!');
            },

            handleCreateTest() {
                const title = document.getElementById('test-title').value;
                const jsonStr = document.getElementById('test-json').value;
                try {
                    const questions = JSON.parse(jsonStr);
                    const newTest = {
                        id: 't' + Date.now(),
                        creatorId: state.currentUser.id,
                        title,
                        desc: document.getElementById('test-desc').value,
                        category: document.getElementById('test-cat').value,
                        timer: parseInt(document.getElementById('test-timer').value) || 10,
                        questions: questions.map((q, i) => ({ ...q, id: i }))
                    };
                    state.tests.push(newTest);
                    storage.save();
                    router.navigate('dashboard');
                } catch(e) {
                    alert('JSON formatı səhvdir!');
                }
            },

            startQuiz(id) {
                router.navigate('quiz', id);
                this.renderQuestion();
            },

            renderQuestion() {
                const qCont = document.getElementById('question-container');
                const quiz = state.activeQuiz;
                const question = quiz.test.questions[quiz.current];
                
                // Progress
                const progress = ((quiz.current + 1) / quiz.test.questions.length) * 100;
                document.getElementById('quiz-progress').style.width = `${progress}%`;

                qCont.innerHTML = `
                    <span class="text-indigo-400 font-bold mb-4 block">Sual ${quiz.current + 1}</span>
                    <h2 class="text-2xl font-bold mb-8 leading-relaxed">${question.q}</h2>
                    <div class="grid grid-cols-1 gap-4">
                        ${question.o.map((opt, i) => `
                            <button onclick="actions.selectOption(${i})" class="w-full text-left p-5 rounded-2xl border ${quiz.answers[quiz.current] === i ? 'border-indigo-500 bg-indigo-500/10' : 'border-white/5 hover:bg-white/5'} transition-all">
                                <span class="inline-block w-8 h-8 rounded-lg bg-slate-800 text-center leading-8 mr-4 text-xs font-bold">${String.fromCharCode(65+i)}</span>
                                ${opt}
                            </button>
                        `).join('')}
                    </div>
                `;
                lucide.createIcons();
            },

            selectOption(idx) {
                state.activeQuiz.answers[state.activeQuiz.current] = idx;
                this.renderQuestion();
            },

            nextQuestion() {
                if (state.activeQuiz.current < state.activeQuiz.test.questions.length - 1) {
                    state.activeQuiz.current++;
                    this.renderQuestion();
                } else {
                    this.submitQuiz();
                }
            },

            submitQuiz() {
                clearInterval(quizInterval);
                const quiz = state.activeQuiz;
                let correct = 0;
                quiz.test.questions.forEach((q, i) => {
                    if(quiz.answers[i] === q.a) correct++;
                });

                const result = {
                    id: 'r' + Date.now(),
                    testId: quiz.test.id,
                    userId: state.currentUser?.id || 'guest',
                    score: Math.round((correct / quiz.test.questions.length) * 100),
                    correct,
                    total: quiz.test.questions.length
                };
                
                state.attempts.push(result);
                storage.save();
                
                // Confetti if high score
                if(result.score > 70) confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                
                alert(`İmtahan bitdi! Nəticə: ${result.score}%`);
                router.navigate('dashboard');
            }
        };

        let quizInterval;
        function startQuizTimer() {
            quizInterval = setInterval(() => {
                if (state.activeQuiz.timeLeft <= 0) {
                    actions.submitQuiz();
                    return;
                }
                state.activeQuiz.timeLeft--;
                const mins = Math.floor(state.activeQuiz.timeLeft / 60);
                const secs = state.activeQuiz.timeLeft % 60;
                const display = document.getElementById('timer-display');
                if(display) display.innerText = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }, 1000);
        }

        // --- 6. INITIALIZATION ---
        window.onload = () => {
            router.navigate('home');
            
            // Anti-cheat mock
            window.addEventListener('blur', () => {
                if(state.currentView === 'quiz') {
                    console.warn("Anti-cheat: Tab switched!");
                }
            });
        };
    </script>
</body>
</html>
