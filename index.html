<!DOCTYPE html>
<html lang="az">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CyberWrapped â€” TikTok Wrapped</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<style>
:root{
  --bg:#04040b;
  --neon-p:#ff2fa3;
  --neon-c:#00ffd6;
  --glass: rgba(255,255,255,0.03);
  --muted:#bcd5f0;
}
*{box-sizing:border-box;}
html,body{margin:0;padding:0;height:100%;font-family:'Poppins',sans-serif;background:linear-gradient(180deg,var(--bg),#03040a);}
.app{max-width:1200px;margin:0 auto;padding:20px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:16px;color:#eaf2ff;}
.header{display:flex;align-items:center;gap:12px;}
.logo{width:64px;height:64px;border-radius:14px;background:linear-gradient(135deg,var(--neon-c),var(--neon-p));display:flex;justify-content:center;align-items:center;font-weight:900;color:#001;font-size:28px;}
.hmeta .title{font-weight:800;font-size:22px;}
.hmeta .sub{color:var(--muted);font-size:13px;}
.controls{margin-top:16px;display:flex;gap:12px;flex-wrap:wrap;}
.btn{padding:10px 14px;border-radius:12px;border:none;cursor:pointer;font-weight:700;background:linear-gradient(90deg,var(--neon-p),#ff7bc1);color:#001;box-shadow:0 12px 30px rgba(255,47,163,0.08);}
.btn.alt{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04);box-shadow:none;}
.drop{margin-top:14px;border-radius:12px;padding:14px;background:var(--glass);border:1px dashed rgba(255,255,255,0.03);display:flex;gap:12px;align-items:center;transition:all .15s ease;}
.drop.drag{transform:translateY(-6px);box-shadow:0 18px 50px rgba(0,255,214,0.06);border-color:rgba(0,255,214,0.12);}
.grid{margin-top:18px;display:grid;grid-template-columns:360px 1fr;gap:16px;}
@media(max-width:980px){.grid{grid-template-columns:1fr;}.logo{display:none;}}
.left,.right{padding:12px;border-radius:12px;background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02);min-height:520px;}
.avatar{display:flex;gap:12px;align-items:center;}
.pic{width:96px;height:96px;border-radius:16px;background:linear-gradient(135deg,var(--neon-c),var(--neon-p));display:flex;align-items:center;justify-content:center;font-weight:900;color:#001;font-size:26px;overflow:hidden;}
.pic img{width:100%;height:100%;object-fit:cover;}
.meta h2{margin:0;font-size:20px;font-weight:800;}
.meta .small{margin-top:6px;color:var(--muted);font-size:13px;}
.kpis{margin-top:12px;display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.kpi{padding:12px;border-radius:10px;background:rgba(255,255,255,0.015);border:1px solid rgba(255,255,255,0.02);text-align:center;}
.kpi .n{font-weight:900;font-size:20px;color:var(--neon-p);}
.kpi .s{color:var(--muted);font-size:13px;margin-top:6px;}
.vlist{margin-top:12px;max-height:260px;overflow:auto;display:grid;gap:8px;padding-right:6px;}
.vcard{display:flex;gap:10px;align-items:center;padding:8px;border-radius:10px;background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);border:1px solid rgba(255,255,255,0.02);transition: transform .25s ease;}
.vcard:hover{transform: perspective(600px) rotateX(6deg) translateY(-6px) scale(1.01);box-shadow:0 20px 40px rgba(0,0,0,0.5);}
.vcard img{width:76px;height:76px;border-radius:10px;object-fit:cover;}
.right .preview-top{display:flex;justify-content:space-between;align-items:center;gap:10px;}
.big-title{font-size:20px;font-weight:800;}
.chart-wrap{margin-top:12px;display:flex;gap:12px;align-items:center;}
.chart-block{flex:1;padding:10px;border-radius:12px;background: rgba(0,0,0,0.18);border:1px solid rgba(255,255,255,0.02);}
.analysis{margin-top:12px;padding:12px;border-radius:10px;background: linear-gradient(90deg, rgba(0,0,0,0.18), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.02);color:var(--muted);}
.analysis h4{margin:0 0 8px 0;color:var(--neon-c);}
.vlist::-webkit-scrollbar{width:8px;}
.vlist::-webkit-scrollbar-thumb{background:linear-gradient(180deg,var(--neon-p),var(--neon-c));border-radius:8px;}
</style>
</head>
<body>
<div class="app">
  <div class="header">
    <div class="logo">W</div>
    <div class="hmeta">
      <div class="title">CyberWrapped â€” Ultra TikTok Wrapped</div>
      <div class="sub">JSON / ZIP / TXT Â· Cyberpunk visuals Â· Charts & AI analysis</div>
    </div>
  </div>
  <div class="controls">
    <button class="btn" id="btn-json">ğŸ“„ JSON seÃ§</button>
    <button class="btn" id="btn-zip">ğŸ—œï¸ ZIP seÃ§</button>
    <button class="btn alt" id="btn-reset">â™»ï¸ Reset</button>
  </div>
  <div class="drop" id="drop">
    <div>
      <div style="font-weight:800">FaylÄ± sÃ¼rÃ¼ÅŸdÃ¼r vÉ™ burax â€” JSON / ZIP / TXT</div>
      <div class="small">ZIP iÃ§indÉ™ki .json/.txt/.png fayllarÄ± oxunur</div>
    </div>
  </div>
  <div class="grid">
    <div class="left">
      <div class="avatar">
        <div class="pic" id="pic">CZ</div>
        <div class="meta">
          <h2 id="display_name">â€”</h2>
          <div class="small" id="username">@â€”</div>
          <div class="small" id="files-info">Files: 0 JSON Â· 0 TXT Â· 0 images</div>
        </div>
      </div>
      <div class="kpis">
        <div class="kpi"><div class="n" id="k_views">0</div><div class="s">ğŸ‘ï¸ Views</div></div>
        <div class="kpi"><div class="n" id="k_likes">0</div><div class="s">â¤ï¸ Likes</div></div>
        <div class="kpi"><div class="n" id="k_videos">0</div><div class="s">ğŸ¬ Videos</div></div>
      </div>
      <div class="vlist" id="vlist"></div>
    </div>
    <div class="right">
      <div class="preview-top">
        <div class="big-title">Wrapped Preview</div>
        <div class="emoji">ğŸ”¥ ğŸ“ˆ ğŸ’–</div>
      </div>
      <div class="chart-wrap">
        <div class="chart-block"><canvas id="chartViews" height="140"></canvas></div>
        <div class="chart-block"><canvas id="chartLikes" height="140"></canvas></div>
      </div>
      <div class="analysis" id="analysis">
        <h4>AI Analiz</h4>
        <div id="analysisText">HeÃ§ bir data yoxdur â€” fayl yÃ¼klÉ™.</div>
      </div>
    </div>
  </div>
</div>

<input type="file" id="fjson" accept=".json" style="display:none;">
<input type="file" id="fzip" accept=".zip" style="display:none;">

<script>
// ---- Helper functions ----
const el=id=>document.getElementById(id);
const fmt=n=>n>=1e9? (n/1e9).toFixed(1)+'B':n>=1e6? (n/1e6).toFixed(1)+'M':n>=1e3? (n/1e3).toFixed(1)+'K':n;

// ---- State ----
let state={jsonCount:0,txtCount:0,imgCount:0,totalViews:0,totalLikes:0,totalVideos:0,videos:[],zipImages:{}};

// ---- File inputs ----
el('btn-json').onclick=()=>el('fjson').click();
el('btn-zip').onclick=()=>el('fzip').click();
el('fjson').addEventListener('change',async e=>{if(e.target.files[0])await handleJSON(e.target.files[0]);e.target.value='';});
el('fzip').addEventListener('change',async e=>{if(e.target.files[0])await handleZIP(e.target.files[0]);e.target.value='';});

// ---- Drag & drop ----
const drop=el('drop');
['dragenter','dragover'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();drop.classList.add('drag');}));
['dragleave','drop'].forEach(ev=>drop.addEventListener(ev,e=>{e.preventDefault();drop.classList.remove('drag');}));
drop.addEventListener('drop',async e=>{
  const f=e.dataTransfer.files[0];
  if(!f)return;
  if(f.name.toLowerCase().endsWith('.zip')) await handleZIP(f);
  else if(f.name.toLowerCase().endsWith('.json')) await handleJSON(f);
  else if(f.name.toLowerCase().endsWith('.txt')) await handleTXT(f);
  else alert('YalnÄ±z .zip / .json / .txt fayllarÄ± qÉ™bul olunur.');
});

// ---- Handlers ----
async function handleJSON(file){
  try{
    const text=await file.text();
    const obj=JSON.parse(text);
    state.jsonCount++;
    extractFromJSON(obj);
    renderAll();
  }catch(e){ alert('JSON Parse xÉ™tasÄ± â€” faylÄ± yoxla'); }
}

async function handleTXT(file){
  const txt=await file.text();
  state.txtCount++;
  parseTXT(txt);
  renderAll();
}

async function handleZIP(file){
  try{
    const buffer=await file.arrayBuffer();
    const zip=await JSZip.loadAsync(buffer);
    for(const name of Object.keys(zip.files)){
      const f=zip.files[name];
      if(f.dir) continue;
      const low=name.toLowerCase();
      if(low.endsWith('.json')){
        const txt=await f.async('string');
        try{ extractFromJSON(JSON.parse(txt)); state.jsonCount++; }catch(e){console.warn('JSON fail',name);}
      }else if(low.endsWith('.txt')){
        const txt=await f.async('string'); parseTXT(txt); state.txtCount++;
      }else if(/\.(png|jpe?g|webp|gif)$/.test(low)){
        const blob=await f.async('blob'); state.imgCount++;
        state.zipImages[name]=URL.createObjectURL(blob);
      }
    }
    renderAll();
  }catch(e){alert('ZIP oxunarkÉ™n xÉ™ta: '+(e.message||e));}
}

// ---- Parsing ----
function extractFromJSON(obj){
  if(!obj||typeof obj!=='object') return;
  if(typeof obj.total_views==='number') state.totalViews+=obj.total_views;
  if(typeof obj.total_likes==='number') state.totalLikes+=obj.total_likes;
  if(typeof obj.total_videos==='number') state.totalVideos+=obj.total_videos;
  // video array detection
  for(const k in obj){
    const v=obj[k];
    if(Array.isArray(v)&&v.length>0&&typeof v[0]==='object'){
      for(const vid of v){
        const title=vid.title||vid.name||vid.caption||'Untitled';
        const views=Number(vid.views||vid.view_count||0);
        const likes=Number(vid.likes||vid.like_count||0);
        const thumb=vid.thumbnail||vid.thumb||'';
        state.videos.push({title,views,likes,thumb});
      }
    }
  }
}
function parseTXT(txt){
  const lines=txt.split(/\r?\n/);
  for(const line of lines){
    const m=line.match(/(views|likes)[^0-9]*([0-9,]+)/i);
    if(m){
      const n=Number(m[2].replace(/,/g,''));
      if(/view/i.test(m[1])) state.totalViews+=n;
      if(/like/i.test(m[1])) state.totalLikes+=n;
    }
  }
}

// ---- Render ----
function renderAll(){
  el('files-info').textContent=`Files: ${state.jsonCount} JSON Â· ${state.txtCount} TXT Â· ${state.imgCount} images`;
  el('k_views').textContent=fmt(state.totalViews);
  el('k_likes').textContent=fmt(state.totalLikes);
  el('k_videos').textContent=state.totalVideos;
  // videos
  const vlist=el('vlist'); vlist.innerHTML='';
  for(const v of state.videos.slice(0,30)){
    const thumb=v.thumb||'https://placehold.co/76x76?text=Video';
    vlist.insertAdjacentHTML('beforeend',`<div class="vcard"><img src="${thumb}"><div><div style="font-weight:800">${v.title}</div><div class="small">ğŸ‘ï¸ ${fmt(v.views)} Â· â¤ï¸ ${fmt(v.likes)}</div></div></div>`);
  }
  renderCharts();
  renderAnalysis();
}

// ---- Charts ----
let chartViews=null, chartLikes=null;
function renderCharts(){
  const top=state.videos.slice(0,10).reverse();
  const labels=top.map(v=>v.title.slice(0,18));
  const viewsData=top.map(v=>v.views);
  const likesData=top.map(v=>v.likes);
  if(chartViews) chartViews.destroy();
  if(chartLikes) chartLikes.destroy();
  chartViews=new Chart(el('chartViews').getContext('2d'),{
    type:'bar',data:{labels,datasets:[{label:'Views',data:viewsData,backgroundColor:'rgba(255,47,163,0.9)'}]},
    options:{responsive:true,plugins:{legend:{display:false}}}
  });
  chartLikes=new Chart(el('chartLikes').getContext('2d'),{
    type:'bar',data:{labels,datasets:[{label:'Likes',data:likesData,backgroundColor:'rgba(0,255,214,0.9)'}]},
    options:{responsive:true,plugins:{legend:{display:false}}}
  });
}

// ---- Simple AI analysis ----
function renderAnalysis(){
  if(state.videos.length===0){el('analysisText').textContent='HeÃ§ bir data yoxdur â€” fayl yÃ¼klÉ™.';return;}
  const totalViews=state.totalViews||0, totalLikes=state.totalLikes||0;
  const engagement=(totalViews?((totalLikes/totalViews)*100):0).toFixed(2);
  const topVideo=state.videos[0];
  el('analysisText').innerHTML=`
<b>Total views:</b> ${fmt(totalViews)} Â· <b>Total likes:</b> ${fmt(totalLikes)}<br>
<b>Engagement:</b> ${engagement}%<br>
<b>Top video:</b> ${topVideo.title} ğŸ‘ï¸ ${fmt(topVideo.views)} Â· â¤ï¸ ${fmt(topVideo.likes)}
  `;
}
</script>
</body>
</html>