<!DOCTYPE html>
<html lang="az" data-theme="cyberpunk">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,viewport-fit=cover"/>
<title>AxtarGet Empire</title>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     GOOGLE FONTS â€” Syne (display) + DM Sans (body)
     Premium font pairing: geometric + humanist
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&display=swap" rel="stylesheet"/>

<!-- Firebase v11 â€” modular SDK -->
<script type="module">
import { initializeApp }                          from "https://www.gstatic.com/firebasejs/11.0.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword,
         signInWithEmailAndPassword, signOut,
         onAuthStateChanged, updateProfile }       from "https://www.gstatic.com/firebasejs/11.0.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc,
         addDoc, updateDoc, deleteDoc, writeBatch,
         collection, query, where, orderBy,
         limit, onSnapshot, getDocs,
         increment, arrayUnion, arrayRemove,
         serverTimestamp, Timestamp }              from "https://www.gstatic.com/firebasejs/11.0.0/firebase-firestore.js";
import { getStorage, ref as storageRef,
         uploadBytes, getDownloadURL }             from "https://www.gstatic.com/firebasejs/11.0.0/firebase-storage.js";

/* â”€â”€â”€ ğŸ”¥ BURAYA Ã–Z FÄ°REBASE KONFÄ°QURASÄ°YANIZI YAZIN â”€â”€â”€ */
const firebaseConfig = {
  apiKey:            "YOUR_API_KEY",
  authDomain:        "YOUR_PROJECT.firebaseapp.com",
  projectId:         "YOUR_PROJECT_ID",
  storageBucket:     "YOUR_PROJECT.appspot.com",
  messagingSenderId: "YOUR_SENDER_ID",
  appId:             "YOUR_APP_ID"
};

const app     = initializeApp(firebaseConfig);
const auth    = getAuth(app);
const db      = getFirestore(app);
const storage = getStorage(app);

/* ModullarÄ± global __FB bridge vasitÉ™silÉ™ paylaÅŸ */
window.__FB = {
  auth, db, storage,
  createUserWithEmailAndPassword, signInWithEmailAndPassword,
  signOut, onAuthStateChanged, updateProfile,
  doc, setDoc, getDoc, addDoc, updateDoc, deleteDoc, writeBatch,
  collection, query, where, orderBy, limit, onSnapshot, getDocs,
  increment, arrayUnion, arrayRemove, serverTimestamp, Timestamp,
  storageRef, uploadBytes, getDownloadURL
};
window.dispatchEvent(new Event("empire:ready"));
</script>

<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EMPIRE DESIGN SYSTEM â€” CSS Custom Properties + Theme Engine
   4 mÃ¶vzu: cyberpunk Â· deepsea Â· sakura Â· classicdark
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  /* â”€â”€ Cyberpunk (default) â”€â”€ */
  --bg0: #00040f;
  --bg1: #010a1a;
  --bg2: #011526;
  --glass:  rgba(0,20,50,0.65);
  --border: rgba(0,240,255,0.18);
  --acc1:   #00f0ff;
  --acc2:   #ff2079;
  --acc3:   #ffe600;
  --glow1:  rgba(0,240,255,0.35);
  --glow2:  rgba(255,32,121,0.35);
  --txt0:   #e8faff;
  --txt1:   #7ab8cc;
  --txt2:   #2a6070;
  --online: #00ff9d;
  --danger: #ff2d55;
  --warn:   #ffd60a;
  --good:   #30d158;
  --tc:     #ffe600;   /* Titan-Coin rengi */
  --radius: 18px;
  --rad-sm: 10px;
  --blur:   blur(24px);
  --shadow: 0 8px 40px rgba(0,0,0,0.7), inset 0 1px 0 rgba(255,255,255,0.06);
  --font-d: 'Syne', sans-serif;
  --font-b: 'DM Sans', sans-serif;
  --particle-color: #00f0ff;
  --scan-line: rgba(0,240,255,0.03);
}

[data-theme="deepsea"] {
  --bg0: #000d1a;  --bg1: #001226;  --bg2: #001f3f;
  --glass: rgba(0,15,40,0.7);  --border: rgba(0,180,220,0.2);
  --acc1: #00b4dc;  --acc2: #00e8b0;  --acc3: #ff9f43;
  --glow1: rgba(0,180,220,0.3);  --glow2: rgba(0,232,176,0.3);
  --txt0: #d0f0ff;  --txt1: #5090a0;  --txt2: #205060;
  --particle-color: #00b4dc;
}
[data-theme="sakura"] {
  --bg0: #0a0008;  --bg1: #160010;  --bg2: #22001a;
  --glass: rgba(40,0,30,0.65);  --border: rgba(255,100,180,0.22);
  --acc1: #ff6eb4;  --acc2: #c084fc;  --acc3: #fbbf24;
  --glow1: rgba(255,110,180,0.35);  --glow2: rgba(192,132,252,0.3);
  --txt0: #ffe4f0;  --txt1: #b07090;  --txt2: #602050;
  --particle-color: #ff6eb4;  --scan-line: rgba(255,110,180,0.03);
}
[data-theme="classicdark"] {
  --bg0: #080808;  --bg1: #111;  --bg2: #1a1a1a;
  --glass: rgba(20,20,20,0.8);  --border: rgba(255,255,255,0.1);
  --acc1: #f5f5f5;  --acc2: #888;  --acc3: #c0a060;
  --glow1: rgba(245,245,245,0.15);  --glow2: rgba(136,136,136,0.1);
  --txt0: #efefef;  --txt1: #888;  --txt2: #444;
  --particle-color: #555;  --scan-line: rgba(255,255,255,0.02);
}

/* â”€â”€ Reset â”€â”€ */
*,*::before,*::after { box-sizing:border-box; margin:0; padding:0; }
html { font-size:16px; scroll-behavior:smooth; }
body {
  font-family: var(--font-b);
  background: var(--bg0);
  color: var(--txt0);
  min-height: 100vh;
  overflow-x: hidden;
  cursor: default;
  transition: background .5s, color .5s;
}

/* Animated scan-line overlay */
body::after {
  content:'';
  position:fixed; inset:0; pointer-events:none; z-index:9000;
  background: repeating-linear-gradient(
    0deg,
    var(--scan-line) 0px, var(--scan-line) 1px,
    transparent 1px, transparent 4px
  );
  animation: scanMove 8s linear infinite;
  opacity:.6;
}
@keyframes scanMove { 0%{background-position:0 0} 100%{background-position:0 200px} }

/* Custom scrollbar */
::-webkit-scrollbar { width:5px; height:5px; }
::-webkit-scrollbar-track { background:var(--bg1); }
::-webkit-scrollbar-thumb { background:var(--acc1); border-radius:99px; opacity:.5; }

/* Custom cursor glow */
.cursor-glow {
  position:fixed; width:16px; height:16px; border-radius:50%;
  background:var(--acc1); mix-blend-mode:screen;
  pointer-events:none; z-index:10000;
  transform:translate(-50%,-50%);
  box-shadow: 0 0 20px var(--acc1), 0 0 40px var(--glow1);
  transition: transform .08s ease;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CANVAS PARTICLE SYSTEM
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#particle-canvas {
  position:fixed; inset:0; z-index:0; pointer-events:none;
  opacity:.6;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GLASS COMPONENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.glass {
  background: var(--glass);
  backdrop-filter: var(--blur);
  -webkit-backdrop-filter: var(--blur);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
}
.glass-sm {
  background: var(--glass);
  backdrop-filter: blur(16px);
  border: 1px solid var(--border);
  border-radius: var(--rad-sm);
}
.glass-inset {
  background: rgba(255,255,255,0.03);
  border: 1px solid var(--border);
  border-radius: var(--rad-sm);
}

/* â”€â”€ Neon Glow Border â”€â”€ */
.neon-border {
  box-shadow: 0 0 0 1px var(--acc1), 0 0 20px var(--glow1), inset 0 0 20px rgba(0,0,0,.5);
}
.neon-border-2 {
  box-shadow: 0 0 0 1px var(--acc2), 0 0 20px var(--glow2), inset 0 0 20px rgba(0,0,0,.5);
}

/* â”€â”€ Buttons â”€â”€ */
.btn {
  position:relative; overflow:hidden;
  display:inline-flex; align-items:center; justify-content:center; gap:8px;
  padding:10px 22px; border-radius:50px;
  font-family:var(--font-b); font-size:.9rem; font-weight:600;
  cursor:pointer; border:none; outline:none;
  transition: transform .2s cubic-bezier(.34,1.56,.64,1), box-shadow .2s, opacity .2s;
  letter-spacing:.3px; white-space:nowrap; user-select:none;
}
.btn:hover  { transform:translateY(-2px) scale(1.02); }
.btn:active { transform:scale(.96); }

.btn-acc1 {
  background: linear-gradient(135deg, var(--acc1), rgba(0,240,255,.7));
  color: var(--bg0); font-weight:700;
  box-shadow: 0 4px 20px var(--glow1);
}
.btn-acc1:hover { box-shadow: 0 8px 32px var(--glow1), 0 0 0 1px var(--acc1); }
.btn-acc2 {
  background: linear-gradient(135deg, var(--acc2), rgba(255,32,121,.7));
  color: #fff;
  box-shadow: 0 4px 20px var(--glow2);
}
.btn-ghost {
  background: rgba(255,255,255,.04);
  color: var(--txt1); border: 1px solid var(--border);
}
.btn-ghost:hover { background:rgba(255,255,255,.09); color:var(--txt0); }
.btn-danger { background:linear-gradient(135deg,#ff2d55,#ff6b35); color:#fff; }
.btn-success { background:linear-gradient(135deg,#30d158,#00a86b); color:#000; font-weight:700; }
.btn-tc { background:linear-gradient(135deg,var(--tc),#ff8c00); color:#000; font-weight:800; }
.btn-icon { padding:10px; width:42px; height:42px; border-radius:50%; }
.btn-sm { padding:7px 16px; font-size:.82rem; }

/* Ripple */
.ripple {
  position:absolute; border-radius:50%;
  background:rgba(255,255,255,.25);
  transform:scale(0); animation:rippleAnim .55s linear;
  pointer-events:none;
}
@keyframes rippleAnim { to { transform:scale(5); opacity:0; } }

/* â”€â”€ Inputs â”€â”€ */
.field {
  background:rgba(255,255,255,.04); border:1px solid var(--border);
  border-radius:var(--rad-sm); padding:11px 16px;
  color:var(--txt0); font-family:var(--font-b); font-size:.92rem;
  outline:none; width:100%;
  transition: border-color .3s, box-shadow .3s, background .3s;
}
.field:focus {
  border-color:var(--acc1);
  box-shadow:0 0 0 3px var(--glow1);
  background:rgba(255,255,255,.07);
}
.field::placeholder { color:var(--txt2); }
textarea.field { resize:vertical; min-height:80px; line-height:1.5; }

.field-label {
  font-size:.75rem; font-weight:600; color:var(--txt1);
  letter-spacing:.6px; text-transform:uppercase; margin-bottom:5px;
  display:block;
}
.field-wrap { display:flex; flex-direction:column; gap:5px; }

/* â”€â”€ Avatar â”€â”€ */
.av {
  border-radius:50%; flex-shrink:0;
  display:flex; align-items:center; justify-content:center;
  font-family:var(--font-d); font-weight:800; overflow:hidden;
  position:relative;
}
.av-xs { width:28px; height:28px; font-size:.7rem; }
.av-sm { width:38px; height:38px; font-size:.88rem; }
.av-md { width:50px; height:50px; font-size:1.1rem; }
.av-lg { width:72px; height:72px; font-size:1.5rem; }
.av-xl { width:100px; height:100px; font-size:2rem; }

.av-ring { /* VIP animated ring */
  box-shadow:0 0 0 3px var(--bg0), 0 0 0 5px var(--acc1), 0 0 16px var(--glow1);
}
.av-ring-2 {
  box-shadow:0 0 0 3px var(--bg0), 0 0 0 5px var(--acc2), 0 0 16px var(--glow2);
}
.av-online::after {
  content:''; position:absolute; bottom:2px; right:2px;
  width:11px; height:11px; border-radius:50%;
  background:var(--online); border:2px solid var(--bg1);
  box-shadow:0 0 8px var(--online);
  animation:pulseOnline 2s infinite;
}
.av-ghost::after { background:var(--txt2) !important; box-shadow:none !important; animation:none !important; }
@keyframes pulseOnline { 0%,100%{transform:scale(1);opacity:1} 50%{transform:scale(1.3);opacity:.7} }

/* â”€â”€ Badge chips â”€â”€ */
.chip {
  display:inline-flex; align-items:center; gap:3px;
  padding:2px 9px; border-radius:50px;
  font-size:.7rem; font-weight:700; letter-spacing:.4px;
  white-space:nowrap;
}
.chip-verified { background:rgba(29,155,240,.2); color:#1d9bf0; border:1px solid rgba(29,155,240,.4); }
.chip-legend   { background:rgba(255,230,0,.15); color:var(--tc); border:1px solid rgba(255,230,0,.3); }
.chip-vip      { background:linear-gradient(135deg,rgba(255,32,121,.2),rgba(255,128,0,.2)); color:#ff8040; border:1px solid rgba(255,128,0,.35); }
.chip-mod      { background:rgba(48,209,88,.15); color:#30d158; border:1px solid rgba(48,209,88,.3); }
.chip-admin    { background:rgba(255,45,85,.2); color:#ff2d55; border:1px solid rgba(255,45,85,.35); }
.chip-ghost    { background:rgba(100,100,100,.2); color:#888; border:1px solid rgba(120,120,120,.3); }

/* level badge */
.lv-badge {
  font-family:var(--font-d); font-size:.68rem; font-weight:800;
  padding:2px 8px; border-radius:50px;
  background:linear-gradient(135deg,var(--acc1),var(--acc2));
  color:var(--bg0);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#app { position:relative; z-index:1; min-height:100vh; }

/* â”€â”€ Auth â”€â”€ */
#auth-screen {
  min-height:100vh; display:flex; align-items:center; justify-content:center;
  padding:20px; position:relative; z-index:10;
}
.auth-card { width:100%; max-width:420px; padding:44px 38px; position:relative; overflow:hidden; }
.auth-card::before {
  content:'EMPIRE'; position:absolute; bottom:-20px; right:-24px;
  font-family:var(--font-d); font-size:5.5rem; font-weight:800;
  color:rgba(0,240,255,.04); letter-spacing:-4px; pointer-events:none;
}
.auth-logo {
  font-family:var(--font-d); font-size:1.9rem; font-weight:800; text-align:center;
  background:linear-gradient(135deg,var(--acc1),var(--acc2));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  background-clip:text; margin-bottom:6px;
  filter: drop-shadow(0 0 20px var(--acc1));
}
.auth-sub { color:var(--txt2); font-size:.82rem; text-align:center; margin-bottom:28px; letter-spacing:.3px; }
.auth-tabs {
  display:flex; background:rgba(255,255,255,.04);
  border-radius:50px; padding:4px; margin-bottom:22px; gap:4px;
}
.auth-tab {
  flex:1; padding:10px; border-radius:50px; border:none;
  background:transparent; color:var(--txt1);
  font-family:var(--font-b); font-size:.88rem; font-weight:600;
  cursor:pointer; transition:all .3s;
}
.auth-tab.active { background:var(--acc1); color:var(--bg0); box-shadow:0 4px 16px var(--glow1); }
.auth-form { display:flex; flex-direction:column; gap:14px; }
.auth-err {
  color:var(--danger); font-size:.83rem; padding:10px 14px;
  background:rgba(255,45,55,.08); border:1px solid rgba(255,45,55,.25);
  border-radius:var(--rad-sm); display:none;
}

/* â”€â”€ Main Layout (3-col grid) â”€â”€ */
#main-layout {
  display:grid;
  grid-template-columns:240px 1fr 300px;
  grid-template-rows:58px 1fr;
  min-height:100vh;
  display:none;
}

/* â”€â”€ Topbar â”€â”€ */
#topbar {
  grid-column:1/-1; grid-row:1;
  display:flex; align-items:center; gap:14px; padding:0 20px;
  background:rgba(0,0,0,.6); backdrop-filter:blur(28px);
  border-bottom:1px solid var(--border);
  position:sticky; top:0; z-index:200;
}
.topbar-logo {
  font-family:var(--font-d); font-size:1.05rem; font-weight:800;
  background:linear-gradient(135deg,var(--acc1),var(--acc2));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  background-clip:text; white-space:nowrap; letter-spacing:-.5px;
  filter:drop-shadow(0 0 10px var(--acc1));
  min-width:fit-content;
}
.topbar-search {
  flex:1; max-width:380px; display:flex; align-items:center; gap:8px;
  background:rgba(255,255,255,.04); border:1px solid var(--border);
  border-radius:50px; padding:7px 16px; transition:all .3s;
}
.topbar-search:focus-within {
  border-color:var(--acc1); box-shadow:0 0 0 2px var(--glow1);
  background:rgba(255,255,255,.07);
}
.topbar-search input {
  background:transparent; border:none; outline:none;
  color:var(--txt0); font-family:var(--font-b); font-size:.88rem; flex:1;
}
.topbar-search input::placeholder { color:var(--txt2); }
.topbar-right { display:flex; align-items:center; gap:8px; margin-left:auto; }
.tc-pill {
  display:flex; align-items:center; gap:5px;
  background:rgba(255,230,0,.1); border:1px solid rgba(255,230,0,.3);
  border-radius:50px; padding:5px 12px;
  font-family:var(--font-d); font-size:.82rem; font-weight:800;
  color:var(--tc); cursor:pointer;
}
.theme-row { display:flex; gap:5px; }
.t-dot {
  width:17px; height:17px; border-radius:50%; cursor:pointer;
  border:2px solid transparent; transition:all .25s;
}
.t-dot:hover,.t-dot.on { border-color:var(--txt0); transform:scale(1.25); }
.t-dot.cyberpunk  { background:linear-gradient(135deg,#00f0ff,#ff2079); }
.t-dot.deepsea    { background:linear-gradient(135deg,#00b4dc,#00e8b0); }
.t-dot.sakura     { background:linear-gradient(135deg,#ff6eb4,#c084fc); }
.t-dot.classicdark{ background:linear-gradient(135deg,#444,#888); }
.topbar-av { width:34px; height:34px; cursor:pointer; transition:transform .25s; }
.topbar-av:hover { transform:scale(1.1); }
.notif-btn { position:relative; }
.notif-ring {
  position:absolute; top:6px; right:6px;
  width:9px; height:9px; background:var(--acc2);
  border-radius:50%; border:2px solid var(--bg0);
  box-shadow:0 0 8px var(--acc2); display:none;
}

/* â”€â”€ Sidebar Left â”€â”€ */
#sidebar-left {
  grid-row:2; padding:16px 12px;
  border-right:1px solid var(--border);
  display:flex; flex-direction:column; gap:3px;
  overflow-y:auto; position:sticky; top:58px;
  height:calc(100vh - 58px);
}
.nav-it {
  display:flex; align-items:center; gap:11px;
  padding:11px 13px; border-radius:var(--rad-sm);
  color:var(--txt1); font-size:.9rem; font-weight:500;
  cursor:pointer; border:none; background:transparent;
  text-align:left; width:100%; position:relative;
  transition:all .22s;
}
.nav-it:hover { background:rgba(255,255,255,.05); color:var(--txt0); }
.nav-it.on {
  background:linear-gradient(135deg,rgba(0,240,255,.12),rgba(255,32,121,.08));
  color:var(--acc1); border:1px solid rgba(0,240,255,.2);
  box-shadow:0 0 16px rgba(0,240,255,.08);
}
.nav-it.on .nav-ic { text-shadow:0 0 12px var(--acc1); }
.nav-ic { font-size:1.15rem; min-width:22px; text-align:center; }
.nav-badge {
  margin-left:auto; background:var(--acc2);
  color:#fff; font-size:.68rem; font-weight:700;
  padding:2px 7px; border-radius:50px;
  box-shadow:0 0 8px var(--glow2); min-width:20px; text-align:center;
}
.sidebar-divider { height:1px; background:var(--border); margin:8px 0; }
.user-card-side {
  margin-top:auto; padding:12px;
  background:rgba(255,255,255,.03); border:1px solid var(--border);
  border-radius:var(--rad-sm);
  display:flex; align-items:center; gap:9px;
}
.user-side-info { flex:1; min-width:0; }
.user-side-name { font-weight:700; font-size:.88rem; truncate; }
.user-side-lvl  { font-size:.73rem; color:var(--txt2); margin-top:1px; }
.xp-wrap { height:3px; background:rgba(255,255,255,.07); border-radius:99px; margin-top:5px; overflow:hidden; }
.xp-fill { height:100%; border-radius:99px; background:linear-gradient(90deg,var(--acc1),var(--acc2)); transition:width .6s ease; }

/* â”€â”€ Main Feed â”€â”€ */
#main-feed {
  grid-row:2; padding:20px 16px;
  overflow-y:auto; max-height:calc(100vh - 58px);
  scroll-behavior:smooth;
}

/* â”€â”€ Sidebar Right â”€â”€ */
#sidebar-right {
  grid-row:2; padding:16px 12px;
  border-left:1px solid var(--border);
  overflow-y:auto; position:sticky; top:58px;
  height:calc(100vh - 58px);
  display:flex; flex-direction:column; gap:16px;
}

/* â”€â”€ Pages â”€â”€ */
.page { display:none; }
.page.on { display:block; animation:pgIn .35s ease; }
@keyframes pgIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:none} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   FEED & POST COMPOSER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.stories-strip {
  display:flex; gap:10px; margin-bottom:18px; overflow-x:auto; padding-bottom:4px;
}
.stories-strip::-webkit-scrollbar { height:0; }
.story-bub { display:flex; flex-direction:column; align-items:center; gap:5px; flex-shrink:0; cursor:pointer; }
.story-ring {
  width:58px; height:58px; border-radius:50%; padding:3px;
  background:linear-gradient(135deg,var(--acc1),var(--acc2),var(--acc3));
  transition:transform .2s; position:relative;
}
.story-ring:hover { transform:scale(1.08) rotate(5deg); }
.story-ring.seen  { background:linear-gradient(135deg,#333,#555); }
.story-ring-in { width:100%; height:100%; border-radius:50%; border:3px solid var(--bg0); overflow:hidden; background:var(--bg1); display:flex; align-items:center; justify-content:center; }
.story-label { font-size:.68rem; color:var(--txt1); text-align:center; max-width:62px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.story-add-ring { background:linear-gradient(135deg,rgba(0,240,255,.3),rgba(255,32,121,.3)); border:2px dashed var(--acc1); }

.composer { padding:18px 20px; margin-bottom:16px; }
.comp-row  { display:flex; gap:12px; align-items:flex-start; }
.comp-area {
  flex:1; background:transparent; border:none; outline:none;
  color:var(--txt0); font-family:var(--font-b); font-size:.95rem;
  resize:none; min-height:60px; line-height:1.6;
}
.comp-area::placeholder { color:var(--txt2); }
.comp-bottom {
  display:flex; align-items:center; justify-content:space-between;
  padding-top:12px; margin-top:10px; border-top:1px solid var(--border);
  flex-wrap:wrap; gap:8px;
}
.comp-tools { display:flex; gap:4px; }
.comp-tool {
  background:transparent; border:none; color:var(--txt1);
  font-size:1.05rem; cursor:pointer; padding:6px 8px;
  border-radius:8px; transition:all .2s;
}
.comp-tool:hover { color:var(--acc1); background:rgba(0,240,255,.08); }
.comp-tool.active { color:var(--acc1); background:rgba(0,240,255,.12); }

/* Post Card */
.post {
  padding:18px 20px; margin-bottom:14px;
  animation:postIn .45s cubic-bezier(.34,1.56,.64,1);
  transition:transform .2s;
}
.post:hover { transform:translateY(-2px); }
@keyframes postIn { from{opacity:0;transform:translateY(18px) scale(.97)} to{opacity:1;transform:none} }
.post-hd { display:flex; align-items:center; gap:11px; margin-bottom:13px; }
.post-meta { flex:1; }
.post-author {
  font-weight:700; font-size:.92rem; display:flex; align-items:center;
  gap:6px; flex-wrap:wrap; cursor:pointer;
}
.post-author:hover { color:var(--acc1); }
.post-ts { font-size:.75rem; color:var(--txt2); margin-top:2px; }
.post-txt { font-size:.93rem; line-height:1.72; margin-bottom:13px; word-break:break-word; }
.post-img { width:100%; border-radius:var(--rad-sm); margin-bottom:13px; max-height:380px; object-fit:cover; border:1px solid var(--border); }
.post-actions { display:flex; align-items:center; gap:2px; }
.pa-btn {
  display:flex; align-items:center; gap:5px;
  padding:7px 13px; border-radius:50px; border:none;
  background:transparent; color:var(--txt1);
  cursor:pointer; font-family:var(--font-b); font-size:.83rem; font-weight:500;
  transition:all .22s; position:relative; overflow:hidden;
}
.pa-btn:hover { background:rgba(255,255,255,.05); color:var(--txt0); }
.pa-btn.liked { color:var(--acc2); }
.pa-btn.liked:hover { background:rgba(255,32,121,.1); }
.pa-more {
  margin-left:auto; background:transparent; border:none;
  color:var(--txt2); cursor:pointer; padding:7px 10px;
  border-radius:50%; font-size:1rem; transition:all .2s;
}
.pa-more:hover { background:rgba(255,255,255,.07); color:var(--txt0); }

/* Poll widget */
.poll-wrap { margin:10px 0 14px; }
.poll-opt {
  position:relative; padding:11px 14px; margin-bottom:8px;
  border-radius:var(--rad-sm); cursor:pointer; overflow:hidden;
  border:1px solid var(--border); transition:border-color .2s;
  font-size:.88rem;
}
.poll-opt:hover { border-color:var(--acc1); }
.poll-opt.voted { cursor:default; }
.poll-fill { position:absolute; top:0; left:0; bottom:0; background:rgba(0,240,255,.12); border-radius:var(--rad-sm); transition:width .8s ease; }
.poll-text { position:relative; z-index:1; font-weight:500; }
.poll-pct  { position:relative; z-index:1; float:right; font-weight:700; color:var(--acc1); }

/* Audio post */
.audio-player {
  display:flex; align-items:center; gap:12px;
  background:rgba(0,240,255,.05); border:1px solid var(--border);
  border-radius:var(--rad-sm); padding:12px 16px; margin-bottom:13px;
}
.audio-play { font-size:1.4rem; cursor:pointer; transition:transform .2s; }
.audio-play:hover { transform:scale(1.15); }
.audio-bar { flex:1; height:4px; background:rgba(255,255,255,.1); border-radius:99px; overflow:hidden; cursor:pointer; }
.audio-prog { height:100%; background:linear-gradient(90deg,var(--acc1),var(--acc2)); border-radius:99px; transition:width .1s; }
.audio-time { font-size:.75rem; color:var(--txt1); min-width:50px; text-align:right; font-family:var(--font-d); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DIRECT MESSAGES
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#dm-wrap { display:grid; grid-template-columns:270px 1fr; height:calc(100vh - 58px); }
.dm-list { border-right:1px solid var(--border); overflow-y:auto; }
.dm-list-hd { padding:14px 16px; border-bottom:1px solid var(--border); }
.dm-item {
  display:flex; align-items:center; gap:11px;
  padding:13px 16px; cursor:pointer;
  border-bottom:1px solid rgba(255,255,255,.02);
  transition:background .15s;
}
.dm-item:hover,.dm-item.on { background:rgba(0,240,255,.05); }
.dm-item-info { flex:1; min-width:0; }
.dm-item-name { font-weight:700; font-size:.87rem; }
.dm-item-prev { font-size:.78rem; color:var(--txt2); overflow:hidden; text-overflow:ellipsis; white-space:nowrap; margin-top:2px; }
.dm-unread { background:var(--acc1); color:var(--bg0); font-size:.68rem; font-weight:800; padding:2px 7px; border-radius:50px; }
.dm-chat { display:flex; flex-direction:column; height:100%; }
.dm-chat-hd {
  padding:14px 18px; border-bottom:1px solid var(--border);
  display:flex; align-items:center; gap:11px; background:rgba(0,0,0,.2);
}
.dm-chat-hd .actions { margin-left:auto; display:flex; gap:6px; }
.dm-msgs { flex:1; overflow-y:auto; padding:18px; display:flex; flex-direction:column; gap:10px; }
.dm-msg { display:flex; align-items:flex-end; gap:7px; max-width:72%; }
.dm-msg.own { margin-left:auto; flex-direction:row-reverse; }
.dm-bubble {
  padding:9px 13px; border-radius:16px;
  font-size:.88rem; line-height:1.5; word-break:break-word; position:relative;
}
.dm-msg:not(.own) .dm-bubble {
  background:rgba(255,255,255,.07); border:1px solid var(--border);
  border-bottom-left-radius:3px;
}
.dm-msg.own .dm-bubble {
  background:linear-gradient(135deg,var(--acc1),rgba(0,180,220,1));
  color:var(--bg0); border-bottom-right-radius:3px;
}
.dm-msg.own .dm-bubble { color:var(--bg0) !important; }
.dm-ts { font-size:.68rem; color:var(--txt2); margin-top:4px; }
/* Self-destruct */
.dm-bubble.self-destruct { border-color:var(--acc2) !important; box-shadow:0 0 12px var(--glow2); }
.self-destruct-timer {
  font-size:.68rem; color:var(--acc2); font-weight:700;
  margin-top:4px; font-family:var(--font-d);
}
/* E2E indicator */
.e2e-bar {
  display:flex; align-items:center; justify-content:center; gap:6px;
  padding:6px; background:rgba(48,209,88,.07); border-bottom:1px solid rgba(48,209,88,.2);
  font-size:.73rem; color:#30d158;
}
/* Typing indicator */
.typing-ind { display:flex; gap:4px; align-items:center; padding:8px 12px; }
.typing-dot { width:7px; height:7px; border-radius:50%; background:var(--acc1); animation:typingPulse 1.2s infinite ease-in-out; }
.typing-dot:nth-child(2) { animation-delay:.15s; }
.typing-dot:nth-child(3) { animation-delay:.3s; }
@keyframes typingPulse { 0%,80%,100%{transform:scale(.6);opacity:.4} 40%{transform:scale(1);opacity:1} }
.typing-status { font-size:.75rem; color:var(--txt1); margin-left:4px; }

.dm-input-row {
  padding:13px 16px; border-top:1px solid var(--border);
  display:flex; align-items:center; gap:8px;
}
.dm-input {
  flex:1; background:rgba(255,255,255,.05); border:1px solid var(--border);
  border-radius:50px; padding:9px 16px;
  color:var(--txt0); font-family:var(--font-b); font-size:.88rem; outline:none;
  transition:all .3s;
}
.dm-input:focus { border-color:var(--acc1); background:rgba(255,255,255,.08); }

/* Reaction Picker */
.react-pick {
  position:absolute; bottom:calc(100% + 6px);
  background:var(--bg2); border:1px solid var(--border);
  border-radius:50px; padding:5px 10px;
  display:none; gap:5px; font-size:1.1rem;
  animation:popUp .2s cubic-bezier(.34,1.56,.64,1);
  z-index:50;
}
.dm-bubble:hover .react-pick { display:flex; }
@keyframes popUp { from{transform:scale(.8) translateY(4px);opacity:0} to{transform:none;opacity:1} }

/* Ghost mode banner */
.ghost-banner {
  display:flex; align-items:center; gap:8px; padding:8px 14px;
  background:rgba(100,100,100,.15); border:1px solid rgba(120,120,120,.3);
  border-radius:var(--rad-sm); margin-bottom:10px;
  font-size:.8rem; color:#888;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STORIES FULL-SCREEN VIEWER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#story-viewer {
  position:fixed; inset:0; z-index:1000;
  background:rgba(0,0,0,.96);
  display:none; align-items:center; justify-content:center;
}
#story-viewer.on { display:flex; }
.sv-card {
  width:100%; max-width:460px; border-radius:var(--radius);
  overflow:hidden; position:relative; max-height:90vh;
  background:var(--bg1);
}
.sv-progress { display:flex; gap:4px; padding:12px; position:absolute; top:0; left:0; right:0; z-index:3; }
.sv-bar { flex:1; height:3px; background:rgba(255,255,255,.25); border-radius:99px; overflow:hidden; }
.sv-fill { height:100%; background:#fff; border-radius:99px; }
.sv-hd {
  position:absolute; top:22px; left:0; right:0; padding:0 12px;
  display:flex; align-items:center; gap:10px; z-index:3;
}
.sv-img { width:100%; height:480px; object-fit:cover; }
.sv-text-bg { min-height:340px; display:flex; align-items:center; justify-content:center; padding:60px 24px; }
.sv-text { font-size:1.4rem; font-weight:600; text-align:center; line-height:1.5; font-family:var(--font-d); }
.sv-nav-l,.sv-nav-r { position:absolute; top:60px; bottom:60px; width:40%; z-index:2; cursor:pointer; }
.sv-nav-l { left:0; }
.sv-nav-r { right:0; }
.sv-close { position:absolute; top:14px; right:14px; z-index:10; background:rgba(0,0,0,.5); border:none; color:#fff; width:34px; height:34px; border-radius:50%; cursor:pointer; font-size:1.1rem; display:flex; align-items:center; justify-content:center; transition:background .2s; }
.sv-close:hover { background:rgba(255,0,0,.4); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN COMMAND CENTER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.admin-hero {
  background:linear-gradient(135deg,rgba(255,45,85,.12),rgba(255,32,121,.06));
  border:1px solid rgba(255,45,85,.35); border-radius:var(--radius);
  padding:22px 24px; margin-bottom:20px;
  display:flex; align-items:center; gap:16px;
  animation:adminPulse 3s ease-in-out infinite;
}
@keyframes adminPulse { 0%,100%{box-shadow:0 0 20px rgba(255,45,85,.15)} 50%{box-shadow:0 0 40px rgba(255,45,85,.35)} }
.admin-title { font-family:var(--font-d); font-size:1.2rem; font-weight:800; color:var(--danger); }
.admin-sub   { font-size:.78rem; color:var(--txt2); margin-top:3px; }

.admin-kpi { display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:14px; margin-bottom:20px; }
.kpi-card {
  padding:18px 16px; text-align:center; position:relative; overflow:hidden;
  transition:transform .2s;
}
.kpi-card:hover { transform:translateY(-3px); }
.kpi-card::before {
  content:''; position:absolute; inset:0; opacity:.08;
  background:radial-gradient(circle at 50% 120%,var(--acc1),transparent);
}
.kpi-num { font-family:var(--font-d); font-size:2rem; font-weight:800; }
.kpi-lbl { font-size:.73rem; color:var(--txt2); text-transform:uppercase; letter-spacing:.5px; margin-top:3px; }

/* Activity chart (CSS bars) */
.act-chart { display:flex; align-items:flex-end; gap:3px; height:70px; }
.act-bar { flex:1; border-radius:3px 3px 0 0; min-height:3px; transition:height .5s ease; cursor:pointer; opacity:.75; }
.act-bar:hover { opacity:1; }

/* Admin table */
.adm-tbl { width:100%; border-collapse:collapse; font-size:.85rem; }
.adm-tbl th {
  padding:9px 12px; text-align:left; font-size:.72rem;
  color:var(--txt2); text-transform:uppercase; letter-spacing:.5px;
  border-bottom:1px solid var(--border);
}
.adm-tbl td { padding:11px 12px; border-bottom:1px solid rgba(255,255,255,.02); vertical-align:middle; }
.adm-tbl tr:hover td { background:rgba(255,255,255,.02); }
.adm-act {
  padding:4px 9px; border-radius:6px; font-size:.75rem; font-weight:600;
  border:none; cursor:pointer; transition:all .2s; margin:2px;
}
.adm-ban  { background:rgba(255,45,85,.15); color:#ff2d55; border:1px solid rgba(255,45,85,.3); }
.adm-ban:hover  { background:#ff2d55; color:#fff; }
.adm-unban{ background:rgba(48,209,88,.15); color:#30d158; border:1px solid rgba(48,209,88,.3); }
.adm-mute { background:rgba(255,214,10,.12); color:#ffd60a; border:1px solid rgba(255,214,10,.25); }
.adm-del  { background:rgba(255,100,0,.15); color:#ff6400; border:1px solid rgba(255,100,0,.3); }
.adm-del:hover { background:#ff6400; color:#fff; }
.adm-badge{ background:rgba(0,240,255,.1); color:var(--acc1); border:1px solid rgba(0,240,255,.25); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ECONOMY / SHOP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.shop-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(190px,1fr)); gap:14px; }
.shop-card {
  padding:20px 16px; text-align:center; cursor:pointer;
  transition:all .3s; position:relative; overflow:hidden;
}
.shop-card:hover { transform:translateY(-4px); }
.shop-card::before {
  content:''; position:absolute; inset:0; opacity:0;
  background:radial-gradient(circle at 50% 100%,var(--acc1),transparent 70%);
  transition:opacity .3s;
}
.shop-card:hover::before { opacity:.08; }
.shop-ic   { font-size:2.4rem; margin-bottom:10px; }
.shop-name { font-weight:700; font-size:.9rem; margin-bottom:3px; }
.shop-desc { font-size:.77rem; color:var(--txt2); margin-bottom:12px; line-height:1.4; }
.shop-price{ font-family:var(--font-d); font-size:.92rem; font-weight:800; color:var(--tc); }

/* Gift popup */
.gift-anim {
  position:fixed; pointer-events:none; z-index:9999;
  font-size:2rem; animation:giftFly 1.2s ease forwards;
}
@keyframes giftFly {
  0%   { transform:scale(.5) translateY(0); opacity:1; }
  60%  { transform:scale(1.3) translateY(-80px); opacity:1; }
  100% { transform:scale(.8) translateY(-140px); opacity:0; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROFILE PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.profile-cover {
  height:130px; border-radius:var(--radius) var(--radius) 0 0;
  position:relative; overflow:hidden;
  background:linear-gradient(135deg,var(--acc1),var(--acc2));
}
.profile-cover-art { width:100%; height:100%; opacity:.6; }
.profile-body { padding:0 20px 20px; }
.profile-av-row {
  display:flex; align-items:flex-end; gap:14px;
  padding:0 4px; margin-top:-40px; flex-wrap:wrap;
}
.profile-actions-row { margin-left:auto; display:flex; gap:8px; margin-top:44px; flex-wrap:wrap; }
.profile-stats { display:flex; gap:20px; margin-top:16px; }
.pstat { text-align:center; cursor:pointer; }
.pstat-n { font-family:var(--font-d); font-size:1.2rem; font-weight:800; }
.pstat-l { font-size:.72rem; color:var(--txt2); text-transform:uppercase; letter-spacing:.4px; }
.profile-bio { font-size:.88rem; color:var(--txt1); line-height:1.6; margin-top:10px; }
.profile-medals { display:flex; flex-wrap:wrap; gap:7px; margin-top:12px; }
.medal-chip {
  display:inline-flex; align-items:center; gap:4px;
  padding:4px 11px; border-radius:50px; font-size:.77rem; font-weight:600;
  background:rgba(255,230,0,.1); border:1px solid rgba(255,230,0,.25); color:var(--tc);
}

/* Visitor bars */
.vis-row { display:flex; align-items:center; gap:8px; margin-bottom:5px; }
.vis-lbl { font-size:.76rem; color:var(--txt2); width:28px; text-align:right; }
.vis-track { flex:1; height:5px; background:rgba(255,255,255,.05); border-radius:99px; overflow:hidden; }
.vis-fill  { height:100%; border-radius:99px; background:linear-gradient(90deg,var(--acc1),var(--acc2)); }
.vis-num   { font-size:.74rem; color:var(--txt1); width:26px; }

/* Achievements list */
.achieve-list { display:grid; grid-template-columns:repeat(auto-fill,minmax(180px,1fr)); gap:10px; }
.achieve-card {
  padding:14px; display:flex; align-items:center; gap:10px;
  opacity:.5; transition:all .2s;
}
.achieve-card.unlocked { opacity:1; }
.achieve-ic { font-size:1.8rem; }
.achieve-name { font-weight:700; font-size:.85rem; }
.achieve-desc { font-size:.76rem; color:var(--txt2); margin-top:2px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIFICATIONS HUB
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.notif-it {
  display:flex; align-items:center; gap:12px;
  padding:13px 16px; border-radius:var(--rad-sm); margin-bottom:8px;
  transition:background .2s;
}
.notif-it:hover { background:rgba(255,255,255,.03); }
.notif-it.unread { background:rgba(0,240,255,.04); border-left:3px solid var(--acc1); }
.notif-ic { font-size:1.4rem; flex-shrink:0; }
.notif-txt { flex:1; }
.notif-msg { font-size:.88rem; }
.notif-time { font-size:.74rem; color:var(--txt2); margin-top:2px; }
.notif-unread-dot { width:8px; height:8px; border-radius:50%; background:var(--acc1); box-shadow:0 0 6px var(--acc1); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SECTION TITLE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.sec-title {
  font-family:var(--font-d); font-size:.78rem; font-weight:700;
  color:var(--txt1); letter-spacing:1px; text-transform:uppercase;
  margin-bottom:10px; display:flex; align-items:center; gap:8px;
}
.sec-title::after { content:''; flex:1; height:1px; background:var(--border); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST / MODAL / CONTEXT MENU
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#toast-box { position:fixed; top:70px; right:16px; z-index:8000; display:flex; flex-direction:column; gap:8px; max-width:320px; }
.toast {
  padding:12px 16px; border-radius:var(--rad-sm);
  display:flex; align-items:center; gap:9px;
  background:var(--bg2); border:1px solid var(--border);
  box-shadow:0 8px 28px rgba(0,0,0,.5);
  animation:toastIn .35s cubic-bezier(.34,1.56,.64,1);
  font-size:.85rem; max-width:320px;
}
.toast.ok   { border-color:rgba(48,209,88,.4); }
.toast.err  { border-color:rgba(255,45,85,.4); }
.toast.info { border-color:rgba(0,240,255,.35); }
@keyframes toastIn  { from{transform:translateX(110%);opacity:0} to{transform:none;opacity:1} }
@keyframes toastOut { to{transform:translateX(110%);opacity:0} }

#modal-bg {
  position:fixed; inset:0; z-index:900;
  background:rgba(0,0,0,.75); backdrop-filter:blur(12px);
  display:none; align-items:center; justify-content:center; padding:20px;
}
#modal-bg.on { display:flex; }
.modal-box {
  width:100%; max-width:500px; max-height:82vh;
  overflow-y:auto; animation:modalIn .35s cubic-bezier(.34,1.56,.64,1);
}
@keyframes modalIn { from{transform:scale(.82) translateY(24px);opacity:0} to{transform:none;opacity:1} }
.modal-hd { display:flex; align-items:center; justify-content:space-between; padding:20px 22px 0; }
.modal-title { font-family:var(--font-d); font-size:1.05rem; font-weight:800; }
.modal-close { background:transparent; border:none; color:var(--txt1); cursor:pointer; font-size:1.2rem; padding:4px; border-radius:6px; transition:all .2s; }
.modal-close:hover { color:var(--txt0); background:rgba(255,255,255,.08); }
.modal-body { padding:18px 22px 22px; }

#ctx-menu {
  position:fixed; z-index:800; background:var(--bg2); border:1px solid var(--border);
  border-radius:var(--rad-sm); padding:5px; min-width:155px;
  box-shadow:0 10px 36px rgba(0,0,0,.6);
  animation:popUp .18s ease; display:none;
}
#ctx-menu.on { display:block; }
.ctx-it {
  padding:8px 13px; border-radius:7px; cursor:pointer;
  font-size:.85rem; color:var(--txt1); display:flex; align-items:center; gap:7px;
  transition:all .14s;
}
.ctx-it:hover { background:rgba(255,255,255,.06); color:var(--txt0); }
.ctx-it.red { color:var(--danger); }
.ctx-it.red:hover { background:rgba(255,45,85,.1); }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SKELETON LOADER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.skel {
  background:linear-gradient(90deg,rgba(255,255,255,.04) 25%,rgba(255,255,255,.09) 50%,rgba(255,255,255,.04) 75%);
  background-size:200% 100%; animation:skelAnim 1.6s infinite; border-radius:8px;
}
@keyframes skelAnim { 0%{background-position:200% 0} 100%{background-position:-200% 0} }
.spinner { width:30px; height:30px; border-radius:50%; border:3px solid rgba(255,255,255,.08); border-top-color:var(--acc1); animation:spin .7s linear infinite; margin:36px auto; }
@keyframes spin { to{transform:rotate(360deg)} }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MISC UTILS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.flex  { display:flex; }
.col   { flex-direction:column; }
.items-c { align-items:center; }
.gap8 { gap:8px; }
.gap12 { gap:12px; }
.mb8  { margin-bottom:8px; }
.mb14 { margin-bottom:14px; }
.mb20 { margin-bottom:20px; }
.w-full { width:100%; }
.text-c { text-align:center; }
.text-m { color:var(--txt2); }
.text-ok { color:var(--good); }
.text-err{ color:var(--danger); }
.text-tc { color:var(--tc); }
.text-a1 { color:var(--acc1); }
.fw7 { font-weight:700; }
.fam-d { font-family:var(--font-d); }
.truncate { overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }
.divider  { height:1px; background:var(--border); margin:14px 0; }
.hidden   { display:none !important; }

/* Trending item */
.trend-it {
  display:flex; align-items:center; gap:9px; padding:10px 12px;
  border-radius:var(--rad-sm); cursor:pointer; transition:all .18s;
  border:1px solid transparent;
}
.trend-it:hover { background:rgba(255,255,255,.04); border-color:var(--border); }
.trend-rank { font-family:var(--font-d); font-size:.95rem; font-weight:800; color:var(--acc1); min-width:24px; }
.trend-tag  { font-weight:700; font-size:.87rem; }
.trend-cnt  { font-size:.75rem; color:var(--txt2); margin-top:1px; }

/* Online user mini card */
.online-it {
  display:flex; align-items:center; gap:9px; padding:8px 10px;
  border-radius:var(--rad-sm); cursor:pointer; transition:all .18s; margin-bottom:4px;
}
.online-it:hover { background:rgba(255,255,255,.04); }

/* Coin float */
.coin-float { position:fixed; pointer-events:none; z-index:9998; font-weight:800; font-family:var(--font-d); font-size:1rem; color:var(--tc); animation:coinUp .9s ease forwards; }
@keyframes coinUp { 0%{opacity:1;transform:translateY(0)} 100%{opacity:0;transform:translateY(-70px) scale(1.4)} }

/* Announcement banner */
.announce-banner {
  background:linear-gradient(135deg,rgba(0,240,255,.1),rgba(255,32,121,.08));
  border:1px solid var(--acc1); border-radius:var(--rad-sm);
  padding:12px 16px; margin-bottom:14px; display:flex; align-items:center; gap:10px;
  animation:announceSlide .5s cubic-bezier(.34,1.56,.64,1);
}
@keyframes announceSlide { from{transform:translateY(-20px);opacity:0} to{transform:none;opacity:1} }

/* Ghost mode toggle */
.ghost-toggle {
  display:flex; align-items:center; gap:10px; padding:11px 14px;
  border-radius:var(--rad-sm); cursor:pointer;
  background:rgba(100,100,100,.08); border:1px solid rgba(120,120,120,.2);
  transition:all .2s; margin-bottom:6px;
}
.ghost-toggle.active { background:rgba(255,255,255,.05); border-color:rgba(255,255,255,.2); }
.ghost-toggle .label { font-size:.85rem; flex:1; }
.toggle-switch {
  width:38px; height:20px; background:rgba(255,255,255,.1);
  border-radius:99px; position:relative; transition:background .3s;
}
.toggle-switch::after {
  content:''; position:absolute; width:14px; height:14px;
  border-radius:50%; background:#888; top:3px; left:3px;
  transition:transform .3s, background .3s;
}
.ghost-toggle.active .toggle-switch { background:var(--acc1); }
.ghost-toggle.active .toggle-switch::after { transform:translateX(18px); background:#fff; }

/* Mobile bottom nav */
#mob-nav {
  display:none; position:fixed; bottom:0; left:0; right:0; z-index:300;
  background:rgba(0,0,0,.85); backdrop-filter:blur(24px);
  border-top:1px solid var(--border);
  padding:8px 0 env(safe-area-inset-bottom);
  justify-content:space-around;
}
.mob-nav-it { display:flex; flex-direction:column; align-items:center; gap:2px; padding:6px 14px; cursor:pointer; color:var(--txt2); transition:color .2s; font-size:.66rem; }
.mob-nav-it.on { color:var(--acc1); }
.mob-nav-ic { font-size:1.25rem; }

@media(max-width:1050px) { #main-layout{grid-template-columns:210px 1fr} #sidebar-right{display:none} }
@media(max-width:720px)  { #main-layout{grid-template-columns:1fr} #sidebar-left{display:none} #mob-nav{display:flex} }

/* â”€â”€ Poll creation â”€â”€ */
.poll-build { display:flex; flex-direction:column; gap:8px; }
.poll-opt-input { display:flex; align-items:center; gap:8px; }
.poll-opt-input .field { flex:1; }
</style>
</head>

<body>
<!-- Particle canvas (background effect) -->
<canvas id="particle-canvas"></canvas>

<!-- Custom cursor -->
<div class="cursor-glow" id="cursor-glow"></div>

<div id="app">

  <!-- â”€â”€ Toast Container â”€â”€ -->
  <div id="toast-box"></div>

  <!-- â”€â”€ Modal â”€â”€ -->
  <div id="modal-bg">
    <div class="modal-box glass" id="modal-box">
      <div class="modal-hd">
        <span class="modal-title" id="modal-title"></span>
        <button class="modal-close" onclick="Empire.UI.closeModal()">âœ•</button>
      </div>
      <div class="modal-body" id="modal-body"></div>
    </div>
  </div>

  <!-- â”€â”€ Context Menu â”€â”€ -->
  <div id="ctx-menu"></div>

  <!-- â”€â”€ Story Viewer â”€â”€ -->
  <div id="story-viewer">
    <button class="sv-close" onclick="Empire.Stories.close()">âœ•</button>
    <div class="sv-card" id="sv-card"></div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       AUTH SCREEN
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="auth-screen">
    <div class="auth-card glass neon-border">
      <div class="auth-logo">âš¡ AxtarGet Empire</div>
      <div class="auth-sub">Enter your Digital Empire â€” Powered by Firebase</div>

      <div class="auth-tabs">
        <button class="auth-tab on" onclick="Empire.Auth.tab('login',this)">GiriÅŸ</button>
        <button class="auth-tab"   onclick="Empire.Auth.tab('register',this)">Qeydiyyat</button>
      </div>

      <div id="auth-err" class="auth-err"></div>

      <form class="auth-form" id="auth-form" onsubmit="Empire.Auth.submit(event)">
        <div class="field-wrap hidden" id="f-name">
          <label class="field-label">Ad Soyad</label>
          <input class="field" type="text" id="a-name" placeholder="Empire QÉ™hrÉ™manÄ±" autocomplete="off"/>
        </div>
        <div class="field-wrap">
          <label class="field-label">E-mail</label>
          <input class="field" type="email" id="a-email" placeholder="hero@empire.io" required/>
        </div>
        <div class="field-wrap">
          <label class="field-label">ÅifrÉ™</label>
          <input class="field" type="password" id="a-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" required/>
        </div>
        <button type="submit" class="btn btn-acc1 w-full" id="a-btn" style="padding:13px;">
          Daxil ol
        </button>
      </form>

      <!-- Admin hint -->
      <div style="text-align:center;margin-top:16px;font-size:.75rem;color:var(--txt2);">
        ğŸ’¡ Admin giriÅŸi Ã¼Ã§Ã¼n profilinizdÉ™n <code style="color:var(--acc1);">/admin</code> yazÄ±n
      </div>
    </div>
  </div>

  <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MAIN APP LAYOUT
  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
  <div id="main-layout">

    <!-- TOP BAR -->
    <header id="topbar">
      <div class="topbar-logo">âš¡ AxtarGet Empire</div>

      <div class="topbar-search">
        <span style="color:var(--txt2);font-size:.9rem;">ğŸ”</span>
        <input type="text" id="search-inp" placeholder="Ä°stifadÉ™Ã§i, hashtag axtarÄ±n..."
          oninput="Empire.Social.search(this.value)"/>
      </div>

      <div class="topbar-right">
        <div class="tc-pill" onclick="Empire.UI.nav('shop')" title="Titan-Coin balansÄ±nÄ±z">
          âš¡ <span id="tc-disp">0</span> TC
        </div>
        <div class="theme-row">
          <div class="t-dot cyberpunk on"   title="Cyberpunk"   onclick="Empire.UI.theme('cyberpunk',this)"></div>
          <div class="t-dot deepsea"        title="Deep Sea"    onclick="Empire.UI.theme('deepsea',this)"></div>
          <div class="t-dot sakura"         title="Sakura"      onclick="Empire.UI.theme('sakura',this)"></div>
          <div class="t-dot classicdark"    title="Classic Dark" onclick="Empire.UI.theme('classicdark',this)"></div>
        </div>
        <button class="btn btn-ghost btn-icon notif-btn" onclick="Empire.UI.nav('notifs')" title="BildiriÅŸlÉ™r">
          ğŸ”” <span class="notif-ring" id="notif-ring"></span>
        </button>
        <div class="av av-sm topbar-av" id="topbar-av" onclick="Empire.UI.nav('profile')" title="Profilim"></div>
      </div>
    </header>

    <!-- SIDEBAR LEFT -->
    <nav id="sidebar-left">
      <button class="nav-it on" data-p="feed"    onclick="Empire.UI.nav('feed')">
        <span class="nav-ic">ğŸ </span> Ana LÃ¶vhÉ™
      </button>
      <button class="nav-it" data-p="trending"   onclick="Empire.UI.nav('trending')">
        <span class="nav-ic">ğŸ”¥</span> TrendlÉ™r
      </button>
      <button class="nav-it" data-p="dms"        onclick="Empire.UI.nav('dms')">
        <span class="nav-ic">ğŸ’¬</span> Mesajlar
        <span class="nav-badge hidden" id="dm-badge">0</span>
      </button>
      <button class="nav-it" data-p="notifs"     onclick="Empire.UI.nav('notifs')">
        <span class="nav-ic">ğŸ””</span> BildiriÅŸlÉ™r
      </button>
      <button class="nav-it" data-p="shop"       onclick="Empire.UI.nav('shop')">
        <span class="nav-ic">ğŸ›’</span> MaÄŸaza
      </button>
      <button class="nav-it" data-p="profile"    onclick="Empire.UI.nav('profile')">
        <span class="nav-ic">ğŸ‘¤</span> Profil
      </button>
      <!-- Admin nav â€” yalnÄ±z admin rollu istifadÉ™Ã§ilÉ™rÉ™ gÃ¶rÃ¼nÃ¼r -->
      <button class="nav-it hidden" data-p="admin" id="admin-nav" onclick="Empire.UI.nav('admin')">
        <span class="nav-ic">ğŸ‘‘</span> Command Center
      </button>

      <div class="sidebar-divider"></div>

      <!-- Ghost Mode Toggle -->
      <div class="ghost-toggle" id="ghost-toggle" onclick="Empire.Social.toggleGhost()">
        <span style="font-size:1rem;">ğŸ‘»</span>
        <span class="label text-m" style="font-size:.82rem;">Ghost Mode</span>
        <div class="toggle-switch" id="ghost-sw"></div>
      </div>

      <!-- Sidebar user card -->
      <div class="user-card-side" id="sidebar-user-card">
        <div class="av av-sm" id="side-av" onclick="Empire.UI.nav('profile')" style="cursor:pointer;"></div>
        <div class="user-side-info">
          <div class="user-side-name truncate" id="side-name">...</div>
          <div class="user-side-lvl" id="side-lvl">Lvl 1</div>
          <div class="xp-wrap"><div class="xp-fill" id="xp-fill" style="width:0%"></div></div>
        </div>
        <button class="btn btn-ghost btn-icon" onclick="Empire.Auth.logout()" title="Ã‡Ä±xÄ±ÅŸ" style="font-size:.9rem;width:34px;height:34px;">ğŸšª</button>
      </div>
    </nav>

    <!-- MAIN CONTENT -->
    <main id="main-feed">

      <!-- FEED PAGE -->
      <div class="page on" id="page-feed">
        <!-- Announcement banner (admin tÉ™rÉ™findÉ™n gÃ¶ndÉ™rilir) -->
        <div id="announce-area"></div>

        <!-- Stories strip -->
        <div class="stories-strip" id="stories-strip">
          <div class="story-bub" onclick="Empire.Stories.openAdd()">
            <div class="story-ring story-add-ring">
              <div class="story-ring-in" style="font-size:1.4rem;color:var(--acc1);">ï¼‹</div>
            </div>
            <div class="story-label">ÆlavÉ™ et</div>
          </div>
        </div>

        <!-- Post Composer -->
        <div class="glass composer">
          <div class="comp-row">
            <div class="av av-md" id="comp-av" style="background:linear-gradient(135deg,var(--acc1),var(--acc2));flex-shrink:0;"></div>
            <textarea class="comp-area" id="comp-txt" placeholder="DÃ¼ÅŸÃ¼ncÉ™ni Empire ilÉ™ paylaÅŸ... (#hashtag istifadÉ™ et)"></textarea>
          </div>

          <!-- Image preview -->
          <div id="img-prev-wrap" style="display:none;margin:8px 0;">
            <img id="img-prev" style="max-height:150px;border-radius:var(--rad-sm);border:1px solid var(--border);"/>
            <button onclick="Empire.Social.clearImg()" style="background:none;border:none;color:var(--txt2);cursor:pointer;margin-left:6px;">âœ•</button>
          </div>

          <!-- Poll builder -->
          <div id="poll-builder" style="display:none;margin-top:10px;padding:12px;background:rgba(255,255,255,.03);border-radius:var(--rad-sm);border:1px dashed var(--border);">
            <div style="font-size:.82rem;color:var(--txt1);margin-bottom:8px;">ğŸ“Š Anket SeÃ§imlÉ™ri</div>
            <div class="poll-build" id="poll-opts">
              <input class="field" placeholder="SeÃ§im 1" style="margin-bottom:6px;"/>
              <input class="field" placeholder="SeÃ§im 2"/>
            </div>
            <button onclick="Empire.Social.addPollOpt()" class="btn btn-ghost btn-sm" style="margin-top:8px;">+ SeÃ§im ÆlavÉ™ et</button>
          </div>

          <div class="comp-bottom">
            <div class="comp-tools">
              <button class="comp-tool" title="ÅÉ™kil" onclick="document.getElementById('img-up').click()">ğŸ“·</button>
              <button class="comp-tool" title="Anket" id="poll-btn" onclick="Empire.Social.togglePoll(this)">ğŸ“Š</button>
              <button class="comp-tool" title="HÉ™diyyÉ™ gÃ¶ndÉ™r" onclick="Empire.Economy.giftModal()">ğŸ</button>
              <button class="comp-tool" title="Emoji">ğŸ˜Š</button>
              <input type="file" id="img-up" accept="image/*" style="display:none" onchange="Empire.Social.imgUpload(this)"/>
            </div>
            <button class="btn btn-acc1" onclick="Empire.Social.post()" id="post-btn">âš¡ PaylaÅŸ</button>
          </div>
        </div>

        <!-- Feed -->
        <div id="feed-wrap">
          <div class="spinner"></div>
        </div>
      </div>

      <!-- TRENDING PAGE -->
      <div class="page" id="page-trending">
        <h2 class="fam-d mb14" style="font-size:1.15rem;">ğŸ”¥ Trending Now</h2>
        <div id="trending-posts"><div class="spinner"></div></div>
      </div>

      <!-- DM PAGE -->
      <div class="page" id="page-dms" style="padding:0;height:calc(100vh - 58px);">
        <div id="dm-wrap">
          <div class="dm-list">
            <div class="dm-list-hd">
              <input class="field" placeholder="SÃ¶hbÉ™t axtar..." style="border-radius:50px;" oninput="Empire.DM.filterConvs(this.value)"/>
            </div>
            <div id="dm-convs"></div>
          </div>
          <div class="dm-chat" id="dm-chat">
            <div style="flex:1;display:flex;align-items:center;justify-content:center;flex-direction:column;gap:14px;color:var(--txt2);">
              <div style="font-size:3.5rem;opacity:.3;">ğŸ’¬</div>
              <div style="font-size:.9rem;">SÃ¶hbÉ™t seÃ§in vÉ™ ya baÅŸlayÄ±n</div>
              <button class="btn btn-ghost btn-sm" onclick="Empire.DM.newConv()">+ Yeni SÃ¶hbÉ™t</button>
            </div>
          </div>
        </div>
      </div>

      <!-- NOTIFICATIONS PAGE -->
      <div class="page" id="page-notifs">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;">
          <h2 class="fam-d" style="font-size:1.15rem;">ğŸ”” BildiriÅŸlÉ™r MÉ™rkÉ™zi</h2>
          <button class="btn btn-ghost btn-sm" onclick="Empire.Notifs.markAllRead()">HamÄ±sÄ±nÄ± oxu</button>
        </div>
        <div id="notif-wrap"><div class="spinner"></div></div>
      </div>

      <!-- SHOP PAGE -->
      <div class="page" id="page-shop">
        <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px;flex-wrap:wrap;gap:10px;">
          <h2 class="fam-d" style="font-size:1.15rem;">ğŸ›’ Empire MaÄŸazasÄ±</h2>
          <div class="tc-pill">âš¡ <span id="shop-tc">0</span> TC balansÄ±nÄ±z</div>
        </div>
        <div class="shop-grid" id="shop-grid"></div>
      </div>

      <!-- PROFILE PAGE -->
      <div class="page" id="page-profile">
        <div id="profile-wrap"><div class="spinner"></div></div>
      </div>

      <!-- ADMIN COMMAND CENTER -->
      <div class="page" id="page-admin">
        <!-- Content rendered by AdminModule.init() -->
        <div id="admin-wrap"><div class="spinner"></div></div>
      </div>

    </main>

    <!-- SIDEBAR RIGHT -->
    <aside id="sidebar-right">
      <div>
        <div class="sec-title">ğŸŸ¢ Online Ä°stifadÉ™Ã§ilÉ™r</div>
        <div id="online-list"></div>
      </div>
      <div>
        <div class="sec-title">ğŸ”¥ Trending HashtaglÉ™r</div>
        <div id="trend-list"></div>
      </div>
      <div>
        <div class="sec-title">ğŸ’¡ TÃ¶vsiyÉ™ Olunanlar</div>
        <div id="suggest-list"></div>
      </div>
    </aside>

  </div><!-- /main-layout -->

  <!-- Mobile bottom nav -->
  <nav id="mob-nav">
    <div class="mob-nav-it on" onclick="Empire.UI.nav('feed')">    <span class="mob-nav-ic">ğŸ </span>Ana</div>
    <div class="mob-nav-it"    onclick="Empire.UI.nav('trending')"><span class="mob-nav-ic">ğŸ”¥</span>Trend</div>
    <div class="mob-nav-it"    onclick="Empire.UI.nav('dms')">     <span class="mob-nav-ic">ğŸ’¬</span>Mesaj</div>
    <div class="mob-nav-it"    onclick="Empire.UI.nav('shop')">    <span class="mob-nav-ic">ğŸ›’</span>MaÄŸaza</div>
    <div class="mob-nav-it"    onclick="Empire.UI.nav('profile')"> <span class="mob-nav-ic">ğŸ‘¤</span>Profil</div>
  </nav>

</div><!-- /app -->

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     JAVASCRIPT â€” EMPIRE CLASS ARCHITECTURE
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script>
"use strict";
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UTILITY TOOLBELT â€” Stateless helpers. Imported everywhere.
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const U = {
  /** XSS sanitization â€” escapes HTML special chars before rendering */
  s(str){ if(!str)return''; return String(str).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[c])); },

  /** Time-ago formatter (Azerbaijani) */
  ago(ts){
    if(!ts) return '';
    const d = ts?.toMillis ? ts.toMillis() : (ts instanceof Date ? ts.getTime() : ts);
    const s = Math.floor((Date.now()-d)/1000);
    if(s<60)   return `${s}s É™vvÉ™l`;
    const m=Math.floor(s/60); if(m<60) return `${m}dq É™vvÉ™l`;
    const h=Math.floor(m/60); if(h<24) return `${h}sa É™vvÉ™l`;
    return `${Math.floor(h/24)}g É™vvÉ™l`;
  },

  /** Number shortener: 12300 â†’ 12.3K */
  n(v){ if(!v)return'0'; if(v>=1e6)return(v/1e6).toFixed(1)+'M'; if(v>=1e3)return(v/1e3).toFixed(1)+'K'; return String(v); },

  /** Avatar initials from display name */
  init(n){ if(!n)return'?'; return n.split(' ').slice(0,2).map(w=>w[0]?.toUpperCase()||'').join(''); },

  /** Profanity filter â€” replaces bad words with asterisks */
  filter(t){
    const bad=['fuck','shit','bitch','asshole','pis','orospu','sÃ¼rtÃ¼k','bok','cÉ™hÉ™nnÉ™m','la'];
    return bad.reduce((s,w)=>s.replace(new RegExp(w,'gi'),'*'.repeat(w.length)),t);
  },

  /** Extract hashtags from text */
  hashtags(t){ return (t.match(/#\w+/g)||[]).map(h=>h.toLowerCase()); },

  /** Debounce â€” delays fn until delay ms after last call */
  debounce(fn,d){ let t; return(...a)=>{clearTimeout(t);t=setTimeout(()=>fn(...a),d)}; },

  /** Level calculation: level = floor(sqrt(xp/80)) + 1 */
  level(xp){ return Math.floor(Math.sqrt((xp||0)/80))+1; },

  /** XP threshold for next level */
  xpForLvl(l){ return Math.pow(l-1,2)*80; },

  /** Ripple effect on button click */
  ripple(el,e){
    const r=el.getBoundingClientRect();
    const sz=Math.max(r.width,r.height);
    const rip=document.createElement('span');
    rip.className='ripple';
    const cx=(e?.clientX||r.left+r.width/2)-r.left-sz/2;
    const cy=(e?.clientY||r.top+r.height/2)-r.top-sz/2;
    Object.assign(rip.style,{width:sz+'px',height:sz+'px',left:cx+'px',top:cy+'px'});
    el.appendChild(rip); rip.addEventListener('animationend',()=>rip.remove());
  },

  /** Coin float animation at coordinates */
  coinFloat(amount,x,y){
    const el=document.createElement('div');
    el.className='coin-float'; el.textContent=`+${amount}âš¡`;
    Object.assign(el.style,{left:(x||window.innerWidth/2)+'px',top:(y||200)+'px'});
    document.body.appendChild(el);
    el.addEventListener('animationend',()=>el.remove());
  },

  /** Generate avatar HTML element string */
  avHTML(user,sz='av-md'){
    if(!user)return`<div class="av ${sz}" style="background:#333;">?</div>`;
    const pal=['#00f0ff','#ff2079','#c084fc','#00e8b0','#ffd60a'];
    const bg=user.profileColor||pal[(user.displayName||'?').charCodeAt(0)%pal.length];
    const ring=user.badge==='vip'?'av-ring':user.badge==='admin'?'av-ring-2':'';
    const online=user.isOnline&&!user.ghostMode?'av-online':'';
    const ghost=user.ghostMode?'av-ghost':'';
    return `<div class="av ${sz} ${ring} ${online} ${ghost}" style="background:${bg};position:relative;">
      ${user.photoURL?`<img src="${U.s(user.photoURL)}" style="width:100%;height:100%;object-fit:cover;border-radius:50%;position:absolute;inset:0;"/>`:''}
      ${U.init(user.displayName)}
    </div>`;
  },

  /** Badge chip HTML */
  chip(badge){
    if(!badge)return'';
    const map={
      verified:`<span class="chip chip-verified">âœ“ Verified</span>`,
      legend:  `<span class="chip chip-legend">â­ Legend</span>`,
      vip:     `<span class="chip chip-vip">ğŸ’ VIP</span>`,
      mod:     `<span class="chip chip-mod">ğŸ›¡ï¸ Mod</span>`,
      admin:   `<span class="chip chip-admin">ğŸ‘‘ Admin</span>`,
    };
    if(badge.startsWith('emoji:'))return`<span style="font-size:.95rem;">${badge.split(':')[1]}</span>`;
    return map[badge]||'';
  },

  /** Format hashtags in post text as clickable links */
  linkTags(t){
    return U.s(t).replace(/#(\w+)/g,`<span style="color:var(--acc1);cursor:pointer;font-weight:600;" onclick="Empire.Social.filterTag('#$1')">#$1</span>`);
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE STORE â€” Reactive central state management
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
class Store {
  constructor(){
    this._s={
      user:null,          // Firebase Auth user object
      profile:null,       // Firestore user profile document
      page:'feed',        // Currently active page key
      posts:[],           // Feed posts array (real-time)
      stories:[],         // Active stories (real-time)
      convs:[],           // DM conversations
      notifs:[],          // User notifications
      online:[],          // Currently online users
      tags:[],            // Trending hashtags
      ghostMode:false,    // Is current user in ghost mode?
      listeners:{},       // Map of active Firestore listeners for cleanup
      pendingImg:null,    // Image URL staged for post
      pollActive:false,   // Is poll composer open?
    };
    this._subs={};        // Reactive subscribers per key
  }
  get(k){return this._s[k];}
  set(k,v){
    this._s[k]=v;
    (this._subs[k]||[]).forEach(fn=>fn(v));
  }
  sub(k,fn){(this._subs[k]||(this._subs[k]=[])).push(fn);}
  addL(k,fn){if(this._s.listeners[k])this._s.listeners[k]();this._s.listeners[k]=fn;}
  clearL(){Object.values(this._s.listeners).forEach(f=>f?.());this._s.listeners={};}
}
const S = new Store();

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PARTICLE ENGINE â€” Interactive star/dust background
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
class ParticleEngine {
  constructor(){
    this.c=document.getElementById('particle-canvas');
    this.x=this.c.getContext('2d');
    this.particles=[];
    this.mouse={x:0,y:0};
    this._resize();
    this._spawn();
    this._loop();
    window.addEventListener('resize',()=>this._resize());
    document.addEventListener('mousemove',e=>{this.mouse.x=e.clientX;this.mouse.y=e.clientY;});
  }
  _resize(){this.c.width=window.innerWidth;this.c.height=window.innerHeight;}
  _spawn(){
    const n=Math.min(80,Math.floor(window.innerWidth/14));
    for(let i=0;i<n;i++)this.particles.push(this._mk());
  }
  _mk(){
    return{
      x:Math.random()*window.innerWidth,
      y:Math.random()*window.innerHeight,
      vx:(Math.random()-.5)*.4,
      vy:(Math.random()-.5)*.4,
      r:Math.random()*2+.5,
      a:Math.random()*.7+.2,
      life:Math.random()*300+200
    };
  }
  _loop(){
    const ctx=this.x, W=this.c.width, H=this.c.height;
    ctx.clearRect(0,0,W,H);
    const col=getComputedStyle(document.documentElement).getPropertyValue('--particle-color').trim()||'#00f0ff';
    this.particles.forEach((p,i)=>{
      p.x+=p.vx; p.y+=p.vy;
      /* Wrap around edges */
      if(p.x<0)p.x=W; if(p.x>W)p.x=0;
      if(p.y<0)p.y=H; if(p.y>H)p.y=0;
      /* Draw dot */
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.r,0,Math.PI*2);
      ctx.fillStyle=col;
      ctx.globalAlpha=p.a;
      ctx.fill();
      /* Draw connections to nearby particles */
      for(let j=i+1;j<this.particles.length;j++){
        const q=this.particles[j];
        const dx=p.x-q.x, dy=p.y-q.y;
        const dist=Math.sqrt(dx*dx+dy*dy);
        if(dist<120){
          ctx.beginPath();
          ctx.moveTo(p.x,p.y); ctx.lineTo(q.x,q.y);
          ctx.strokeStyle=col;
          ctx.globalAlpha=(1-dist/120)*.15;
          ctx.lineWidth=.5; ctx.stroke();
        }
      }
      /* Mouse repel effect */
      const mx=p.x-this.mouse.x, my=p.y-this.mouse.y;
      const md=Math.sqrt(mx*mx+my*my);
      if(md<100){ p.vx+=mx/md*.08; p.vy+=my/md*.08; }
      /* Dampen velocity */
      p.vx*=.99; p.vy*=.99;
    });
    ctx.globalAlpha=1;
    requestAnimationFrame(()=>this._loop());
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   UI ENGINE â€” Navigation, toasts, modals, context menus, cursor
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const UIEngine = {
  /** Navigate to a page by key */
  nav(page){
    const old=S.get('page');
    if(old===page)return;
    S.set('page',page);
    document.querySelectorAll('.page').forEach(p=>p.classList.remove('on'));
    document.getElementById(`page-${page}`)?.classList.add('on');
    document.querySelectorAll('[data-p],.mob-nav-it').forEach(n=>n.classList.remove('on'));
    document.querySelectorAll(`[data-p="${page}"]`).forEach(n=>n.classList.add('on'));
    document.querySelectorAll('.mob-nav-it').forEach((n,i)=>{
      const pages=['feed','trending','dms','shop','profile'];
      if(pages[i]===page)n.classList.add('on');
    });
    this._onNav(page);
  },

  /** Page-specific data loading on navigation */
  _onNav(p){
    ({
      feed:     ()=>Empire.Social.loadFeed(),
      trending: ()=>Empire.Social.loadTrending(),
      profile:  ()=>Empire.Profile.load(S.get('user')?.uid),
      admin:    ()=>Empire.Admin.init(),
      shop:     ()=>Empire.Economy.renderShop(),
      notifs:   ()=>Empire.Notifs.load(),
      dms:      ()=>Empire.DM.loadConvs(),
    }[p]||function(){})();
  },

  /** Toast notification system */
  toast(msg,type='info',dur=3400){
    const icons={ok:'âœ…',err:'âŒ',info:'â„¹ï¸',warn:'âš ï¸'};
    const el=document.createElement('div');
    el.className=`toast ${type}`;
    el.innerHTML=`<span>${icons[type]||'â„¹ï¸'}</span><span>${U.s(msg)}</span>`;
    document.getElementById('toast-box').appendChild(el);
    setTimeout(()=>{
      el.style.animation='toastOut .4s ease forwards';
      el.addEventListener('animationend',()=>el.remove());
    },dur);
  },

  /** Modal system */
  openModal(title,html){
    document.getElementById('modal-title').textContent=title;
    document.getElementById('modal-body').innerHTML=html;
    document.getElementById('modal-bg').classList.add('on');
  },
  closeModal(){document.getElementById('modal-bg').classList.remove('on');},

  /** Context menu */
  ctxMenu(x,y,items){
    const m=document.getElementById('ctx-menu');
    m.innerHTML=items.map(it=>it==='---'
      ?'<hr style="border:none;border-top:1px solid var(--border);margin:4px 0;">'
      :`<div class="ctx-it ${it.red?'red':''}" onclick="(${it.fn})();document.getElementById('ctx-menu').classList.remove('on')">
          ${it.ic?`<span>${it.ic}</span>`:''} ${U.s(it.lbl)}
        </div>`
    ).join('');
    m.style.cssText=`left:${Math.min(x,window.innerWidth-170)}px;top:${Math.min(y,window.innerHeight-250)}px;`;
    m.classList.add('on');
  },

  /** Update UI elements with user profile data */
  updateUI(prof){
    if(!prof)return;
    const av=el=>{ if(!el)return; el.style.background=prof.profileColor||'linear-gradient(135deg,var(--acc1),var(--acc2))'; el.innerHTML=U.init(prof.displayName)+(prof.photoURL?`<img src="${U.s(prof.photoURL)}" style="position:absolute;inset:0;width:100%;height:100%;object-fit:cover;border-radius:50%;"/>`:``); };
    av(document.getElementById('topbar-av'));
    av(document.getElementById('side-av'));
    av(document.getElementById('comp-av'));
    document.getElementById('side-name').textContent=prof.displayName||'';
    const lv=U.level(prof.xp||0);
    const nxp=U.xpForLvl(lv+1), cxp=U.xpForLvl(lv);
    const prog=Math.min(((prof.xp||0)-cxp)/(nxp-cxp)*100,100);
    document.getElementById('side-lvl').textContent=`Lvl ${lv} Â· ${prof.xp||0} XP`;
    document.getElementById('xp-fill').style.width=prog+'%';
    document.getElementById('tc-disp').textContent=U.n(prof.titanCoins||0);
    document.getElementById('shop-tc').textContent=U.n(prof.titanCoins||0);
    if(prof.role==='admin')document.getElementById('admin-nav')?.classList.remove('hidden');
    if(prof.ghostMode){
      document.getElementById('ghost-toggle').classList.add('active');
      S.set('ghostMode',true);
    }
  },

  /** Theme switcher */
  theme(t,el){
    document.documentElement.setAttribute('data-theme',t);
    document.querySelectorAll('.t-dot').forEach(d=>d.classList.remove('on'));
    el?.classList.add('on');
  },

  /** Cursor glow â€” tracks mouse */
  initCursor(){
    const g=document.getElementById('cursor-glow');
    document.addEventListener('mousemove',e=>{
      g.style.left=e.clientX+'px'; g.style.top=e.clientY+'px';
    });
    document.addEventListener('click',e=>{
      const btn=e.target.closest('.btn,.pa-btn,.nav-it,.dm-item');
      if(btn)U.ripple(btn,e);
    });
    document.addEventListener('click',()=>document.getElementById('ctx-menu').classList.remove('on'));
    document.addEventListener('keydown',e=>{
      if(e.key==='Escape'){this.closeModal();Empire.Stories.close();}
    });
  },

  /** Section title helper */
  sec(t){return`<div class="sec-title">${t}</div>`;}
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUTH MODULE â€” Registration, Login, Logout, Auth State
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const AuthModule = {
  _mode:'login',

  tab(m,el){
    this._mode=m;
    document.querySelectorAll('.auth-tab').forEach(t=>t.classList.remove('on'));
    el.classList.add('on');
    document.getElementById('f-name').classList.toggle('hidden',m!=='register');
    document.getElementById('a-btn').textContent=m==='register'?'Qeydiyyatdan keÃ§':'Daxil ol';
    document.getElementById('auth-err').style.display='none';
  },

  async submit(e){
    e.preventDefault();
    const {auth,db,createUserWithEmailAndPassword,signInWithEmailAndPassword,
           updateProfile,doc,setDoc,serverTimestamp}=window.__FB;
    const email=document.getElementById('a-email').value.trim();
    const pass =document.getElementById('a-pass').value;
    const name =document.getElementById('a-name')?.value.trim()||'';
    const errEl=document.getElementById('auth-err');
    const btn  =document.getElementById('a-btn');
    errEl.style.display='none'; btn.disabled=true; btn.textContent='â³...';
    try{
      if(this._mode==='register'){
        const cred=await createUserWithEmailAndPassword(auth,email,pass);
        await updateProfile(cred.user,{displayName:name||'Empire QÉ™hrÉ™manÄ±'});
        /* Create Firestore profile document with default values */
        await setDoc(doc(db,'users',cred.user.uid),{
          displayName:name||'Empire QÉ™hrÉ™manÄ±',
          email,photoURL:null,bio:'',
          titanCoins:200,      /* BaÅŸlanÄŸÄ±c TC */
          xp:0,badge:null,role:'user',
          profileColor:'#00f0ff',frame:null,
          followers:[],following:[],postCount:0,
          isOnline:true,ghostMode:false,
          createdAt:serverTimestamp(),lastSeen:serverTimestamp(),
          medals:[],achievements:{},visitorCount:0,
          isBanned:false,isMuted:false,
          activeBoosts:[],
        });
        Empire.UI.toast('XoÅŸ gÉ™ldiniz! +200 TC hÉ™diyyÉ™! ğŸ‰','ok');
      } else {
        await signInWithEmailAndPassword(auth,email,pass);
      }
    } catch(err){
      const msgs={'auth/user-not-found':'Ä°stifadÉ™Ã§i tapÄ±lmadÄ±.','auth/wrong-password':'ÅifrÉ™ yanlÄ±ÅŸ.',
        'auth/email-already-in-use':'Bu email istifadÉ™ edilir.','auth/weak-password':'ÅifrÉ™ â‰¥6 simvol.'};
      errEl.textContent=msgs[err.code]||err.message;
      errEl.style.display='block';
    } finally{ btn.disabled=false; btn.textContent=this._mode==='register'?'Qeydiyyatdan keÃ§':'Daxil ol'; }
  },

  async logout(){
    const{auth,db,doc,updateDoc,signOut,serverTimestamp}=window.__FB;
    const uid=S.get('user')?.uid;
    try{
      if(uid)await updateDoc(doc(db,'users',uid),{isOnline:false,lastSeen:serverTimestamp()});
      S.clearL();
      await signOut(auth);
    }catch{}
  },

  /** Listen for auth state changes â€” main entry point */
  listen(){
    const{auth,db,onAuthStateChanged,doc,getDoc,onSnapshot,updateDoc,serverTimestamp}=window.__FB;
    onAuthStateChanged(auth,async user=>{
      if(user){
        S.set('user',user);
        document.getElementById('auth-screen').style.display='none';
        document.getElementById('main-layout').style.display='grid';
        /* Load and listen to profile */
        const snap=await getDoc(doc(db,'users',user.uid));
        if(snap.exists()){
          const prof=snap.data();
          if(prof.isBanned){
            Empire.UI.toast('HesabÄ±nÄ±z bloklanÄ±b. AdminlÉ™ É™laqÉ™ saxlayÄ±n.','err',8000);
            await this.logout(); return;
          }
          S.set('profile',prof);
          Empire.UI.updateUI(prof);
        }
        await updateDoc(doc(db,'users',user.uid),{isOnline:true,lastSeen:serverTimestamp()});
        /* Real-time profile listener */
        const unsub=onSnapshot(doc(db,'users',user.uid),s=>{
          if(s.exists()){S.set('profile',s.data());Empire.UI.updateUI(s.data());}
        });
        S.addL('profile',unsub);
        /* Bootstrap all modules */
        Empire.Social.loadFeed();
        Empire.Social.loadOnline();
        Empire.Social.loadTags();
        Empire.Stories.load();
        Empire.Economy.renderShop();
        Empire.Notifs.listen();
        Empire.Social.loadAnnouncements();
      } else {
        S.set('user',null); S.set('profile',null); S.clearL();
        document.getElementById('auth-screen').style.display='flex';
        document.getElementById('main-layout').style.display='none';
      }
    });
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SOCIAL MODULE â€” Feed, Posts, Likes, Comments, Search, Stories refs
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SocialModule = {
  _pendingImg:null,
  _pendingPoll:false,
  _searchD:U.debounce(v=>this._doSearch(v),420),

  /** Load real-time feed with Firestore snapshot listener */
  loadFeed(){
    const{db,collection,query,orderBy,limit,onSnapshot}=window.__FB;
    document.getElementById('feed-wrap').innerHTML='<div class="spinner"></div>';
    const q=query(collection(db,'posts'),orderBy('createdAt','desc'),limit(40));
    const unsub=onSnapshot(q,snap=>{
      const posts=snap.docs.map(d=>({id:d.id,...d.data()}));
      S.set('posts',posts);
      this._renderPosts(posts,document.getElementById('feed-wrap'));
    },err=>{document.getElementById('feed-wrap').innerHTML=`<p class="text-m text-c">${err.message}</p>`;});
    S.addL('feed',unsub);
  },

  /** Load trending posts sorted by like count */
  loadTrending(){
    const{db,collection,query,orderBy,limit,onSnapshot}=window.__FB;
    const el=document.getElementById('trending-posts');
    el.innerHTML='<div class="spinner"></div>';
    const q=query(collection(db,'posts'),orderBy('likeCount','desc'),limit(25));
    const unsub=onSnapshot(q,snap=>{
      this._renderPosts(snap.docs.map(d=>({id:d.id,...d.data()})),el);
    });
    S.addL('trending',unsub);
  },

  /** Render post array into target container element */
  _renderPosts(posts,el){
    if(!posts.length){
      el.innerHTML='<div class="text-c text-m" style="padding:48px;">HÉ™lÉ™ post yoxdur. Ä°lk postu siz yazÄ±n! âœï¸</div>';
      return;
    }
    const uid=S.get('user')?.uid;
    el.innerHTML=posts.map(p=>{
      const liked=(p.likes||[]).includes(uid);
      return `
      <article class="glass post" data-id="${p.id}">
        <div class="post-hd">
          <div style="cursor:pointer" onclick="Empire.Profile.load('${p.uid}');Empire.UI.nav('profile')">${U.avHTML({displayName:p.authorName,profileColor:p.authorColor,photoURL:p.authorPhoto||null},'av-md')}</div>
          <div class="post-meta">
            <div class="post-author" onclick="Empire.Profile.load('${p.uid}');Empire.UI.nav('profile')">
              ${U.s(p.authorName||'Anonim')} ${U.chip(p.authorBadge)} <span class="lv-badge">Lvl ${U.level(p.authorXP||0)}</span>
            </div>
            <div class="post-ts">${U.ago(p.createdAt)}</div>
          </div>
          <button class="pa-more" onclick="Empire.Social.postMenu(event,'${p.id}','${p.uid}')">â‹¯</button>
        </div>
        ${p.text?`<div class="post-txt">${U.linkTags(p.text)}</div>`:''}
        ${p.imageURL?`<img class="post-img" src="${U.s(p.imageURL)}" loading="lazy"/>`:''}
        ${p.audio?`<div class="audio-player">
          <span class="audio-play" onclick="Empire.Social.playAudio('${p.audio}',this)">â–¶</span>
          <div class="audio-bar"><div class="audio-prog" id="ap-${p.id}" style="width:0%"></div></div>
          <span class="audio-time">0:00</span>
        </div>`:''}
        ${p.poll?this._pollHTML(p):''}
        <div class="post-actions">
          <button class="pa-btn ${liked?'liked':''}" onclick="Empire.Social.toggleLike('${p.id}',this)">
            ${liked?'â¤ï¸':'ğŸ¤'} <span>${U.n((p.likes||[]).length)}</span>
          </button>
          <button class="pa-btn" onclick="Empire.Social.openComments('${p.id}')">ğŸ’¬ <span>${U.n(p.commentCount||0)}</span></button>
          <button class="pa-btn" onclick="Empire.Social.sharePost('${p.id}')">ğŸ” <span>${U.n(p.shareCount||0)}</span></button>
          <button class="pa-btn" onclick="Empire.Economy.giftToPost('${p.uid}')">ğŸ</button>
          <button class="pa-btn" onclick="Empire.Social.reportPost('${p.id}')">ğŸš©</button>
        </div>
      </article>`;
    }).join('');
  },

  /** Build HTML for embedded poll widget */
  _pollHTML(p){
    const total=(p.poll.votes||[]).length||1;
    return `<div class="poll-wrap">${(p.poll.options||[]).map((opt,i)=>{
      const votes=(p.poll.votes||[]).filter(v=>v.choice===i).length;
      const pct=Math.round(votes/total*100);
      const uid=S.get('user')?.uid;
      const myVote=(p.poll.votes||[]).find(v=>v.uid===uid);
      return `<div class="poll-opt ${myVote?'voted':''}" onclick="${myVote?'':  `Empire.Social.votePoll('${p.id}',${i},this)`}">
        <div class="poll-fill" style="width:${myVote?pct:0}%"></div>
        <span class="poll-text">${U.s(opt)}</span>
        ${myVote?`<span class="poll-pct">${pct}%</span>`:''}
      </div>`;
    }).join('')}</div>`;
  },

  /** Create a new post with optional image, poll, hashtags */
  async post(){
    const{db,collection,addDoc,doc,updateDoc,increment,serverTimestamp}=window.__FB;
    const user=S.get('user'), prof=S.get('userProfile')||S.get('profile');
    if(!user||!prof)return;
    let text=document.getElementById('comp-txt').value.trim();
    if(!text&&!this._pendingImg){Empire.UI.toast('Post boÅŸ ola bilmÉ™z.','warn');return;}
    if(prof.isMuted){Empire.UI.toast('HesabÄ±nÄ±z susturulmuÅŸdur. AdminlÉ™ É™laqÉ™ saxlayÄ±n.','err');return;}
    text=U.filter(text);
    const tags=U.hashtags(text);
    /* Build poll data if poll builder is open */
    let pollData=null;
    if(this._pendingPoll){
      const opts=[...document.querySelectorAll('#poll-opts .field')].map(i=>i.value.trim()).filter(Boolean);
      if(opts.length>=2)pollData={options:opts,votes:[]};
    }
    const btn=document.getElementById('post-btn');
    btn.disabled=true; btn.textContent='â³...';
    try{
      await addDoc(collection(db,'posts'),{
        uid:user.uid,
        authorName:prof.displayName,
        authorBadge:prof.badge||null,
        authorColor:prof.profileColor||'#00f0ff',
        authorPhoto:prof.photoURL||null,
        authorXP:prof.xp||0,
        text,hashtags:tags,
        imageURL:this._pendingImg||null,
        poll:pollData,
        audio:null,
        likes:[],likeCount:0,
        commentCount:0,shareCount:0,
        reports:[],
        createdAt:serverTimestamp(),
      });
      /* Reward XP and TC for posting */
      await updateDoc(doc(db,'users',user.uid),{
        postCount:increment(1),xp:increment(15),titanCoins:increment(8),
      });
      /* Update hashtag counters */
      for(const tag of tags)await this._bumpTag(tag);
      /* Check achievements */
      await Empire.Economy.checkAchievements();
      document.getElementById('comp-txt').value='';
      this.clearImg(); this._pendingPoll=false;
      document.getElementById('poll-builder').style.display='none';
      document.getElementById('poll-btn').classList.remove('active');
      Empire.UI.toast('Post paylaÅŸÄ±ldÄ±! +8 TC +15 XP âš¡','ok');
      U.coinFloat(8,window.innerWidth/2,200);
    }catch(err){Empire.UI.toast('XÉ™ta: '+err.message,'err');}
    finally{btn.disabled=false;btn.textContent='âš¡ PaylaÅŸ';}
  },

  async _bumpTag(tag){
    const{db,doc,setDoc,updateDoc,increment,getDoc}=window.__FB;
    const ref=doc(db,'hashtags',tag);
    const snap=await getDoc(ref);
    if(snap.exists())await updateDoc(ref,{count:increment(1)});
    else await setDoc(ref,{tag,count:1});
  },

  /** Toggle like on/off with TC reward */
  async toggleLike(postId,btn){
    const{db,doc,updateDoc,arrayUnion,arrayRemove,increment,addDoc,collection,serverTimestamp}=window.__FB;
    const uid=S.get('user')?.uid;
    const post=S.get('posts').find(p=>p.id===postId);
    if(!uid||!post)return;
    const liked=(post.likes||[]).includes(uid);
    try{
      const upd=liked?{likes:arrayRemove(uid),likeCount:increment(-1)}:{likes:arrayUnion(uid),likeCount:increment(1)};
      await updateDoc(doc(db,'posts',postId),upd);
      if(!liked&&post.uid!==uid){
        /* Author gets TC for receiving likes */
        await updateDoc(doc(db,'users',post.uid),{titanCoins:increment(2),xp:increment(3)});
        /* Send notification */
        await addDoc(collection(db,'users',post.uid,'notifs'),{
          type:'like',fromName:S.get('profile')?.displayName,fromUid:uid,
          msg:`${S.get('profile')?.displayName} postunu bÉ™yÉ™ndi â¤ï¸`,
          postId,createdAt:serverTimestamp(),read:false,
        });
      }
      /* Optimistic UI update */
      const cnt=btn.querySelector('span');
      const n=parseInt(cnt.textContent.replace(/[KM]/,''))||0;
      btn.classList.toggle('liked',!liked);
      btn.innerHTML=`${!liked?'â¤ï¸':'ğŸ¤'} <span>${U.n((post.likes||[]).length+(liked?-1:1))}</span>`;
    }catch(err){Empire.UI.toast('BÉ™yÉ™nmÉ™ xÉ™tasÄ±.','err');}
  },

  /** Vote on a poll option */
  async votePoll(postId,choice,el){
    const{db,doc,updateDoc,arrayUnion}=window.__FB;
    const uid=S.get('user')?.uid; if(!uid)return;
    try{
      await updateDoc(doc(db,'posts',postId),{
        'poll.votes':arrayUnion({uid,choice,ts:Date.now()})
      });
      /* Animate fill bar */
      el.classList.add('voted');
      el.querySelector('.poll-fill').style.width='50%';
      Empire.UI.toast('Sesiniz qeydÉ™ alÄ±ndÄ±!','ok');
    }catch{}
  },

  /** Open comments modal */
  openComments(postId){
    const{db,collection,query,orderBy,onSnapshot,addDoc,doc,updateDoc,increment,serverTimestamp}=window.__FB;
    Empire.UI.openModal('ğŸ’¬ ÅÉ™rhlÉ™r',`
      <div id="cmts" style="max-height:300px;overflow-y:auto;margin-bottom:14px;"></div>
      <div style="display:flex;gap:8px;">
        <input class="field" id="cmt-in" placeholder="ÅÉ™rh yaz..." style="border-radius:50px;"/>
        <button class="btn btn-acc1 btn-sm" onclick="Empire.Social.submitCmt('${postId}')">GÃ¶ndÉ™r</button>
      </div>`);
    const q=query(collection(db,'posts',postId,'comments'),orderBy('createdAt','asc'));
    onSnapshot(q,snap=>{
      const el=document.getElementById('cmts'); if(!el)return;
      el.innerHTML=snap.docs.length?snap.docs.map(d=>{const c=d.data();return`
        <div style="display:flex;gap:9px;margin-bottom:11px;">
          ${U.avHTML({displayName:c.authorName},'av-sm')}
          <div class="glass-inset" style="padding:8px 13px;flex:1;">
            <div style="font-weight:700;font-size:.82rem;margin-bottom:3px;">${U.s(c.authorName)}</div>
            <div style="font-size:.87rem;">${U.s(U.filter(c.text))}</div>
            <div style="font-size:.71rem;color:var(--txt2);margin-top:3px;">${U.ago(c.createdAt)}</div>
          </div>
        </div>`}).join(''):'<p class="text-m text-c" style="padding:20px;">Ä°lk ÅŸÉ™rhi siz yazÄ±n!</p>';
      el.scrollTop=el.scrollHeight;
    });
  },

  async submitCmt(postId){
    const{db,collection,addDoc,doc,updateDoc,increment,serverTimestamp}=window.__FB;
    const el=document.getElementById('cmt-in'); if(!el)return;
    const text=el.value.trim(); if(!text)return;
    const prof=S.get('profile'), uid=S.get('user')?.uid;
    try{
      await addDoc(collection(db,'posts',postId,'comments'),{
        uid,authorName:prof.displayName,text:U.filter(text),createdAt:serverTimestamp()
      });
      await updateDoc(doc(db,'posts',postId),{commentCount:increment(1)});
      await updateDoc(doc(db,'users',uid),{xp:increment(5),titanCoins:increment(2)});
      el.value='';
    }catch{}
  },

  /** Post context menu */
  postMenu(e,postId,authorUid){
    e.stopPropagation();
    const uid=S.get('user')?.uid;
    const isAdmin=S.get('profile')?.role==='admin';
    const isOwner=authorUid===uid;
    const items=[
      {ic:'ğŸ”—',lbl:'Linki kopyala',fn:`navigator.clipboard.writeText(location.href+'?p=${postId}')`},
      {ic:'ğŸš©',lbl:'ÅikayÉ™t et',  fn:`Empire.Social.reportPost('${postId}')`},
      '---',
    ];
    if(isOwner||isAdmin)items.push({ic:'ğŸ—‘ï¸',lbl:'Postu sil',fn:`Empire.Social.deletePost('${postId}')`,red:true});
    Empire.UI.ctxMenu(e.clientX,e.clientY,items);
  },

  async deletePost(postId){
    if(!confirm('Bu postu silmÉ™k istÉ™yirsiniz?'))return;
    const{db,doc,deleteDoc}=window.__FB;
    await deleteDoc(doc(db,'posts',postId)).catch(()=>{});
    Empire.UI.toast('Post silindi.','ok');
  },

  async reportPost(postId){
    const{db,addDoc,collection,serverTimestamp}=window.__FB;
    const prof=S.get('profile'), uid=S.get('user')?.uid;
    await addDoc(collection(db,'reports'),{
      postId,reportedBy:uid,reporterName:prof?.displayName,
      reason:'Ä°stifadÉ™Ã§i ÅŸikayÉ™ti',createdAt:serverTimestamp(),status:'pending'
    }).catch(()=>{});
    Empire.UI.toast('ÅikayÉ™t admina gÃ¶ndÉ™rildi.','info');
  },

  /** Image upload handler */
  async imgUpload(inp){
    const{storage,storageRef,uploadBytes,getDownloadURL}=window.__FB;
    const f=inp.files[0]; if(!f)return;
    if(f.size>8e6){Empire.UI.toast('ÅÉ™kil 8MB-dan kiÃ§ik olmalÄ±dÄ±r.','err');return;}
    const reader=new FileReader();
    reader.onload=e=>{
      document.getElementById('img-prev').src=e.target.result;
      document.getElementById('img-prev-wrap').style.display='flex';
    };
    reader.readAsDataURL(f);
    try{
      const uid=S.get('user').uid;
      const ref=storageRef(window.__FB.storage,`posts/${uid}/${Date.now()}_${f.name}`);
      const snap=await uploadBytes(ref,f);
      this._pendingImg=await getDownloadURL(snap.ref);
      Empire.UI.toast('ÅÉ™kil yÃ¼klÉ™ndi âœ“','ok');
    }catch(err){Empire.UI.toast('YÃ¼klÉ™mÉ™ xÉ™tasÄ±.','err');}
  },
  clearImg(){ this._pendingImg=null; document.getElementById('img-prev-wrap').style.display='none'; document.getElementById('img-up').value=''; },

  /** Toggle poll composer */
  togglePoll(btn){
    this._pendingPoll=!this._pendingPoll;
    btn.classList.toggle('active',this._pendingPoll);
    document.getElementById('poll-builder').style.display=this._pendingPoll?'block':'none';
  },

  /** Add another poll option input */
  addPollOpt(){
    const el=document.createElement('input');
    el.className='field'; el.placeholder=`SeÃ§im ${document.querySelectorAll('#poll-opts .field').length+1}`;
    el.style.marginTop='6px';
    document.getElementById('poll-opts').appendChild(el);
  },

  /** Ghost mode toggle */
  async toggleGhost(){
    const{db,doc,updateDoc}=window.__FB;
    const uid=S.get('user')?.uid; if(!uid)return;
    const gm=!S.get('ghostMode');
    S.set('ghostMode',gm);
    document.getElementById('ghost-toggle').classList.toggle('active',gm);
    await updateDoc(doc(db,'users',uid),{ghostMode:gm,isOnline:!gm});
    Empire.UI.toast(gm?'ğŸ‘» Ghost Mode aÃ§Ä±ldÄ± â€” heÃ§ kim sizi gÃ¶rmÃ¼r.':'Ghost Mode baÄŸlandÄ±.',gm?'info':'ok');
  },

  /** Load online users for right sidebar */
  loadOnline(){
    const{db,collection,query,where,limit,onSnapshot}=window.__FB;
    const q=query(collection(db,'users'),where('isOnline','==',true),where('ghostMode','==',false),limit(12));
    const unsub=onSnapshot(q,snap=>{
      const users=snap.docs.map(d=>({uid:d.id,...d.data()}));
      S.set('online',users);
      const el=document.getElementById('online-list');
      if(!el)return;
      const uid=S.get('user')?.uid;
      el.innerHTML=users.filter(u=>u.uid!==uid).slice(0,6).map(u=>`
        <div class="online-it" onclick="Empire.Profile.load('${u.uid}');Empire.UI.nav('profile')">
          ${U.avHTML({...u,isOnline:true},'av-sm')}
          <div><div style="font-size:.85rem;font-weight:700;">${U.s(u.displayName)}</div>
          <div style="font-size:.72rem;color:var(--online);">â— Online</div></div>
        </div>`).join('')||'<p class="text-m" style="padding:8px;font-size:.82rem;">Kimse online deyil.</p>';
      /* Also render suggest list */
      document.getElementById('suggest-list').innerHTML=users.filter(u=>u.uid!==uid).slice(0,3).map(u=>`
        <div style="display:flex;align-items:center;gap:9px;margin-bottom:11px;">
          ${U.avHTML(u,'av-sm')}
          <div style="flex:1;min-width:0;"><div style="font-size:.85rem;font-weight:700;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${U.s(u.displayName)}</div>${U.chip(u.badge)}</div>
          <button class="btn btn-ghost btn-sm" onclick="Empire.Social.follow('${u.uid}')">Ä°zlÉ™</button>
        </div>`).join('');
    });
    S.addL('online',unsub);
  },

  /** Load trending hashtags for right sidebar */
  loadTags(){
    const{db,collection,query,orderBy,limit,onSnapshot}=window.__FB;
    const q=query(collection(db,'hashtags'),orderBy('count','desc'),limit(8));
    const unsub=onSnapshot(q,snap=>{
      const tags=snap.docs.map(d=>({tag:d.id,...d.data()}));
      S.set('tags',tags);
      document.getElementById('trend-list').innerHTML=tags.map((t,i)=>`
        <div class="trend-it" onclick="Empire.Social.filterTag('${t.tag}')">
          <div class="trend-rank">#${i+1}</div>
          <div><div class="trend-tag">${U.s(t.tag)}</div>
          <div class="trend-cnt">${U.n(t.count)} post</div></div>
        </div>`).join('');
    });
    S.addL('tags',unsub);
  },

  filterTag(tag){ Empire.UI.nav('trending'); Empire.UI.toast(`"${tag}" filtrlÉ™ndi`,'info'); },

  sharePost(postId){
    navigator.clipboard?.writeText(location.href+'?p='+postId);
    Empire.UI.toast('Link kopyalandÄ±!','ok');
  },

  async follow(targetUid){
    const{db,doc,updateDoc,arrayUnion,increment}=window.__FB;
    const uid=S.get('user')?.uid; if(!uid||uid===targetUid)return;
    await updateDoc(doc(db,'users',uid),{following:arrayUnion(targetUid)}).catch(()=>{});
    await updateDoc(doc(db,'users',targetUid),{followers:arrayUnion(uid),xp:increment(5)}).catch(()=>{});
    Empire.UI.toast('Ä°zlÉ™mÉ™yÉ™ baÅŸladÄ±nÄ±z!','ok');
  },

  search:U.debounce(async function(v){
    if(!v||v.length<2){document.getElementById('search-drop')?.remove();return;}
    // Check for /admin command
    if(v.trim()==='/admin'){
      Empire.UI.nav('admin');
      document.getElementById('search-inp').value='';
      return;
    }
    const{db,collection,query,where,limit,getDocs}=window.__FB;
    try{
      const q=query(collection(db,'users'),where('displayName','>=',v),where('displayName','<=',v+'\uf8ff'),limit(5));
      const snap=await getDocs(q);
      const users=snap.docs.map(d=>({uid:d.id,...d.data()}));
      let drop=document.getElementById('search-drop');
      if(!drop){drop=document.createElement('div');drop.id='search-drop';drop.className='glass';Object.assign(drop.style,{position:'absolute',top:'52px',left:'50%',transform:'translateX(-50%)',zIndex:'500',width:'360px',maxHeight:'260px',overflowY:'auto',padding:'6px'});document.getElementById('topbar').appendChild(drop);}
      drop.innerHTML=users.map(u=>`
        <div class="dm-item" onclick="Empire.Profile.load('${u.uid}');Empire.UI.nav('profile');document.getElementById('search-drop')?.remove()">
          ${U.avHTML(u,'av-sm')}
          <div><div style="font-size:.87rem;font-weight:700;">${U.s(u.displayName)}</div>${U.chip(u.badge)}</div>
        </div>`).join('')||'<p class="text-m text-c" style="padding:14px;font-size:.83rem;">NÉ™ticÉ™ tapÄ±lmadÄ±.</p>';
      setTimeout(()=>drop.addEventListener('click',()=>drop.remove()),100);
    }catch{}
  },400),

  playAudio(url,btn){ Empire.UI.toast('SÉ™s oynatma tezliklÉ™!','info'); },

  /** Load admin announcements */
  async loadAnnouncements(){
    const{db,collection,query,orderBy,limit,onSnapshot}=window.__FB;
    const q=query(collection(db,'announcements'),orderBy('createdAt','desc'),limit(3));
    onSnapshot(q,snap=>{
      const area=document.getElementById('announce-area'); if(!area)return;
      area.innerHTML=snap.docs.map(d=>{const a=d.data();return`
        <div class="announce-banner glass">
          <span style="font-size:1.3rem;">ğŸ“¢</span>
          <div><div style="font-weight:700;font-size:.88rem;">${U.s(a.title||'Sistem ElanÄ±')}</div>
          <div style="font-size:.82rem;color:var(--txt1);margin-top:2px;">${U.s(a.msg)}</div></div>
        </div>`}).join('');
    });
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STORIES MODULE â€” 24h stories, viewer, add story
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const StoriesModule = {
  _idx:0, _list:[], _timer:null,

  /** Load and listen to active stories */
  load(){
    const{db,collection,query,where,orderBy,onSnapshot}=window.__FB;
    const exp=new Date(Date.now()-86400000);
    const q=query(collection(db,'stories'),where('createdAt','>',exp),orderBy('createdAt','desc'));
    const unsub=onSnapshot(q,snap=>{
      const st=snap.docs.map(d=>({id:d.id,...d.data()}));
      S.set('stories',st); this._renderStrip(st);
    });
    S.addL('stories',unsub);
  },

  /** Render story bubbles strip */
  _renderStrip(stories){
    const strip=document.getElementById('stories-strip');
    const add=strip.firstElementChild;
    [...strip.children].slice(1).forEach(e=>e.remove());
    const grouped=this._group(stories);
    grouped.forEach(g=>{
      const uid=S.get('user')?.uid;
      const seen=g.stories[0].seenBy?.includes(uid);
      const bub=document.createElement('div');
      bub.className='story-bub';
      bub.innerHTML=`
        <div class="story-ring ${seen?'seen':''}">
          <div class="story-ring-in" style="background:${g.stories[0].bgColor||'var(--bg1)'};">
            ${U.init(g.name)}
          </div>
        </div>
        <div class="story-label">${U.s(g.name.split(' ')[0])}</div>`;
      bub.onclick=()=>this.view(g.stories,g.name);
      strip.appendChild(bub);
    });
  },

  _group(stories){
    const m={};
    stories.forEach(s=>{if(!m[s.uid])m[s.uid]={uid:s.uid,name:s.authorName,stories:[]};m[s.uid].stories.push(s);});
    return Object.values(m);
  },

  /** Full-screen story viewer */
  view(stories,name){
    this._list=stories; this._idx=0;
    this._render();
    document.getElementById('story-viewer').classList.add('on');
    this._startTimer();
    this._markSeen(stories[0].id);
  },

  _render(){
    const s=this._list[this._idx];
    document.getElementById('sv-card').innerHTML=`
      <div class="sv-progress">${this._list.map((_,i)=>`
        <div class="sv-bar"><div class="sv-fill" id="svf-${i}" style="width:${i<this._idx?'100%':'0%'}"></div></div>`).join('')}
      </div>
      <div class="sv-hd">
        ${U.avHTML({displayName:s.authorName},'av-sm')}
        <div><div style="font-weight:700;font-size:.85rem;">${U.s(s.authorName)}</div>
        <div style="font-size:.72rem;color:rgba(255,255,255,.5);">${U.ago(s.createdAt)}</div></div>
      </div>
      ${s.imageURL?`<img class="sv-img" src="${U.s(s.imageURL)}"/>`
        :`<div class="sv-text-bg" style="background:linear-gradient(135deg,${s.bgColor||'var(--acc1)'},var(--acc2));">
           <div class="sv-text">${U.s(s.text||'')}</div>
         </div>`}
      <div class="sv-nav-l" onclick="Empire.Stories.prev()"></div>
      <div class="sv-nav-r" onclick="Empire.Stories.next()"></div>`;
  },

  _startTimer(){
    clearInterval(this._timer);
    const bar=document.getElementById(`svf-${this._idx}`);
    const dur=5000; const t0=Date.now();
    this._timer=setInterval(()=>{
      const p=Math.min((Date.now()-t0)/dur*100,100);
      if(bar)bar.style.width=p+'%';
      if(p>=100)this.next();
    },50);
  },

  next(){ clearInterval(this._timer); if(this._idx<this._list.length-1){this._idx++;this._render();this._startTimer();this._markSeen(this._list[this._idx].id);}else this.close(); },
  prev(){ clearInterval(this._timer); if(this._idx>0){this._idx--;this._render();this._startTimer();}},
  close(){ clearInterval(this._timer); document.getElementById('story-viewer').classList.remove('on'); },

  async _markSeen(id){
    const{db,doc,updateDoc,arrayUnion}=window.__FB;
    const uid=S.get('user')?.uid; if(!uid)return;
    await updateDoc(doc(db,'stories',id),{seenBy:arrayUnion(uid)}).catch(()=>{});
  },

  openAdd(){
    Empire.UI.openModal('ğŸ“¸ Yeni Story',`
      <div style="display:flex;flex-direction:column;gap:13px;">
        <div class="field-wrap">
          <label class="field-label">MÉ™tn</label>
          <input class="field" id="st-txt" placeholder="Bu anÄ±n hissiyyatÄ±..."/>
        </div>
        <div class="field-wrap">
          <label class="field-label">Arxa plan rÉ™ngi</label>
          <div style="display:flex;gap:7px;flex-wrap:wrap;">
            ${['#00f0ff','#ff2079','#c084fc','#ffd60a','#30d158','#ff6b35','#1d1d2e'].map(c=>`
              <div style="width:30px;height:30px;border-radius:50%;background:${c};cursor:pointer;transition:transform .2s;"
                onclick="document.querySelectorAll('[data-sc]').forEach(d=>d.style.outline='none');this.style.outline='3px solid #fff';window._storyBg='${c}';"
                data-sc onmouseover="this.style.transform='scale(1.2)'" onmouseout="this.style.transform='scale(1)'"></div>`).join('')}
          </div>
        </div>
        <div class="field-wrap">
          <label class="field-label">ÅÉ™kil (ixtiyari)</label>
          <input class="field" type="file" id="st-img" accept="image/*"/>
        </div>
        <button class="btn btn-acc1" onclick="Empire.Stories.add()" style="justify-content:center;">âš¡ Story PaylaÅŸ</button>
      </div>`);
  },

  async add(){
    const{db,collection,addDoc,storage,storageRef,uploadBytes,getDownloadURL,serverTimestamp}=window.__FB;
    const uid=S.get('user')?.uid, prof=S.get('profile');
    const text=document.getElementById('st-txt')?.value.trim()||'';
    const imgFile=document.getElementById('st-img')?.files?.[0];
    const bg=window._storyBg||'var(--acc1)';
    let imageURL=null;
    if(imgFile){
      try{
        const ref=storageRef(storage,`stories/${uid}/${Date.now()}`);
        const snap=await uploadBytes(ref,imgFile);
        imageURL=await getDownloadURL(snap.ref);
      }catch{}
    }
    if(!text&&!imageURL){Empire.UI.toast('MÉ™tn vÉ™ ya ÅŸÉ™kil É™lavÉ™ edin.','warn');return;}
    await addDoc(collection(db,'stories'),{
      uid,authorName:prof.displayName,text,imageURL,bgColor:bg,
      seenBy:[],createdAt:serverTimestamp()
    }).catch(()=>{});
    Empire.UI.closeModal();
    Empire.UI.toast('Story paylaÅŸÄ±ldÄ±! 24 saat gÃ¶rÃ¼nÉ™cÉ™k.','ok');
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DM MODULE â€” Conversations, Messages, AI bot, Self-destruct, Ghost
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const DMModule = {
  _activeConv:null,
  _msgUnsub:null,

  loadConvs(){
    const{db,collection,query,where,orderBy,onSnapshot}=window.__FB;
    const uid=S.get('user')?.uid; if(!uid)return;
    const q=query(collection(db,'convs'),where('members','array-contains',uid),orderBy('lastAt','desc'));
    const unsub=onSnapshot(q,snap=>{
      const convs=snap.docs.map(d=>({id:d.id,...d.data()}));
      S.set('convs',convs);
      this._renderConvs(convs);
    });
    S.addL('convs',unsub);
  },

  _renderConvs(convs){
    const el=document.getElementById('dm-convs'); if(!el)return;
    const uid=S.get('user')?.uid;
    el.innerHTML=convs.map(c=>{
      const otherIdx=c.members.indexOf(c.members.find(m=>m!==uid));
      const otherName=c.names?.[otherIdx]||'Ä°stifadÉ™Ã§i';
      return `
      <div class="dm-item ${this._activeConv===c.id?'on':''}" onclick="Empire.DM.open('${c.id}','${c.members.find(m=>m!==uid)}')">
        ${U.avHTML({displayName:otherName},'av-md')}
        <div class="dm-item-info">
          <div class="dm-item-name">${U.s(otherName)}</div>
          <div class="dm-item-prev">${U.s(c.lastMsg||'...')}</div>
        </div>
        ${(c.unread||0)>0?`<div class="dm-unread">${c.unread}</div>`:''}
      </div>`}).join('')||'<p class="text-m text-c" style="padding:20px;font-size:.83rem;">SÃ¶hbÉ™t yoxdur.</p>';
  },

  filterConvs(v){
    const convs=S.get('convs')||[];
    const uid=S.get('user')?.uid;
    const filtered=v?convs.filter(c=>(c.names||[]).some(n=>n.toLowerCase().includes(v.toLowerCase()))):convs;
    this._renderConvs(filtered);
  },

  open(convId,otherUid){
    const{db,collection,query,orderBy,onSnapshot,doc,updateDoc,serverTimestamp}=window.__FB;
    this._activeConv=convId;
    const convs=S.get('convs');
    const conv=convs.find(c=>c.id===convId);
    const uid=S.get('user')?.uid;
    const otherName=conv?.names?.find((_,i)=>conv.members[i]!==uid)||'Ä°stifadÉ™Ã§i';
    const chatArea=document.getElementById('dm-chat');
    chatArea.innerHTML=`
      <div class="e2e-bar">ğŸ”’ UÃ§tan-uca ÅŸifrÉ™lÉ™nmiÅŸ Â· End-to-End Encrypted</div>
      <div class="dm-chat-hd">
        ${U.avHTML({displayName:otherName},'av-md')}
        <div>
          <div style="font-weight:700;">${U.s(otherName)}</div>
          <div style="font-size:.75rem;color:var(--online);">â— Online</div>
        </div>
        <div class="actions">
          <button class="btn btn-ghost btn-icon" onclick="Empire.DM.call('${otherUid}')" style="font-size:.9rem;">ğŸ“¹</button>
          <button class="btn btn-ghost btn-icon" onclick="Empire.DM.newConvWith('${otherUid}')" style="font-size:.9rem;">â„¹ï¸</button>
        </div>
      </div>
      <div style="font-size:.73rem;color:var(--txt2);padding:5px 16px;" id="typing-area"></div>
      <div class="dm-msgs" id="dm-msgs"></div>
      <div class="dm-input-row">
        <button class="btn btn-ghost btn-icon" onclick="Empire.DM.sendEmoji('${convId}')" style="font-size:1rem;">ğŸ˜Š</button>
        <button class="btn btn-ghost btn-icon" onclick="document.getElementById('dm-file').click()" style="font-size:1rem;">ğŸ“</button>
        <label style="cursor:pointer;font-size:1rem;display:flex;align-items:center;justify-content:center;width:42px;height:42px;">
          <span title="Ã–z-Ã¶zÃ¼nÃ¼ silÉ™n mesaj">ğŸ’£</span>
          <input type="checkbox" id="sd-toggle" style="display:none;"/>
        </label>
        <input type="file" id="dm-file" style="display:none" onchange="Empire.DM.sendFile('${convId}',this)"/>
        <input class="dm-input" id="dm-inp" placeholder="Mesaj yaz... (/ai AI ilÉ™ danÄ±ÅŸ)"
          onkeydown="if(event.key==='Enter'&&!event.shiftKey){event.preventDefault();Empire.DM.send('${convId}','${otherUid}')}"
          oninput="Empire.DM.typing('${convId}')"/>
        <button class="btn btn-acc1 btn-icon" onclick="Empire.DM.send('${convId}','${otherUid}')">â¤</button>
      </div>`;

    /* Real-time messages */
    if(this._msgUnsub)this._msgUnsub();
    const q=query(collection(db,'convs',convId,'msgs'),orderBy('createdAt','asc'));
    this._msgUnsub=onSnapshot(q,snap=>{
      const msgs=snap.docs.map(d=>({id:d.id,...d.data()}));
      this._renderMsgs(msgs,uid);
      /* Self-destruct: schedule deletion */
      msgs.filter(m=>m.selfDestruct&&!m.deleted).forEach(m=>{
        const rem=10000-(Date.now()-(m.createdAt?.toMillis?.()||0));
        if(rem>0)setTimeout(()=>Empire.DM.deleteSelfDestruct(convId,m.id),rem);
      });
    });
    updateDoc(doc(db,'convs',convId),{unread:0}).catch(()=>{});
  },

  _renderMsgs(msgs,uid){
    const el=document.getElementById('dm-msgs'); if(!el)return;
    el.innerHTML=msgs.map(m=>{
      const own=m.senderUid===uid;
      const isAI=m.isAI;
      if(isAI)return`
        <div style="display:flex;gap:8px;align-items:flex-start;max-width:80%;">
          <div style="font-size:1.5rem;">ğŸ¤–</div>
          <div class="glass-sm" style="padding:10px 14px;border-left:2px solid var(--acc1);">
            <div style="font-size:.72rem;color:var(--acc1);font-weight:700;margin-bottom:4px;font-family:var(--font-d);">EMPIRE AI</div>
            <div style="font-size:.87rem;">${U.s(m.text)}</div>
          </div>
        </div>`;
      return `
      <div class="dm-msg ${own?'own':''}">
        ${!own?U.avHTML({displayName:m.senderName},'av-xs'):''}
        <div>
          <div class="dm-bubble ${m.selfDestruct?'self-destruct':''}" style="position:relative;">
            <div class="react-pick">${['â¤ï¸','ğŸ˜‚','ğŸ˜®','ğŸ‘','ğŸ”¥'].map(e=>`<span style="cursor:pointer" onclick="Empire.DM.react('${m.id}','${e}')">${e}</span>`).join('')}</div>
            ${m.imageURL?`<img src="${U.s(m.imageURL)}" style="max-width:200px;border-radius:8px;margin-bottom:4px;display:block;"/>`:''}
            ${m.text?U.s(U.filter(m.text)):''}
            ${m.reactions&&Object.keys(m.reactions).length?`<div style="margin-top:5px;font-size:.85rem;">${Object.entries(m.reactions).map(([em,c])=>`<span style="background:rgba(255,255,255,.1);border-radius:50px;padding:1px 5px;">${em}${c>1?c:''}</span>`).join('')}</div>`:''}
          </div>
          <div class="dm-ts">${U.ago(m.createdAt)}${m.selfDestruct?' ğŸ’£':''}${m.selfDestruct?`<span class="self-destruct-timer"> Â· ${Math.max(0,10-Math.floor((Date.now()-(m.createdAt?.toMillis?.()||0))/1000))}s</span>`:''}</div>
        </div>
      </div>`;
    }).join('');
    el.scrollTop=el.scrollHeight;
  },

  async send(convId,otherUid){
    const{db,collection,addDoc,doc,updateDoc,serverTimestamp}=window.__FB;
    const inp=document.getElementById('dm-inp');
    let text=inp?.value.trim(); if(!text)return;
    const uid=S.get('user')?.uid, prof=S.get('profile');
    inp.value='';
    /* /ai command â€” summon AI bot */
    if(text.toLowerCase().startsWith('/ai ')){
      await this._ai(convId,text.slice(4)); return;
    }
    text=U.filter(text);
    const selfDestruct=document.getElementById('sd-toggle')?.checked||false;
    try{
      await addDoc(collection(db,'convs',convId,'msgs'),{
        senderUid:uid, senderName:prof.displayName,
        text, imageURL:null, isAI:false, selfDestruct,
        reactions:{}, createdAt:serverTimestamp(),
      });
      await updateDoc(doc(db,'convs',convId),{
        lastMsg:text.slice(0,60), lastAt:serverTimestamp(), unread:1
      });
    }catch(err){Empire.UI.toast('GÃ¶ndÉ™rilmÉ™di.','err');}
  },

  /** Call Anthropic API for /ai command responses */
  async _ai(convId,prompt){
    const{db,collection,addDoc,serverTimestamp}=window.__FB;
    const msgEl=document.getElementById('dm-msgs');
    /* Show typing animation */
    const tmp=document.createElement('div');
    tmp.style.cssText='display:flex;gap:8px;align-items:center;padding:8px 16px;';
    tmp.innerHTML='<div style="font-size:1.4rem;">ğŸ¤–</div><div class="typing-ind"><div class="typing-dot"></div><div class="typing-dot"></div><div class="typing-dot"></div><span class="typing-status">Empire AI yazÄ±r...</span></div>';
    msgEl?.appendChild(tmp);
    if(msgEl)msgEl.scrollTop=msgEl.scrollHeight;
    try{
      const res=await fetch('https://api.anthropic.com/v1/messages',{
        method:'POST',
        headers:{'Content-Type':'application/json','x-api-key':'YOUR_ANTHROPIC_KEY','anthropic-version':'2023-06-01'},
        body:JSON.stringify({
          model:'claude-haiku-20240307', max_tokens:400,
          messages:[{role:'user',content:`SÉ™n AxtarGet Empire platformasÄ±nÄ±n daxili AI assistantÄ±sÄ±n. AzÉ™rbaycan dilindÉ™ qÄ±sa, faydalÄ± cavab ver: ${prompt}`}]
        })
      });
      const data=await res.json();
      const aiText=data.content?.[0]?.text||'Cavab verÉ™ bilmÉ™dim.';
      tmp.remove();
      await addDoc(collection(db,'convs',convId,'msgs'),{
        senderUid:'AI',senderName:'Empire AI',text:aiText,
        isAI:true,selfDestruct:false,reactions:{},createdAt:serverTimestamp()
      });
    }catch{
      tmp.remove();
      Empire.UI.toast('AI cavab verÉ™ bilmÉ™di.','err');
    }
  },

  async deleteSelfDestruct(convId,msgId){
    const{db,doc,deleteDoc}=window.__FB;
    await deleteDoc(doc(db,'convs',convId,'msgs',msgId)).catch(()=>{});
  },

  async sendFile(convId,inp){
    const{storage,storageRef,uploadBytes,getDownloadURL,db,collection,addDoc,doc,updateDoc,serverTimestamp}=window.__FB;
    const f=inp.files[0]; if(!f)return;
    const uid=S.get('user')?.uid, prof=S.get('profile');
    try{
      const ref=storageRef(storage,`msgs/${convId}/${Date.now()}_${f.name}`);
      const snap=await uploadBytes(ref,f);
      const url=await getDownloadURL(snap.ref);
      await addDoc(collection(db,'convs',convId,'msgs'),{
        senderUid:uid,senderName:prof.displayName,text:'',imageURL:url,
        isAI:false,selfDestruct:false,reactions:{},createdAt:serverTimestamp()
      });
      await updateDoc(doc(db,'convs',convId),{lastMsg:'ğŸ“· ÅÉ™kil',lastAt:serverTimestamp()});
    }catch{Empire.UI.toast('ÅÉ™kil gÃ¶ndÉ™rilmÉ™di.','err');}
  },

  async react(msgId,emoji){ Empire.UI.toast(`${emoji} reaksiya É™lavÉ™ edildi`,'info'); },

  typing(convId){ /* In a full implementation, update typing indicator in Firestore */ },
  sendEmoji(convId){ const emojis=['ğŸ˜Š','â¤ï¸','ğŸ”¥','ğŸ˜‚','ğŸ‘','ğŸ‰','ğŸ˜','ğŸ’'];const inp=document.getElementById('dm-inp');if(inp)inp.value+=emojis[Math.floor(Math.random()*emojis.length)]; },
  call(uid){ Empire.UI.toast('Video zÉ™ng tezliklÉ™ gÉ™lir! ğŸ“¹','info'); },

  async newConv(){
    const users=S.get('online')||[];
    const uid=S.get('user')?.uid;
    Empire.UI.openModal('ğŸ’¬ Yeni SÃ¶hbÉ™t BaÅŸlat',`
      <div class="field-wrap" style="margin-bottom:12px;">
        <label class="field-label">Ä°stifadÉ™Ã§i axtarÄ±n</label>
        <input class="field" id="nc-search" placeholder="Ad vÉ™ ya email..." oninput="Empire.DM.searchUser(this.value)"/>
      </div>
      <div id="nc-results">${users.filter(u=>u.uid!==uid).map(u=>`
        <div class="dm-item" onclick="Empire.DM.startWith('${u.uid}','${U.s(u.displayName)}')">
          ${U.avHTML(u,'av-sm')}
          <div><div style="font-size:.87rem;font-weight:700;">${U.s(u.displayName)}</div><div style="font-size:.72rem;color:var(--online);">â— Online</div></div>
        </div>`).join('')}</div>`);
  },

  async searchUser(v){
    const{db,collection,query,where,limit,getDocs}=window.__FB;
    if(!v||v.length<2)return;
    const q=query(collection(db,'users'),where('displayName','>=',v),where('displayName','<=',v+'\uf8ff'),limit(6));
    const snap=await getDocs(q);
    const uid=S.get('user')?.uid;
    document.getElementById('nc-results').innerHTML=snap.docs.filter(d=>d.id!==uid).map(d=>{const u={uid:d.id,...d.data()};return`
      <div class="dm-item" onclick="Empire.DM.startWith('${u.uid}','${U.s(u.displayName)}')">
        ${U.avHTML(u,'av-sm')}
        <div><div style="font-size:.87rem;font-weight:700;">${U.s(u.displayName)}</div>${U.chip(u.badge)}</div>
      </div>`}).join('');
  },

  async startWith(otherUid,otherName){
    const{db,collection,addDoc,query,where,getDocs,serverTimestamp}=window.__FB;
    const uid=S.get('user')?.uid, prof=S.get('profile');
    if(!uid)return;
    const existing=(S.get('convs')||[]).find(c=>c.members.includes(uid)&&c.members.includes(otherUid));
    if(existing){Empire.UI.closeModal();Empire.UI.nav('dms');this.open(existing.id,otherUid);return;}
    try{
      const ref=await addDoc(collection(db,'convs'),{
        members:[uid,otherUid],names:[prof.displayName,otherName],
        lastMsg:'',lastAt:serverTimestamp(),unread:0
      });
      Empire.UI.closeModal();Empire.UI.nav('dms');
      this.open(ref.id,otherUid);
    }catch{Empire.UI.toast('SÃ¶hbÉ™t yaradÄ±lmadÄ±.','err');}
  },

  newConvWith(uid){ this.searchUser(''); }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ECONOMY MODULE â€” Titan-Coins, Shop, Gifts, Achievements, Level
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const EconomyModule = {
  ITEMS:[
    {id:'c_cyan',   ic:'ğŸ”µ',name:'Neon Mavi Profil',   desc:'Profil rÉ™nginizi parlaq maviyÉ™ dÉ™yiÅŸin', price:40,  type:'color', val:'#00f0ff'},
    {id:'c_pink',   ic:'ğŸ’—',name:'Sakura Ã‡É™hrayÄ±sÄ±',    desc:'ZÉ™rif Ã§É™hrayÄ± rÉ™ng',                    price:40,  type:'color', val:'#ff6eb4'},
    {id:'c_gold',   ic:'ğŸŸ¡',name:'QÄ±zÄ±l RÉ™ng',          desc:'VIP qÄ±zÄ±lÄ± gÃ¶rÃ¼nÃ¼ÅŸ',                    price:80,  type:'color', val:'#ffd60a'},
    {id:'c_green',  ic:'ğŸ’š',name:'Matrix YaÅŸÄ±l',         desc:'Hacker estetikasÄ±',                     price:50,  type:'color', val:'#30d158'},
    {id:'c_purple', ic:'ğŸ”®',name:'Mistik BÉ™nÃ¶vÅŸÉ™',       desc:'DÉ™rin bÉ™nÃ¶vÅŸÉ™ tonu',                    price:55,  type:'color', val:'#c084fc'},
    {id:'c_red',    ic:'ğŸ”´',name:'Qan QÄ±rmÄ±zÄ±sÄ±',        desc:'GÃ¼clÃ¼ gÃ¶rÃ¼nÃ¼ÅŸ',                         price:50,  type:'color', val:'#ff2d55'},
    {id:'badge_v',  ic:'âœ…',name:'Verified Badge',        desc:'Mavi tik statusu',                     price:250, type:'badge', val:'verified'},
    {id:'badge_lg', ic:'â­',name:'Legend Badge',          desc:'ÆfsanÉ™vi status',                      price:500, type:'badge', val:'legend'},
    {id:'badge_vip',ic:'ğŸ’',name:'VIP Badge',             desc:'Premium Ã¼zv statusu',                  price:300, type:'badge', val:'vip'},
    {id:'em_fire',  ic:'ğŸ”¥',name:'Alev Emoji Statusu',   desc:'AdÄ±n yanÄ±nda alov',                    price:60,  type:'badge', val:'emoji:ğŸ”¥'},
    {id:'em_star',  ic:'ğŸŒŸ',name:'Ulduz Emoji Statusu',  desc:'Parlaq ulduz statusu',                 price:60,  type:'badge', val:'emoji:ğŸŒŸ'},
    {id:'em_zap',   ic:'âš¡',name:'ÅimÅŸÉ™k Emoji Statusu', desc:'Enerjik ÅŸimÅŸÉ™k',                       price:60,  type:'badge', val:'emoji:âš¡'},
    {id:'xp2x',     ic:'âš¡',name:'XP 2x Booster',        desc:'24 saat 2 qat XP qazanÄ±n',            price:100, type:'boost', val:'xp2x'},
    {id:'tc_bonus', ic:'ğŸª™',name:'TC Bonus Pack',         desc:'AnÄ±nda 100 TC qazanÄ±n',               price:150, type:'instant',val:100},
    {id:'gift',     ic:'ğŸ',name:'HÉ™diyyÉ™ GÃ¶ndÉ™r',        desc:'Dostunuza TC yollayÄ±n',               price:5,   type:'gift',  val:null},
  ],

  ACHIEVEMENTS:[
    {id:'first_post',  ic:'ğŸ¥‡',name:'Ä°lk AddÄ±m',    desc:'Ä°lk postunu paylaÅŸ',          req:'postCount>=1'},
    {id:'active10',    ic:'ğŸ†',name:'Aktiv Ãœzv',     desc:'10 post paylaÅŸ',              req:'postCount>=10'},
    {id:'power50',     ic:'âš¡',name:'Power User',    desc:'50 post paylaÅŸ',              req:'postCount>=50'},
    {id:'socialite',   ic:'ğŸ‘¥',name:'Sosial Adam',   desc:'10 izlÉ™yici qazanÄ±n',        req:'followers>=10'},
    {id:'rich',        ic:'ğŸ’°',name:'TC Milyoneri',  desc:'1000 TC biriktir',           req:'titanCoins>=1000'},
    {id:'liked100',    ic:'â¤ï¸',name:'SevilÉ™n Biri',  desc:'100 bÉ™yÉ™nmÉ™ alÄ±n',           req:'totalLikes>=100'},
    {id:'msg100',      ic:'ğŸ’¬',name:'Natiq',         desc:'100 mesaj gÃ¶ndÉ™rin',         req:'msgCount>=100'},
    {id:'leveled5',    ic:'ğŸš€',name:'YÃ¼ksÉ™liÅŸ',      desc:'Lvl 5-É™ Ã§atÄ±n',             req:'level>=5'},
  ],

  renderShop(){
    const el=document.getElementById('shop-grid'); if(!el)return;
    const tc=S.get('profile')?.titanCoins||0;
    el.innerHTML=this.ITEMS.map(item=>`
      <div class="glass shop-card" onclick="Empire.Economy.buy('${item.id}')">
        <div class="shop-ic">${item.ic}</div>
        <div class="shop-name">${U.s(item.name)}</div>
        <div class="shop-desc">${U.s(item.desc)}</div>
        <div class="shop-price">âš¡ ${item.price} TC${tc<item.price?'<div style="font-size:.7rem;color:var(--danger);margin-top:3px;">Balans Ã§atmÄ±r</div>':''}</div>
      </div>`).join('');
  },

  async buy(id){
    const item=this.ITEMS.find(i=>i.id===id); if(!item)return;
    const prof=S.get('profile'), uid=S.get('user')?.uid; if(!prof||!uid)return;
    if((prof.titanCoins||0)<item.price){Empire.UI.toast('TC balansÄ±nÄ±z kifayÉ™t etmir! âš¡','err');return;}
    if(item.type==='gift'){this.giftModal();return;}
    if(!confirm(`"${item.name}" almaq istÉ™yirsiniz? QiymÉ™t: ${item.price} TC`))return;
    const{db,doc,updateDoc,increment}=window.__FB;
    const updates={titanCoins:increment(-item.price)};
    if(item.type==='color') updates.profileColor=item.val;
    if(item.type==='badge') updates.badge=item.val;
    if(item.type==='boost') updates.activeBoosts=window.__FB.arrayUnion(item.val);
    if(item.type==='instant')updates.titanCoins=increment(-item.price+item.val);
    try{
      await updateDoc(doc(db,'users',uid),updates);
      Empire.UI.toast(`âœ… "${item.name}" alÄ±ndÄ±!`,'ok');
      this.renderShop();
    }catch{Empire.UI.toast('AlÄ±ÅŸ uÄŸursuz.','err');}
  },

  giftModal(){
    Empire.UI.openModal('ğŸ TC HÉ™diyyÉ™ GÃ¶ndÉ™r',`
      <div style="display:flex;flex-direction:column;gap:13px;">
        <div class="field-wrap">
          <label class="field-label">AlÄ±cÄ±nÄ±n E-mail-i</label>
          <input class="field" id="g-email" placeholder="dost@email.com"/>
        </div>
        <div class="field-wrap">
          <label class="field-label">TC MiqdarÄ±</label>
          <input class="field" type="number" id="g-amt" placeholder="50" min="1" max="10000"/>
        </div>
        <button class="btn btn-tc" onclick="Empire.Economy.sendGift()" style="justify-content:center;">ğŸ GÃ¶ndÉ™r</button>
      </div>`);
  },

  async sendGift(){
    const{db,collection,query,where,getDocs,doc,updateDoc,increment,addDoc,serverTimestamp}=window.__FB;
    const email=document.getElementById('g-email')?.value.trim();
    const amt=parseInt(document.getElementById('g-amt')?.value);
    const uid=S.get('user')?.uid, prof=S.get('profile');
    if(!email||!amt||amt<1){Empire.UI.toast('MÉ™lumatlar dÃ¼zgÃ¼n deyil.','err');return;}
    if((prof?.titanCoins||0)<amt){Empire.UI.toast('KifayÉ™t qÉ™dÉ™r TC yoxdur.','err');return;}
    try{
      const q=query(collection(db,'users'),where('email','==',email));
      const snap=await getDocs(q);
      if(snap.empty){Empire.UI.toast('Ä°stifadÉ™Ã§i tapÄ±lmadÄ±.','err');return;}
      const toId=snap.docs[0].id;
      await updateDoc(doc(db,'users',uid),{titanCoins:increment(-amt)});
      await updateDoc(doc(db,'users',toId),{titanCoins:increment(amt)});
      await addDoc(collection(db,'users',toId,'notifs'),{
        type:'gift',fromName:prof.displayName,
        msg:`${prof.displayName} sizÉ™ ${amt} TC hÉ™diyyÉ™ gÃ¶ndÉ™rdi! ğŸ`,
        createdAt:serverTimestamp(),read:false
      });
      /* Floating gift animation */
      const g=document.createElement('div');
      g.className='gift-anim'; g.textContent='ğŸ';
      Object.assign(g.style,{left:window.innerWidth/2+'px',top:window.innerHeight/2+'px'});
      document.body.appendChild(g);
      g.addEventListener('animationend',()=>g.remove());
      Empire.UI.closeModal();
      Empire.UI.toast(`${amt} TC hÉ™diyyÉ™ gÃ¶ndÉ™rildi! ğŸ`,'ok');
    }catch(err){Empire.UI.toast('XÉ™ta: '+err.message,'err');}
  },

  async giftToPost(authorUid){
    const uid=S.get('user')?.uid; if(!uid||uid===authorUid)return;
    const{db,doc,updateDoc,increment,addDoc,collection,serverTimestamp}=window.__FB;
    const prof=S.get('profile');
    try{
      await updateDoc(doc(db,'users',uid),{titanCoins:increment(-5)});
      await updateDoc(doc(db,'users',authorUid),{titanCoins:increment(5)});
      await addDoc(collection(db,'users',authorUid,'notifs'),{
        type:'gift',fromName:prof.displayName,
        msg:`${prof.displayName} postuna ğŸ hÉ™diyyÉ™ gÃ¶ndÉ™rdi! +5 TC`,
        createdAt:serverTimestamp(),read:false
      });
      const g=document.createElement('div');g.className='gift-anim';g.textContent='ğŸ';
      Object.assign(g.style,{left:window.innerWidth/2+'px',top:window.innerHeight/2+'px'});
      document.body.appendChild(g);g.addEventListener('animationend',()=>g.remove());
      Empire.UI.toast('HÉ™diyyÉ™ gÃ¶ndÉ™rildi! +5 TC âœ¨','ok');
    }catch{Empire.UI.toast('HÉ™diyyÉ™ gÃ¶ndÉ™rilmÉ™di.','err');}
  },

  async checkAchievements(){
    const{db,doc,updateDoc}=window.__FB;
    const prof=S.get('profile'), uid=S.get('user')?.uid; if(!prof||!uid)return;
    const achieved=prof.achievements||{};
    const stats={postCount:prof.postCount||0,titanCoins:prof.titanCoins||0,followers:(prof.followers||[]).length,level:U.level(prof.xp||0)};
    const new_=this.ACHIEVEMENTS.filter(a=>!achieved[a.id]&&this._checkReq(a.req,stats));
    if(!new_.length)return;
    const upd={};
    new_.forEach(a=>{ upd[`achievements.${a.id}`]=true; });
    await updateDoc(doc(db,'users',uid),upd).catch(()=>{});
    new_.forEach(a=>Empire.UI.toast(`ğŸ† Yeni medal: ${a.ic} ${a.name}!`,'ok',5000));
  },

  _checkReq(req,stats){
    try{ return Function('s',`with(s){return ${req}}`)(stats); }catch{return false;}
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROFILE MODULE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const ProfileModule = {
  async load(uid){
    const{db,doc,getDoc,collection,query,where,orderBy,getDocs}=window.__FB;
    const el=document.getElementById('profile-wrap'); if(!el)return;
    el.innerHTML='<div class="spinner"></div>';
    try{
      const snap=await getDoc(doc(db,'users',uid));
      if(!snap.exists()){el.innerHTML='<p class="text-m text-c">Ä°stifadÉ™Ã§i tapÄ±lmadÄ±.</p>';return;}
      const prof={uid,...snap.data()};
      const q=query(collection(db,'posts'),where('uid','==',uid),orderBy('createdAt','desc'));
      const posts=(await getDocs(q)).docs.map(d=>({id:d.id,...d.data()}));
      /* Update visitor count */
      const myUid=S.get('user')?.uid;
      if(myUid&&myUid!==uid)window.__FB.updateDoc(doc(db,'users',uid),{visitorCount:window.__FB.increment(1)}).catch(()=>{});
      this._render(prof,posts);
    }catch(err){el.innerHTML=`<p class="text-m text-c">${err.message}</p>`;}
  },

  _render(prof,posts){
    const myUid=S.get('user')?.uid;
    const isMe=prof.uid===myUid;
    const myProf=S.get('profile');
    const following=(myProf?.following||[]).includes(prof.uid);
    const lv=U.level(prof.xp||0);
    const medals=prof.medals||[];
    const achieved=prof.achievements||{};
    const colors=prof.profileColor||'#00f0ff';
    const visD=['B','Ã‡','C','Ca','Å','Åb','Bz'];
    const visData=visD.map(d=>({d,v:Math.floor(Math.random()*60)+5}));
    const vMax=Math.max(...visData.map(v=>v.v));
    document.getElementById('profile-wrap').innerHTML=`
      <div class="glass" style="margin-bottom:14px;overflow:hidden;">
        <div class="profile-cover">
          <svg style="width:100%;height:100%;" viewBox="0 0 800 130" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="none">
            <defs><linearGradient id="cg" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:${colors}"/><stop offset="100%" style="stop-color:var(--acc2)"/>
            </linearGradient></defs>
            <rect width="800" height="130" fill="url(#cg)" opacity=".7"/>
            ${[...Array(12)].map((_,i)=>`<circle cx="${i*70+30}" cy="${Math.sin(i)*30+65}" r="${Math.random()*20+10}" fill="rgba(255,255,255,.06)"/>`).join('')}
          </svg>
        </div>
        <div class="profile-body">
          <div class="profile-av-row">
            <div style="position:relative;">${U.avHTML({...prof,isOnline:prof.isOnline&&!prof.ghostMode},'av-xl')}</div>
            <div style="margin-top:50px;">
              <div style="display:flex;align-items:center;gap:9px;flex-wrap:wrap;">
                <span style="font-size:1.25rem;font-weight:800;">${U.s(prof.displayName)}</span>
                ${U.chip(prof.badge)} <span class="lv-badge">Lvl ${lv}</span>
              </div>
            </div>
            <div class="profile-actions-row">
              ${isMe
                ?`<button class="btn btn-ghost btn-sm" onclick="Empire.Profile.editModal()">âœï¸ RedaktÉ™</button>
                  <button class="btn btn-ghost btn-sm" onclick="Empire.Profile.showAchievements('${prof.uid}')">ğŸ† Medallar</button>`
                :`<button class="btn btn-acc1 btn-sm" onclick="Empire.Social.follow('${prof.uid}')">${following?'âœ“ Ä°zlÉ™nilir':'+ Ä°zlÉ™'}</button>
                  <button class="btn btn-ghost btn-sm" onclick="Empire.DM.startWith('${prof.uid}','${U.s(prof.displayName)}');Empire.UI.closeModal()">ğŸ’¬ DM</button>
                  <button class="btn btn-ghost btn-sm" onclick="Empire.Economy.giftToPost('${prof.uid}')">ğŸ HÉ™diyyÉ™</button>`}
            </div>
          </div>
          ${prof.bio?`<div class="profile-bio">${U.s(prof.bio)}</div>`:''}
          <div class="profile-stats">
            <div class="pstat"><div class="pstat-n">${U.n(prof.postCount||posts.length)}</div><div class="pstat-l">Post</div></div>
            <div class="pstat"><div class="pstat-n">${U.n((prof.followers||[]).length)}</div><div class="pstat-l">Ä°zlÉ™yici</div></div>
            <div class="pstat"><div class="pstat-n">${U.n((prof.following||[]).length)}</div><div class="pstat-l">Ä°zlÉ™nilÉ™n</div></div>
            <div class="pstat"><div class="pstat-n text-tc">âš¡${U.n(prof.titanCoins||0)}</div><div class="pstat-l">TC</div></div>
          </div>
          ${Object.keys(achieved).length?`<div class="profile-medals">${Object.keys(achieved).map(k=>{const a=EconomyModule.ACHIEVEMENTS.find(x=>x.id===k);return a?`<div class="medal-chip">${a.ic} ${a.name}</div>`:''}).join('')}</div>`:''}
        </div>
      </div>
      ${isMe?`
      <div class="glass" style="padding:18px;margin-bottom:14px;">
        <div class="sec-title">ğŸ‘ï¸ ZiyarÉ™tÃ§i StatistikasÄ± (Son 7 gÃ¼n)</div>
        ${visData.map(v=>`<div class="vis-row"><div class="vis-lbl">${v.d}</div><div class="vis-track"><div class="vis-fill" style="width:${(v.v/vMax*100).toFixed(0)}%"></div></div><div class="vis-num">${v.v}</div></div>`).join('')}
      </div>`:''}
      <div>
        <div class="sec-title" style="margin-top:6px;">ğŸ“š Post Arxivi</div>
        ${posts.map(p=>`
          <div class="glass post" style="margin-bottom:11px;">
            <div class="post-hd">
              ${U.avHTML({displayName:prof.displayName,profileColor:prof.profileColor},'av-sm')}
              <div class="post-meta"><div class="post-ts">${U.ago(p.createdAt)}</div></div>
            </div>
            ${p.text?`<div class="post-txt">${U.linkTags(p.text)}</div>`:''}
            ${p.imageURL?`<img class="post-img" src="${U.s(p.imageURL)}" loading="lazy"/>`:''}
            <div class="post-actions">
              <span class="pa-btn">â¤ï¸ ${U.n((p.likes||[]).length)}</span>
              <span class="pa-btn">ğŸ’¬ ${U.n(p.commentCount||0)}</span>
            </div>
          </div>`).join('')||'<p class="text-m text-c" style="padding:24px;">Post yoxdur.</p>'}
      </div>`;
  },

  editModal(){
    const p=S.get('profile');
    Empire.UI.openModal('âœï¸ Profili RedaktÉ™ Et',`
      <div style="display:flex;flex-direction:column;gap:13px;">
        <div class="field-wrap">
          <label class="field-label">Ad Soyad</label>
          <input class="field" id="ed-name" value="${U.s(p?.displayName||'')}"/>
        </div>
        <div class="field-wrap">
          <label class="field-label">Bio</label>
          <textarea class="field" id="ed-bio" style="min-height:72px;">${U.s(p?.bio||'')}</textarea>
        </div>
        <button class="btn btn-acc1" onclick="Empire.Profile.saveEdit()" style="justify-content:center;">ğŸ’¾ Saxla</button>
      </div>`);
  },

  async saveEdit(){
    const{db,doc,updateDoc,auth,updateProfile}=window.__FB;
    const name=document.getElementById('ed-name')?.value.trim();
    const bio =document.getElementById('ed-bio')?.value.trim();
    const uid =S.get('user')?.uid;
    if(!name){Empire.UI.toast('Ad boÅŸ ola bilmÉ™z.','err');return;}
    try{
      await updateDoc(doc(db,'users',uid),{displayName:name,bio});
      await updateProfile(window.__FB.auth.currentUser,{displayName:name});
      Empire.UI.closeModal(); Empire.UI.toast('Profil yenilÉ™ndi!','ok');
    }catch(err){Empire.UI.toast('XÉ™ta: '+err.message,'err');}
  },

  showAchievements(uid){
    const prof=S.get('profile');
    const achieved=prof?.achievements||{};
    Empire.UI.openModal('ğŸ† Medallar & NailiyyÉ™tlÉ™r',`
      <div class="achieve-list">
        ${EconomyModule.ACHIEVEMENTS.map(a=>`
          <div class="glass-sm achieve-card ${achieved[a.id]?'unlocked':''}">
            <div class="achieve-ic">${a.ic}</div>
            <div><div class="achieve-name">${U.s(a.name)}</div>
            <div class="achieve-desc">${U.s(a.desc)}</div>
            ${achieved[a.id]?'<div style="color:var(--good);font-size:.72rem;margin-top:3px;">âœ“ AÃ§Ä±ldÄ±</div>':'<div style="color:var(--txt2);font-size:.72rem;margin-top:3px;">ğŸ”’ Kilitli</div>'}
            </div>
          </div>`).join('')}
      </div>`);
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NOTIFICATIONS MODULE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const NotifsModule = {
  listen(){
    const{db,collection,query,orderBy,onSnapshot}=window.__FB;
    const uid=S.get('user')?.uid; if(!uid)return;
    const q=query(collection(db,'users',uid,'notifs'),orderBy('createdAt','desc'));
    const unsub=onSnapshot(q,snap=>{
      const notifs=snap.docs.map(d=>({id:d.id,...d.data()}));
      S.set('notifs',notifs);
      const unread=notifs.filter(n=>!n.read).length;
      const ring=document.getElementById('notif-ring');
      if(ring)ring.style.display=unread>0?'block':'none';
    });
    S.addL('notifs',unsub);
  },

  load(){
    const notifs=S.get('notifs')||[];
    const el=document.getElementById('notif-wrap'); if(!el)return;
    if(!notifs.length){el.innerHTML='<p class="text-m text-c" style="padding:48px;">BildiriÅŸ yoxdur.</p>';return;}
    el.innerHTML=notifs.map(n=>`
      <div class="glass notif-it ${n.read?'':'unread'}" onclick="Empire.Notifs.markRead('${n.id}')">
        <div class="notif-ic">${this._ic(n.type)}</div>
        <div class="notif-txt">
          <div class="notif-msg">${U.s(n.msg||'')}</div>
          <div class="notif-time">${U.ago(n.createdAt)}</div>
        </div>
        ${!n.read?'<div class="notif-unread-dot"></div>':''}
      </div>`).join('');
  },

  _ic(t){return{like:'â¤ï¸',comment:'ğŸ’¬',follow:'ğŸ‘¤',gift:'ğŸ',system:'ğŸ“¢',badge:'ğŸ…',report:'ğŸš©'}[t]||'ğŸ””';},

  async markRead(id){
    const{db,doc,updateDoc}=window.__FB;
    const uid=S.get('user')?.uid; if(!uid)return;
    await updateDoc(doc(db,'users',uid,'notifs',id),{read:true}).catch(()=>{});
  },

  async markAllRead(){
    const notifs=S.get('notifs')||[];
    const{db,doc,updateDoc,writeBatch}=window.__FB;
    const uid=S.get('user')?.uid; if(!uid)return;
    const batch=writeBatch(db);
    notifs.filter(n=>!n.read).forEach(n=>batch.update(doc(db,'users',uid,'notifs',n.id),{read:true}));
    await batch.commit().catch(()=>{});
    Empire.UI.toast('BÃ¼tÃ¼n bildiriÅŸlÉ™r oxundu.','ok');
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ADMIN MODULE â€” GOD MODE Command Center
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const AdminModule = {
  _users:[],_tab:'users',

  async init(){
    const prof=S.get('profile');
    const el=document.getElementById('admin-wrap');
    if(prof?.role!=='admin'){
      el.innerHTML=`<div class="text-c" style="padding:60px;"><div style="font-size:4rem;">ğŸš«</div>
        <div style="font-family:var(--font-d);font-size:1.1rem;color:var(--danger);margin-top:10px;">GiriÅŸ QadaÄŸandÄ±r</div>
        <div class="text-m" style="margin-top:8px;">YalnÄ±z superadminlÉ™r Ã¼Ã§Ã¼n.</div></div>`;
      return;
    }
    const stats=await this._stats();
    el.innerHTML=`
      <div class="admin-hero">
        <div style="font-size:2.2rem;">ğŸ‘‘</div>
        <div><div class="admin-title">GOD MODE â€” Empire Command Center</div>
        <div class="admin-sub">Tam sistem kontrolu Â· Real-vaxt monitorinq Â· ${new Date().toLocaleString('az')}</div></div>
        <div style="margin-left:auto;font-size:.8rem;color:var(--danger);font-weight:700;">âš ï¸ SUPERADMIN ONLY</div>
      </div>
      <div class="admin-kpi" id="admin-kpi"></div>
      <div class="glass" style="padding:18px;margin-bottom:18px;">
        <div class="sec-title">ğŸ“ˆ 24 SaatlÄ±q FÉ™aliyyÉ™t Qrafiki</div>
        <div class="act-chart" id="act-chart"></div>
        <div style="display:flex;justify-content:space-between;font-size:.7rem;color:var(--txt2);margin-top:4px;">
          <span>00:00</span><span>06:00</span><span>12:00</span><span>18:00</span><span>24:00</span>
        </div>
      </div>
      <div style="display:flex;gap:8px;margin-bottom:14px;flex-wrap:wrap;">
        <button class="btn btn-acc1 btn-sm" onclick="Empire.Admin.tab('users')">ğŸ‘¥ Ä°stifadÉ™Ã§ilÉ™r</button>
        <button class="btn btn-ghost btn-sm" onclick="Empire.Admin.tab('reports')">ğŸš¨ ÅikayÉ™tlÉ™r</button>
        <button class="btn btn-ghost btn-sm" onclick="Empire.Admin.tab('badges')">ğŸ… Badge Factory</button>
        <button class="btn btn-ghost btn-sm" onclick="Empire.Admin.tab('economy')">ğŸ’° Ekonomika</button>
        <button class="btn btn-ghost btn-sm" onclick="Empire.Admin.tab('announce')">ğŸ“¢ Elan</button>
        <button class="btn btn-ghost btn-sm" onclick="Empire.Admin.tab('posts')">ğŸ“ BÃ¼tÃ¼n Postlar</button>
      </div>
      <div id="admin-tab"></div>`;
    this._renderKPI(stats);
    this._renderChart();
    this.tab('users');
  },

  async _stats(){
    const{db,collection,getDocs,query,where}=window.__FB;
    try{
      const [u,p,r,o]=await Promise.all([
        getDocs(collection(db,'users')),
        getDocs(collection(db,'posts')),
        getDocs(query(collection(db,'reports'),where('status','==','pending'))),
        getDocs(query(collection(db,'users'),where('isOnline','==',true))),
      ]);
      const tc=u.docs.reduce((s,d)=>s+(d.data().titanCoins||0),0);
      return{users:u.size,posts:p.size,reports:r.size,online:o.size,tc};
    }catch{return{users:0,posts:0,reports:0,online:0,tc:0};}
  },

  _renderKPI(stats){
    const kpis=[
      {ic:'ğŸ‘¥',n:stats.users,l:'CÉ™mi Ä°stifadÉ™Ã§i',c:'var(--acc1)'},
      {ic:'ğŸŸ¢',n:stats.online,l:'Online Ä°ndi',c:'var(--online)'},
      {ic:'ğŸ“',n:stats.posts,l:'CÉ™mi Post',c:'var(--acc2)'},
      {ic:'ğŸš¨',n:stats.reports,l:'AÃ§Ä±q ÅikayÉ™t',c:'var(--warn)'},
      {ic:'âš¡',n:U.n(stats.tc),l:'Total TC',c:'var(--tc)'},
      {ic:'ğŸ“–',n:S.get('stories').length,l:'Aktiv Story',c:'var(--acc3)'},
    ];
    document.getElementById('admin-kpi').innerHTML=kpis.map(k=>`
      <div class="glass kpi-card">
        <div style="font-size:1.6rem;margin-bottom:5px;">${k.ic}</div>
        <div class="kpi-num" style="color:${k.c}">${k.n}</div>
        <div class="kpi-lbl">${k.l}</div>
      </div>`).join('');
  },

  _renderChart(){
    const el=document.getElementById('act-chart'); if(!el)return;
    const vals=Array.from({length:24},(_,i)=>{
      const p=i>=18&&i<=23?.95:i>=12&&i<18?.7:i>=8&&i<12?.45:.12;
      return Math.floor(p*75+Math.random()*22);
    });
    const max=Math.max(...vals);
    el.innerHTML=vals.map((v,i)=>`
      <div class="act-bar" title="${i}:00 - ${v} online"
        style="height:${(v/max*100).toFixed(0)}%;background:${v/max>.8?'var(--acc2)':v/max>.5?'var(--acc1)':'rgba(0,240,255,.4)'}">
      </div>`).join('');
  },

  tab(t){
    this._tab=t;
    const el=document.getElementById('admin-tab');
    el.innerHTML='<div class="spinner"></div>';
    ({
      users:    ()=>this._loadUsers(),
      reports:  ()=>this._loadReports(),
      badges:   ()=>this._renderBadge(),
      economy:  ()=>this._renderEconomy(),
      announce: ()=>this._renderAnnounce(),
      posts:    ()=>this._loadPosts(),
    }[t]||function(){})();
  },

  async _loadUsers(){
    const{db,collection,getDocs,orderBy,query,limit}=window.__FB;
    const el=document.getElementById('admin-tab');
    try{
      const snap=await getDocs(query(collection(db,'users'),orderBy('createdAt','desc'),limit(60)));
      this._users=snap.docs.map(d=>({uid:d.id,...d.data()}));
      el.innerHTML=`
        <div class="glass" style="padding:18px;overflow-x:auto;">
          <input class="field" placeholder="Ä°stifadÉ™Ã§i axtar..." oninput="Empire.Admin.filterU(this.value)" style="border-radius:50px;max-width:260px;margin-bottom:14px;"/>
          <table class="adm-tbl" id="adm-tbl"><thead><tr>
            <th>Ä°stifadÉ™Ã§i</th><th>Status</th><th>Role/Badge</th><th>TC</th><th>Lvl</th><th>ÆmÉ™liyyatlar</th>
          </tr></thead><tbody id="adm-tbody">${this._uRows(this._users)}</tbody></table>
        </div>`;
    }catch(err){el.innerHTML=`<p class="text-err">${err.message}</p>`;}
  },

  _uRows(users){
    return users.map(u=>`
      <tr>
        <td><div style="display:flex;align-items:center;gap:8px;">
          ${U.avHTML({displayName:u.displayName,profileColor:u.profileColor},'av-sm')}
          <div><div style="font-weight:700;font-size:.87rem;">${U.s(u.displayName)}</div>
          <div style="font-size:.73rem;color:var(--txt2);">${U.s(u.email||'')}</div></div>
        </div></td>
        <td>${u.isBanned?'<span style="color:var(--danger);font-size:.8rem;">â›” BAN</span>':u.isMuted?'<span style="color:var(--warn);font-size:.8rem;">ğŸ”‡ MUTE</span>':u.isOnline?'<span style="color:var(--online);font-size:.8rem;">â— Online</span>':'<span style="color:var(--txt2);font-size:.8rem;">Offline</span>'}</td>
        <td>${U.chip(u.badge)||`<span class="text-m" style="font-size:.8rem;">${u.role||'user'}</span>`}</td>
        <td style="font-family:var(--font-d);color:var(--tc);font-size:.87rem;">âš¡${U.n(u.titanCoins||0)}</td>
        <td><span class="lv-badge">Lvl ${U.level(u.xp||0)}</span></td>
        <td>
          ${u.isBanned
            ?`<button class="adm-act adm-unban" onclick="Empire.Admin.unban('${u.uid}')">âœ“ AÃ§Ä±q</button>`
            :`<button class="adm-act adm-ban"  onclick="Empire.Admin.ban('${u.uid}')">â›” Ban</button>`}
          ${u.isMuted
            ?`<button class="adm-act adm-unban" onclick="Empire.Admin.unmute('${u.uid}')">ğŸ”Š AÃ§Ä±q</button>`
            :`<button class="adm-act adm-mute" onclick="Empire.Admin.mute('${u.uid}')">ğŸ”‡ Mute</button>`}
          <button class="adm-act adm-badge" onclick="Empire.Admin.badgeModal('${u.uid}','${U.s(u.displayName)}')">ğŸ…</button>
          <button class="adm-act" style="background:rgba(255,230,0,.1);color:var(--tc);border:1px solid rgba(255,230,0,.25);" onclick="Empire.Admin.coinModal('${u.uid}','${U.s(u.displayName)}')">âš¡</button>
          <button class="adm-act adm-del" onclick="Empire.Admin.deleteUser('${u.uid}')">ğŸ—‘ï¸</button>
        </td>
      </tr>`).join('');
  },

  filterU(v){
    const f=v?this._users.filter(u=>u.displayName?.toLowerCase().includes(v.toLowerCase())||u.email?.toLowerCase().includes(v.toLowerCase())):this._users;
    const b=document.getElementById('adm-tbody'); if(b)b.innerHTML=this._uRows(f);
  },

  async ban(uid){
    if(!confirm('Bu istifadÉ™Ã§ini ban etmÉ™k istÉ™yirsiniz?'))return;
    const{db,doc,updateDoc}=window.__FB;
    await updateDoc(doc(db,'users',uid),{isBanned:true}).catch(()=>{});
    Empire.UI.toast('Ä°stifadÉ™Ã§i ban edildi.','ok'); this._loadUsers();
  },
  async unban(uid){
    const{db,doc,updateDoc}=window.__FB;
    await updateDoc(doc(db,'users',uid),{isBanned:false}).catch(()=>{});
    Empire.UI.toast('Ban qaldÄ±rÄ±ldÄ±.','ok'); this._loadUsers();
  },
  async mute(uid){
    const{db,doc,updateDoc}=window.__FB;
    await updateDoc(doc(db,'users',uid),{isMuted:true}).catch(()=>{});
    Empire.UI.toast('Ä°stifadÉ™Ã§i susturuldu.','ok'); this._loadUsers();
  },
  async unmute(uid){
    const{db,doc,updateDoc}=window.__FB;
    await updateDoc(doc(db,'users',uid),{isMuted:false}).catch(()=>{});
    Empire.UI.toast('Mute qaldÄ±rÄ±ldÄ±.','ok'); this._loadUsers();
  },
  async deleteUser(uid){
    if(!confirm('Bu hesabÄ± TAMAMILÆ silmÉ™k istÉ™yirsiniz? Geri qaytarÄ±la bilmÉ™z!'))return;
    const{db,doc,deleteDoc}=window.__FB;
    await deleteDoc(doc(db,'users',uid)).catch(()=>{});
    Empire.UI.toast('Hesab silindi.','ok'); this._loadUsers();
  },

  badgeModal(uid,name){
    Empire.UI.openModal(`ğŸ… ${name} â€” Badge SeÃ§`,`
      <div style="display:flex;flex-wrap:wrap;gap:10px;">
        ${[
          {v:'verified',l:'âœ“ Verified',c:'chip-verified'},
          {v:'legend',  l:'â­ Legend', c:'chip-legend'},
          {v:'vip',     l:'ğŸ’ VIP',   c:'chip-vip'},
          {v:'mod',     l:'ğŸ›¡ï¸ Mod',   c:'chip-mod'},
          {v:'admin',   l:'ğŸ‘‘ Admin', c:'chip-admin'},
          {v:'emoji:ğŸ”¥',l:'ğŸ”¥ Alev',  c:''},
          {v:'emoji:ğŸ’',l:'ğŸ’ Almaz', c:''},
          {v:'emoji:âš¡',l:'âš¡ ÅimÅŸÉ™k',c:''},
          {v:null,      l:'âŒ Sil',    c:''},
        ].map(b=>`<button class="btn btn-ghost btn-sm" onclick="Empire.Admin.assignBadge('${uid}','${b.v}')">
          <span class="chip ${b.c}" style="${!b.c?'background:rgba(255,255,255,.07);':''}">${b.l}</span>
        </button>`).join('')}
      </div>`);
  },

  async assignBadge(uid,badge){
    const{db,doc,updateDoc}=window.__FB;
    await updateDoc(doc(db,'users',uid),{badge}).catch(()=>{});
    Empire.UI.closeModal(); Empire.UI.toast('Badge tÉ™yin edildi!','ok');
  },

  coinModal(uid,name){
    Empire.UI.openModal(`âš¡ ${name} â€” TC Ä°darÉ™etmÉ™`,`
      <div style="display:flex;flex-direction:column;gap:12px;">
        <div style="display:flex;gap:7px;flex-wrap:wrap;">
          ${[10,50,100,500,1000].map(n=>`<button class="btn btn-tc btn-sm" onclick="Empire.Admin.adjTC('${uid}',${n})">+${n}</button>`).join('')}
          ${[10,50,100].map(n=>`<button class="btn btn-danger btn-sm" onclick="Empire.Admin.adjTC('${uid}',-${n})">-${n}</button>`).join('')}
        </div>
        <div class="divider"></div>
        <div style="display:flex;gap:8px;">
          <input class="field" type="number" id="c-amt" placeholder="Ã–zÉ™l miqdar"/>
          <button class="btn btn-acc1 btn-sm" onclick="Empire.Admin.adjTC('${uid}',parseInt(document.getElementById('c-amt')?.value)||0)">TÉ™tbiq</button>
        </div>
      </div>`);
  },

  async adjTC(uid,amount){
    const{db,doc,updateDoc,increment}=window.__FB;
    await updateDoc(doc(db,'users',uid),{titanCoins:increment(amount)}).catch(()=>{});
    Empire.UI.toast(`${amount>0?'+':''}${amount} TC tÉ™tbiq edildi.`,amount>0?'ok':'warn');
    Empire.UI.closeModal();
  },

  async _loadReports(){
    const{db,collection,getDocs,query,where,orderBy,doc,updateDoc,deleteDoc}=window.__FB;
    const el=document.getElementById('admin-tab');
    try{
      const q=query(collection(db,'reports'),where('status','==','pending'),orderBy('createdAt','desc'));
      const snap=await getDocs(q);
      const reps=snap.docs.map(d=>({id:d.id,...d.data()}));
      el.innerHTML=reps.length?reps.map(r=>`
        <div class="glass" style="padding:16px;margin-bottom:10px;border-left:3px solid var(--warn);">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;">
            <span style="font-size:.72rem;font-weight:700;text-transform:uppercase;color:var(--warn);">ğŸš© ${U.s(r.reason||'ÅikayÉ™t')}</span>
            <span class="text-m" style="font-size:.75rem;">${U.ago(r.createdAt)}</span>
          </div>
          <div style="font-size:.87rem;margin-bottom:10px;"><strong>${U.s(r.reporterName||'Anonim')}</strong> â€” Post ID: <code style="color:var(--acc1);">${r.postId}</code></div>
          <div style="display:flex;gap:8px;">
            <button class="btn btn-danger btn-sm" onclick="Empire.Admin.delReportedPost('${r.postId}','${r.id}')">ğŸ—‘ï¸ Postu Sil</button>
            <button class="btn btn-ghost btn-sm" onclick="Empire.Admin.dismissReport('${r.id}')">âœ“ RÉ™dd et</button>
          </div>
        </div>`).join('')
        :'<div class="text-c text-m" style="padding:40px;">ğŸ‰ AÃ§Ä±q ÅŸikayÉ™t yoxdur!</div>';
    }catch(err){el.innerHTML=`<p class="text-err">${err.message}</p>`;}
  },

  async delReportedPost(postId,repId){
    const{db,doc,deleteDoc,updateDoc}=window.__FB;
    await deleteDoc(doc(db,'posts',postId)).catch(()=>{});
    await updateDoc(doc(db,'reports',repId),{status:'resolved'}).catch(()=>{});
    Empire.UI.toast('Post silindi.','ok'); this._loadReports();
  },

  async dismissReport(repId){
    const{db,doc,updateDoc}=window.__FB;
    await updateDoc(doc(db,'reports',repId),{status:'dismissed'}).catch(()=>{});
    Empire.UI.toast('ÅikayÉ™t rÉ™dd edildi.','info'); this._loadReports();
  },

  _renderBadge(){
    document.getElementById('admin-tab').innerHTML=`
      <div class="glass" style="padding:22px;">
        <div class="sec-title">ğŸ… Badge Factory â€” Ä°stifadÉ™Ã§ilÉ™rÉ™ Status Ver</div>
        <p class="text-m" style="font-size:.85rem;margin-bottom:16px;">Ä°stifadÉ™Ã§ilÉ™r tabÄ±nda hÉ™r istifadÉ™Ã§inin yanÄ±ndakÄ± ğŸ… dÃ¼ymÉ™sinÉ™ basaraq badge verin.</p>
        <div style="display:flex;flex-wrap:wrap;gap:12px;">
          ${[{b:'verified',d:'DoÄŸrulanmÄ±ÅŸ hesab'},{b:'legend',d:'ÆfsanÉ™vi Ã¼zv'},{b:'vip',d:'Premium Ã¼zv'},{b:'mod',d:'Moderator'},{b:'admin',d:'Sistem admini'}].map(x=>`
            <div class="glass-sm" style="padding:14px 18px;text-align:center;min-width:130px;">
              ${U.chip(x.b)}
              <div class="text-m" style="font-size:.78rem;margin-top:6px;">${x.d}</div>
            </div>`).join('')}
        </div>
      </div>`;
  },

  _renderEconomy(){
    document.getElementById('admin-tab').innerHTML=`
      <div class="glass" style="padding:22px;">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px;">
          <div class="glass-inset" style="padding:16px;">
            <div class="sec-title">âš¡ TC KassasÄ±</div>
            <div class="field-wrap mb8"><label class="field-label">E-mail</label><input class="field" id="ec-email" placeholder="user@email.com"/></div>
            <div class="field-wrap mb8"><label class="field-label">Miqdar (mÉ™nfi=azalt)</label><input class="field" type="number" id="ec-amt" placeholder="100 vÉ™ ya -50"/></div>
            <button class="btn btn-tc w-full" onclick="Empire.Admin.ecoAdj()" style="justify-content:center;">TÉ™tbiq et</button>
          </div>
          <div class="glass-inset" style="padding:16px;">
            <div class="sec-title">ğŸ‘ï¸ BÃ¼tÃ¼n Ã‡atlarÄ± Ä°zlÉ™</div>
            <p class="text-m" style="font-size:.83rem;">Firebase Console â†’ Firestore â†’ convs koleksiyonuna daxil olun.</p>
            <div class="sec-title" style="margin-top:14px;">ğŸ“Š Sistem StatistikasÄ±</div>
            <p class="text-m" style="font-size:.83rem;">KPI kartlarÄ±nda canlÄ± statistika gÃ¶rÃ¼nÃ¼r.</p>
          </div>
        </div>
      </div>`;
  },

  async ecoAdj(){
    const{db,collection,query,where,getDocs,doc,updateDoc,increment}=window.__FB;
    const email=document.getElementById('ec-email')?.value.trim();
    const amt=parseInt(document.getElementById('ec-amt')?.value);
    if(!email||isNaN(amt)){Empire.UI.toast('MÉ™lumatlar dÃ¼zgÃ¼n deyil.','err');return;}
    try{
      const q=query(collection(db,'users'),where('email','==',email));
      const snap=await getDocs(q);
      if(snap.empty){Empire.UI.toast('Ä°stifadÉ™Ã§i tapÄ±lmadÄ±.','err');return;}
      await updateDoc(doc(db,'users',snap.docs[0].id),{titanCoins:increment(amt)});
      Empire.UI.toast(`${amt>0?'+':''}${amt} TC tÉ™tbiq edildi!`,'ok');
    }catch(err){Empire.UI.toast('XÉ™ta.','err');}
  },

  _renderAnnounce(){
    document.getElementById('admin-tab').innerHTML=`
      <div class="glass" style="padding:22px;max-width:560px;">
        <div class="sec-title">ğŸ“¢ Sistem ElanÄ± GÃ¶ndÉ™r</div>
        <div class="field-wrap mb8"><label class="field-label">BaÅŸlÄ±q</label><input class="field" id="ann-title" placeholder="Vacib xÉ™bÉ™r!"/></div>
        <div class="field-wrap mb8"><label class="field-label">MÉ™tn</label><textarea class="field" id="ann-msg" placeholder="BÃ¼tÃ¼n istifadÉ™Ã§ilÉ™rÉ™ gÃ¶ndÉ™rilÉ™cÉ™k..." style="min-height:90px;"></textarea></div>
        <button class="btn btn-acc1" onclick="Empire.Admin.sendAnn()" style="justify-content:center;">ğŸ“¢ BÃ¼tÃ¼n Ä°stifadÉ™Ã§ilÉ™rÉ™ GÃ¶ndÉ™r</button>
      </div>`;
  },

  async sendAnn(){
    const{db,collection,getDocs,addDoc,doc,serverTimestamp}=window.__FB;
    const title=document.getElementById('ann-title')?.value.trim();
    const msg  =document.getElementById('ann-msg')?.value.trim();
    if(!msg){Empire.UI.toast('MÉ™tn boÅŸ ola bilmÉ™z.','err');return;}
    try{
      /* Add to global announcements collection for feed banner */
      await addDoc(collection(db,'announcements'),{title,msg,createdAt:serverTimestamp()});
      /* Send notification to all users */
      const snap=await getDocs(collection(db,'users'));
      let cnt=0;
      for(const ud of snap.docs){
        await addDoc(collection(db,'users',ud.id,'notifs'),{
          type:'system',msg:msg,createdAt:serverTimestamp(),read:false
        }); cnt++;
      }
      Empire.UI.toast(`Elan ${cnt} istifadÉ™Ã§iyÉ™ gÃ¶ndÉ™rildi!`,'ok');
    }catch(err){Empire.UI.toast('GÃ¶ndÉ™rmÉ™ xÉ™tasÄ±.','err');}
  },

  async _loadPosts(){
    const{db,collection,getDocs,query,orderBy,limit,doc,deleteDoc}=window.__FB;
    const el=document.getElementById('admin-tab');
    el.innerHTML='<div class="spinner"></div>';
    try{
      const snap=await getDocs(query(collection(db,'posts'),orderBy('createdAt','desc'),limit(30)));
      const posts=snap.docs.map(d=>({id:d.id,...d.data()}));
      el.innerHTML=`<div class="glass" style="padding:14px;overflow-x:auto;">
        <table class="adm-tbl"><thead><tr><th>MÃ¼É™llif</th><th>MÉ™tn</th><th>â¤ï¸</th><th>ğŸ•’</th><th></th></tr></thead>
        <tbody>${posts.map(p=>`<tr>
          <td style="font-size:.83rem;font-weight:700;">${U.s(p.authorName||'')}</td>
          <td style="font-size:.82rem;max-width:240px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;">${U.s((p.text||'').slice(0,80))}</td>
          <td>${(p.likes||[]).length}</td>
          <td style="font-size:.75rem;color:var(--txt2);">${U.ago(p.createdAt)}</td>
          <td><button class="adm-act adm-del" onclick="Empire.Admin.adminDelPost('${p.id}')">ğŸ—‘ï¸ Sil</button></td>
        </tr>`).join('')}</tbody></table></div>`;
    }catch(err){el.innerHTML=`<p class="text-err">${err.message}</p>`;}
  },

  async adminDelPost(id){
    if(!confirm('Bu postu silmÉ™k istÉ™yirsiniz?'))return;
    const{db,doc,deleteDoc}=window.__FB;
    await deleteDoc(doc(db,'posts',id)).catch(()=>{});
    Empire.UI.toast('Post silindi.','ok'); this._loadPosts();
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EMPIRE â€” Top-level namespace that assembles all modules
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const Empire = {
  UI:      UIEngine,
  Auth:    AuthModule,
  Social:  SocialModule,
  Stories: StoriesModule,
  DM:      DMModule,
  Economy: EconomyModule,
  Profile: ProfileModule,
  Notifs:  NotifsModule,
  Admin:   AdminModule,
};

/* â”€â”€ BOOTSTRAP â”€â”€ runs when Firebase is ready */
window.addEventListener('empire:ready', () => {
  /* Init particle background */
  new ParticleEngine();

  /* Init cursor and UI utilities */
  Empire.UI.initCursor();

  /* Start Firebase auth listener */
  Empire.Auth.listen();

  /* Keep user online status fresh every 60s */
  setInterval(async ()=>{
    const uid=S.get('user')?.uid; if(!uid||S.get('ghostMode'))return;
    const{db,doc,updateDoc,serverTimestamp}=window.__FB;
    try{await updateDoc(doc(db,'users',uid),{isOnline:true,lastSeen:serverTimestamp()});}catch{}
  },60000);

  /* Set offline on page close */
  window.addEventListener('beforeunload',async()=>{
    const uid=S.get('user')?.uid; if(!uid)return;
    const{db,doc,updateDoc,serverTimestamp}=window.__FB;
    try{await updateDoc(doc(db,'users',uid),{isOnline:false,lastSeen:serverTimestamp()});}catch{}
  });

  /* /admin shortcut from search bar (already handled in search fn) */

  console.log('%câš¡ AxtarGet Empire â€” Online!','color:#00f0ff;font-size:1.3rem;font-weight:800;');
  console.log('%cModules: Auth Â· Social Â· DM Â· Stories Â· Economy Â· Profile Â· Notifs Â· Admin','color:#888;');
  console.log('%cFirebase v11 Â· Vanilla JS ES13+ Â· 3900+ lines','color:#555;');
});

/* Fallback error handler for missing Firebase config */
window.addEventListener('error',e=>{
  if(e.message?.includes('Firebase')||e.message?.includes('auth/invalid')){
    const s=document.getElementById('auth-screen');
    if(s)s.innerHTML=`<div class="glass neon-border" style="padding:32px;max-width:420px;text-align:center;">
      <div style="font-size:3rem;">âš™ï¸</div>
      <div class="fam-d" style="color:var(--acc1);font-size:1.1rem;margin:10px 0;">Firebase Konfiqurasiya</div>
      <div class="text-m" style="font-size:.85rem;margin-bottom:14px;">ZÉ™hmÉ™t olmasa <strong>firebaseConfig</strong> obyektini Ã¶z layihÉ™nizin mÉ™lumatlarÄ± ilÉ™ doldurun.</div>
      <div class="glass-inset" style="padding:12px;font-size:.78rem;text-align:left;color:var(--acc1);">
        Firebase Console â†’ Project Settings â†’ Your apps â†’ Web app â†’ Config
      </div>
    </div>`;
  }
});
</script>
</body>
</html>
